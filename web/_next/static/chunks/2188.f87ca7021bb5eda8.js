"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2188],{82777:function(e,n,i){var a=i(85893),t=i(67294),l=i(88196),o=i(92365),r=i(96788),s=i(40110),h=i(44723),u=i(90633),c=i(26624),d=i(28907),g=i(68573),m=i(56912),v=i(40492),p=i(60990),x=i(51015),T=i(14959),C=i(25026),b=i(93454),f=i(76592),Z=i(70360),j=i(46577),y=i(8863),D=i(19827),L=i(96727),N=i(97182),P=i(26541),k=i(24602),z=i(45670),I=i(63144),w=i(50333),S=i(39123),_=i(18708);let F="CONG",K=[{label:"Qua đ\xea",value:0},{label:"Hệ k\xeanh",value:1},{label:"Cửa s\xf4ng/biển",value:2}],W=[{label:"Cửa cống",value:0},{label:"Cửa quay",value:1},{label:"Cửa van",value:2},{label:"Cửa phai",value:3},{label:"Cửa sập",value:4}],A=[{label:"Thủ c\xf4ng",value:0},{label:"Cơ kh\xed",value:1},{label:"Thủy lực",value:2},{label:"Điện",value:3}],E=[{label:"Ti\xeau",value:1},{label:"Cấp/Tưới",value:2},{label:"Ti\xeau + Cấp",value:3}];n.Z=e=>{let{onClose:n,onSaveComplete:i,open:H,editCong:M}=e,B=(0,t.useRef)(null),[O,R]=(0,t.useState)([]),[q,V]=(0,t.useState)(!0),[G,X]=(0,t.useState)(0),[Q,J]=(0,t.useState)("1"),[Y,$]=(0,t.useState)({tenCong:"",maCong:"",viTri:"",viTriKm:"",xaPhuong:"",quanHuyen:"",toaDo:"",chucNang:1,viTriCong:0,kieuVanChinh:0,hinhThucDongMo:0,vatLieuChinh:"",hinhThuc:"",capCongTrinh:"",soKhoang:void 0,beRongKhoang:void 0,chieuCaoCua:void 0,chieuDaiCong:void 0,khauDo:"",luuLuongTieu:void 0,luuLuongDan:void 0,caoTrinhNen:void 0,caoTrinhDinh:void 0,caoTrinhTran:void 0,mucNuocThuongLuu:void 0,mucNuocHaLuu:void 0,hinhThucTNPhiaSong:"",chieuDaiTNPhiaSong:void 0,caoDoBeTNPhiaSong:void 0,hinhThucTNPhiaDe:"",chieuDaiTNPhiaDe:void 0,caoDoBeTNPhiaDe:void 0,namXayDung:void 0,namNangCap:void 0,namTuBo:void 0,chuQuanLy:"",tinhTrang:"",danhGia:"",maLoaiCongTrinh:F,loaiCongTrinhId:""}),[U,ee]=(0,t.useState)(!1),[en,ei]=(0,t.useState)(null),[ea,et]=(0,t.useState)(null),[el,eo]=(0,t.useState)(""),[er,es]=(0,t.useState)([]),[eh,eu]=(0,t.useState)([]),[ec,ed]=(0,t.useState)(""),eg=(0,t.useCallback)(e=>{if(!e)return"";let n=er.find(n=>n.id===e);return n?n.tenTuyenDe:""},[er]),em=(0,t.useCallback)(e=>{if(!e)return"";let n=er.find(n=>{var i,a,t;return(null===(i=n.tenTuyenDe)||void 0===i?void 0:i.toLowerCase())===(null==e?void 0:e.toLowerCase())||(null===(a=n.tenTuyenDe)||void 0===a?void 0:a.toLowerCase().includes(null==e?void 0:e.toLowerCase()))&&e.length>3||(null==e?void 0:e.toLowerCase().includes(null===(t=n.tenTuyenDe)||void 0===t?void 0:t.toLowerCase()))&&n.tenTuyenDe.length>3});return n?n.id:""},[er]);(0,t.useEffect)(()=>{let e=async()=>{try{let e=await _.I.getAllTuyenDe({pageSize:1e3},!1);e&&e.items&&es(e.items)}catch(e){ei("Kh\xf4ng thể tải danh s\xe1ch tuyến đ\xea")}};(async()=>{try{let e=(await _.I.getLoaiCongTrinhTree()).find(e=>e.maLoai===F||e.tenLoai&&e.tenLoai.toLowerCase().includes("cống"));e&&eo(e.id)}catch(e){ei("Kh\xf4ng thể tải danh s\xe1ch loại c\xf4ng tr\xecnh")}})(),e()},[]),(0,t.useEffect)(()=>{if(!ec){eu([]);return}(async()=>{try{let e=await _.I.getAllDoanDe({tuyenDeId:ec,pageSize:1e3},!1);e&&e.items&&eu(e.items)}catch(e){ei("Kh\xf4ng thể tải danh s\xe1ch đoạn đ\xea")}})()},[ec]),(0,t.useEffect)(()=>{M&&H?($({...M,maLoaiCongTrinh:F,loaiCongTrinhId:M.loaiCongTrinhId||el}),M.tuyenDeId&&ed(M.tuyenDeId)):H&&($({tenCong:"",maCong:"",viTri:"",viTriKm:"",xaPhuong:"",quanHuyen:"",toaDo:"",chucNang:1,viTriCong:0,kieuVanChinh:0,hinhThucDongMo:0,vatLieuChinh:"",hinhThuc:"",capCongTrinh:"",soKhoang:void 0,beRongKhoang:void 0,chieuCaoCua:void 0,chieuDaiCong:void 0,khauDo:"",luuLuongTieu:void 0,luuLuongDan:void 0,caoTrinhNen:void 0,caoTrinhDinh:void 0,caoTrinhTran:void 0,mucNuocThuongLuu:void 0,mucNuocHaLuu:void 0,hinhThucTNPhiaSong:"",chieuDaiTNPhiaSong:void 0,caoDoBeTNPhiaSong:void 0,hinhThucTNPhiaDe:"",chieuDaiTNPhiaDe:void 0,caoDoBeTNPhiaDe:void 0,namXayDung:void 0,namNangCap:void 0,namTuBo:void 0,chuQuanLy:"",tinhTrang:"",danhGia:"",maLoaiCongTrinh:F,loaiCongTrinhId:el}),V(!0),J("1"),ed(""),R([]))},[M,H,el]),(0,t.useEffect)(()=>{er.length>0&&O.length>0&&R(e=>e.map(e=>{if(e.tenTuyenDe&&!e.tuyenDeId){let n=em(e.tenTuyenDe);return{...e,tuyenDeId:n}}return e}))},[er,O,em]);let ev=e=>{ed(e),$(n=>({...n,tuyenDeId:e,doanDeId:""}))},ep=(e,n)=>{$(i=>({...i,[e]:n}))},ex=()=>!!Y.tenCong||(ei("T\xean cống kh\xf4ng được để trống"),!1),eT=async()=>{if(q){if(ex()){ee(!0),ei(null),et(null);try{await S.m.saveCong(Y)?(et("Lưu th\xe0nh c\xf4ng"),setTimeout(()=>{i()},1e3)):ei("Kh\xf4ng thể lưu dữ liệu")}catch(e){ei(e.message||"Lỗi kh\xf4ng x\xe1c định")}finally{ee(!1)}}}else{if(0===O.length){ei("Kh\xf4ng c\xf3 dữ liệu để lưu");return}ee(!0),ei(null),et(null);try{let e=O.length,n=0,a=[];for(let i of O)try{await S.m.saveCong({...i,maLoaiCongTrinh:F,loaiCongTrinhId:i.loaiCongTrinhId||el}),n++,X(Math.floor(n/e*100))}catch(e){a.push(i.tenCong||"Kh\xf4ng t\xean")}0===a.length?et("Lưu th\xe0nh c\xf4ng ".concat(n," cống")):et("Đ\xe3 lưu ".concat(n,"/").concat(e," cống. ").concat(a.length," cống bị lỗi.")),setTimeout(()=>{i()},1500)}catch(e){ei(e.message||"Lỗi kh\xf4ng x\xe1c định khi lưu dữ liệu h\xe0ng loạt")}finally{ee(!1)}}};return(0,a.jsxs)(l.Z,{open:H,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,a.jsx)(o.Z,{children:(0,a.jsx)(r.Z,{variant:"h6",textAlign:"center",children:M?"Chỉnh sửa th\xf4ng tin cống":"Th\xeam mới cống"})}),(0,a.jsxs)(s.Z,{dividers:!0,sx:{overflowY:"auto",height:"700px"},children:[en&&(0,a.jsxs)(h.Z,{severity:"error",sx:{mb:2},children:[(0,a.jsx)(u.Z,{children:"Lỗi"}),en]}),ea&&(0,a.jsxs)(h.Z,{severity:"success",sx:{mb:2},children:[(0,a.jsx)(u.Z,{children:"Th\xe0nh c\xf4ng"}),ea]}),(0,a.jsxs)(z.ZP,{value:Q,children:[(0,a.jsxs)(c.Z,{value:Q,onChange:(e,n)=>{J(n),V("1"===n)},"aria-label":"tabs",variant:"fullWidth",sx:{borderBottom:1,borderColor:"divider",mb:2},children:[(0,a.jsx)(d.Z,{label:"Nhập thủ c\xf4ng",value:"1"}),(0,a.jsx)(d.Z,{label:"Nhập từ tệp",value:"2"})]}),(0,a.jsx)(I.Z,{value:"1",sx:{p:0},children:(0,a.jsxs)(g.ZP,{container:!0,spacing:2,children:[(0,a.jsxs)(g.ZP,{item:!0,xs:12,children:[(0,a.jsx)(r.Z,{variant:"subtitle1",sx:{mb:1},children:"Th\xf4ng tin cơ bản"}),(0,a.jsx)(m.Z,{sx:{mb:2}})]}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"T\xean cống",value:Y.tenCong||"",onChange:e=>ep("tenCong",e.target.value),fullWidth:!0,required:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"M\xe3 cống",value:Y.maCong||"",onChange:e=>ep("maCong",e.target.value),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(w.Z,{options:er,getOptionLabel:e=>e.tenTuyenDe||"",value:er.find(e=>e.id===Y.tuyenDeId)||null,onChange:(e,n)=>ev((null==n?void 0:n.id)||""),renderInput:e=>(0,a.jsx)(v.Z,{...e,label:"Tuyến đ\xea",size:"small"}),size:"small",disableClearable:!0})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(w.Z,{options:eh,getOptionLabel:e=>e.tenDoanDe||"",value:eh.find(e=>e.id===Y.doanDeId)||null,onChange:(e,n)=>ep("doanDeId",(null==n?void 0:n.id)||""),renderInput:e=>(0,a.jsx)(v.Z,{...e,label:"Đoạn đ\xea",size:"small"}),size:"small",disableClearable:!0,disabled:!ec})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Vị tr\xed",value:Y.viTri||"",onChange:e=>ep("viTri",e.target.value),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"L\xfd tr\xecnh Km",value:Y.viTriKm||"",onChange:e=>ep("viTriKm",e.target.value),fullWidth:!0,placeholder:"K77+200",size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(w.Z,{options:K,getOptionLabel:e=>e.label,value:K.find(e=>e.value===Y.viTriCong)||void 0,onChange:(e,n)=>{var i;return ep("viTriCong",null!==(i=null==n?void 0:n.value)&&void 0!==i?i:0)},renderInput:e=>(0,a.jsx)(v.Z,{...e,label:"Vị tr\xed cống",size:"small"}),size:"small",disableClearable:!0})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(w.Z,{options:W,getOptionLabel:e=>e.label,value:W.find(e=>e.value===Y.kieuVanChinh)||void 0,onChange:(e,n)=>{var i;return ep("kieuVanChinh",null!==(i=null==n?void 0:n.value)&&void 0!==i?i:0)},renderInput:e=>(0,a.jsx)(v.Z,{...e,label:"Kiểu van ch\xednh",size:"small"}),size:"small",disableClearable:!0})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(w.Z,{options:A,getOptionLabel:e=>e.label,value:A.find(e=>e.value===Y.hinhThucDongMo)||void 0,onChange:(e,n)=>{var i;return ep("hinhThucDongMo",null!==(i=null==n?void 0:n.value)&&void 0!==i?i:0)},renderInput:e=>(0,a.jsx)(v.Z,{...e,label:"H\xecnh thức đ\xf3ng mở",size:"small"}),size:"small",disableClearable:!0})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(w.Z,{options:E,getOptionLabel:e=>e.label,value:E.find(e=>e.value===Y.chucNang)||void 0,onChange:(e,n)=>{var i;return ep("chucNang",null!==(i=null==n?void 0:n.value)&&void 0!==i?i:1)},renderInput:e=>(0,a.jsx)(v.Z,{...e,label:"Chức năng",size:"small"}),size:"small",disableClearable:!0})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Vật liệu ch\xednh",value:Y.vatLieuChinh||"",onChange:e=>ep("vatLieuChinh",e.target.value),size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"H\xecnh thức",value:Y.hinhThuc||"",onChange:e=>ep("hinhThuc",e.target.value),fullWidth:!0,placeholder:"Hộp, Tr\xf2n, ...",size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Cấp c\xf4ng tr\xecnh",value:Y.capCongTrinh||"",onChange:e=>ep("capCongTrinh",e.target.value),fullWidth:!0,placeholder:"I, II, III, IV, ...",size:"small"})}),(0,a.jsxs)(g.ZP,{item:!0,xs:12,children:[(0,a.jsx)(r.Z,{variant:"subtitle1",sx:{mt:2,mb:1},children:"Th\xf4ng số kỹ thuật"}),(0,a.jsx)(m.Z,{})]}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Số khoang",type:"number",value:Y.soKhoang||"",onChange:e=>ep("soKhoang",parseInt(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Bề rộng khoang (m)",type:"number",value:Y.beRongKhoang||"",onChange:e=>ep("beRongKhoang",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Chiều cao cửa (m)",type:"number",value:Y.chieuCaoCua||"",onChange:e=>ep("chieuCaoCua",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Chiều d\xe0i cống (m)",type:"number",value:Y.chieuDaiCong||"",onChange:e=>ep("chieuDaiCong",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Khẩu độ",value:Y.khauDo||"",onChange:e=>ep("khauDo",e.target.value),fullWidth:!0,placeholder:"4*(4x3)",size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Lưu lượng ti\xeau (m3/s)",type:"number",value:Y.luuLuongTieu||"",onChange:e=>ep("luuLuongTieu",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Lưu lượng dẫn (m3/s)",type:"number",value:Y.luuLuongDan||"",onChange:e=>ep("luuLuongDan",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Cao tr\xecnh nền (m)",type:"number",value:Y.caoTrinhNen||"",onChange:e=>ep("caoTrinhNen",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Cao tr\xecnh đỉnh (m)",type:"number",value:Y.caoTrinhDinh||"",onChange:e=>ep("caoTrinhDinh",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Cao tr\xecnh tr\xe0n (m)",type:"number",value:Y.caoTrinhTran||"",onChange:e=>ep("caoTrinhTran",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsxs)(g.ZP,{item:!0,xs:12,children:[(0,a.jsx)(r.Z,{variant:"subtitle1",sx:{mt:2,mb:1},children:"Th\xf4ng tin mực nước"}),(0,a.jsx)(m.Z,{})]}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Mực nước thượng lưu (m)",type:"number",value:Y.mucNuocThuongLuu||"",onChange:e=>ep("mucNuocThuongLuu",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Mực nước hạ lưu (m)",type:"number",value:Y.mucNuocHaLuu||"",onChange:e=>ep("mucNuocHaLuu",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsxs)(g.ZP,{item:!0,xs:12,children:[(0,a.jsx)(r.Z,{variant:"subtitle1",sx:{mt:2,mb:1},children:"Th\xf4ng tin ti\xeau năng"}),(0,a.jsx)(m.Z,{})]}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"H\xecnh thức ti\xeau năng ph\xeda s\xf4ng",value:Y.hinhThucTNPhiaSong||"",onChange:e=>ep("hinhThucTNPhiaSong",e.target.value),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Chiều d\xe0i ti\xeau năng ph\xeda s\xf4ng (m)",type:"number",value:Y.chieuDaiTNPhiaSong||"",onChange:e=>ep("chieuDaiTNPhiaSong",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Cao độ bể ti\xeau năng ph\xeda s\xf4ng (m)",type:"number",value:Y.caoDoBeTNPhiaSong||"",onChange:e=>ep("caoDoBeTNPhiaSong",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"H\xecnh thức ti\xeau năng ph\xeda đ\xea",value:Y.hinhThucTNPhiaDe||"",onChange:e=>ep("hinhThucTNPhiaDe",e.target.value),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Chiều d\xe0i ti\xeau năng ph\xeda đ\xea (m)",type:"number",value:Y.chieuDaiTNPhiaDe||"",onChange:e=>ep("chieuDaiTNPhiaDe",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Cao độ bể ti\xeau năng ph\xeda đ\xea (m)",type:"number",value:Y.caoDoBeTNPhiaDe||"",onChange:e=>ep("caoDoBeTNPhiaDe",parseFloat(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Năm x\xe2y dựng",type:"number",value:Y.namXayDung||"",onChange:e=>ep("namXayDung",parseInt(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Năm n\xe2ng cấp",type:"number",value:Y.namNangCap||"",onChange:e=>ep("namNangCap",parseInt(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsxs)(g.ZP,{item:!0,xs:12,children:[(0,a.jsx)(r.Z,{variant:"subtitle1",sx:{mt:2,mb:1},children:"Th\xf4ng tin quản l\xfd"}),(0,a.jsx)(m.Z,{})]}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Chủ quản l\xfd",value:Y.chuQuanLy||"",onChange:e=>ep("chuQuanLy",e.target.value),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"T\xecnh trạng",value:Y.tinhTrang||"",onChange:e=>ep("tinhTrang",e.target.value),fullWidth:!0,size:"small"})}),(0,a.jsxs)(g.ZP,{item:!0,xs:12,children:[(0,a.jsx)(r.Z,{variant:"subtitle1",sx:{mt:2,mb:1},children:"Th\xf4ng tin bảo tr\xec v\xe0 đ\xe1nh gi\xe1"}),(0,a.jsx)(m.Z,{})]}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Năm tu bổ",type:"number",value:Y.namTuBo||"",onChange:e=>ep("namTuBo",parseInt(e.target.value)||void 0),fullWidth:!0,size:"small"})}),(0,a.jsx)(g.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(v.Z,{label:"Đ\xe1nh gi\xe1",value:Y.danhGia||"",onChange:e=>ep("danhGia",e.target.value),fullWidth:!0,multiline:!0,rows:4,placeholder:"Đ\xe1nh gi\xe1 hiện trạng c\xf4ng tr\xecnh...",size:"small"})})]})}),(0,a.jsx)(I.Z,{value:"2",sx:{p:0},children:(0,a.jsx)(g.ZP,{container:!0,spacing:2,children:(0,a.jsxs)(g.ZP,{item:!0,xs:12,children:[(0,a.jsx)(p.Z,{sx:{border:"1px dashed #ccc",p:3,my:2,textAlign:"center",borderRadius:1},children:(0,a.jsxs)(x.Z,{component:"label",variant:"contained",startIcon:(0,a.jsx)(k.Z,{}),disabled:U,children:["Chọn tệp GeoJSON",(0,a.jsx)("input",{ref:B,type:"file",accept:".geojson,.json",onChange:e=>{var n;let i=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!i)return;ei(null),V(!1),J("2");let a=new FileReader;a.onload=e=>{try{var n;let i=JSON.parse(null===(n=e.target)||void 0===n?void 0:n.result);if(!i.type||"FeatureCollection"!==i.type||!i.features){ei("File kh\xf4ng phải l\xe0 GeoJSON FeatureCollection hợp lệ");return}let a=i.features.map(e=>{var n;if(!e.geometry||!e.properties)return null;let i={type:"Feature",geometry:e.geometry,properties:{}},a=1;e.properties.Nhiem_vu&&(e.properties.Nhiem_vu.toLowerCase().includes("tưới")?a=2:e.properties.Nhiem_vu.toLowerCase().includes("cấp")?a=2:e.properties.Nhiem_vu.toLowerCase().includes("tưới")&&e.properties.Nhiem_vu.toLowerCase().includes("ti\xeau")&&(a=3));let t=0;if(e.properties.Loai_van){let n=e.properties.Loai_van.toLowerCase();n.includes("quay")?t=1:n.includes("van")?t=2:n.includes("phai")?t=3:n.includes("sập")&&(t=4)}let l=0;if(e.properties.Cach_dongmo){let n=e.properties.Cach_dongmo.toLowerCase();n.includes("m\xe1y")||n.includes("cơ kh\xed")?l=1:n.includes("thủy lực")?l=2:n.includes("điện")&&(l=3)}let o="";return e.properties.Thuoc_Tde&&(o=em(e.properties.Thuoc_Tde)),{tenCong:e.properties.Ten_cong||"Chưa r\xf5",maCong:e.properties.ID||"",viTri:e.properties.Vitri_DiaLy||"",viTriKm:e.properties.Vitri_Km||"",xaPhuong:e.properties.Thuoc_xa||"",quanHuyen:e.properties.Thuoc_huyen||"",toaDo:JSON.stringify(i),chucNang:a,viTriCong:e.properties.viTriCong||0,kieuVanChinh:t,hinhThucDongMo:l,vatLieuChinh:e.properties.Ket_cau||"",hinhThuc:e.properties.Hinh_thuc||"",capCongTrinh:e.properties.Cap_CT||"",khauDo:e.properties.Khau_do||"",soKhoang:parseFloat(null===(n=e.properties.Khau_do)||void 0===n?void 0:n.split("*")[0])||void 0,beRongKhoang:void 0,chieuCaoCua:void 0,chieuDaiCong:parseFloat(e.properties.Chieu_dai)||void 0,luuLuongTieu:void 0,luuLuongDan:void 0,caoTrinhNen:parseFloat(e.properties.Cao_trinhday)||void 0,caoTrinhDinh:void 0,caoTrinhTran:parseFloat(e.properties.Cao_trinhtran)||void 0,mucNuocThuongLuu:void 0,mucNuocHaLuu:void 0,hinhThucTNPhiaSong:e.properties.HT_TNphiaSg||"",chieuDaiTNPhiaSong:parseFloat(e.properties.Chdai_TNphiaSg)||void 0,caoDoBeTNPhiaSong:parseFloat(e.properties.Caodo_TNphiaSg)||void 0,hinhThucTNPhiaDe:e.properties.HT_TNphiaDg||"",chieuDaiTNPhiaDe:parseFloat(e.properties.Chdai_TNphiaDg)||void 0,caoDoBeTNPhiaDe:parseFloat(e.properties.Caodo_TNphiaDg)||void 0,namXayDung:parseInt(e.properties.Nam_XD)||void 0,namNangCap:void 0,namTuBo:parseInt(e.properties.Nam_tubo)||void 0,chuQuanLy:e.properties.Dvi_Qly||"",tinhTrang:e.properties.Hien_trang||"",danhGia:e.properties.Hong_tubo||"",maLoaiCongTrinh:F,loaiCongTrinhId:el,tenLoaiCongTrinh:"Cống",tuyenDeId:e.properties.tuyenDeId||o||ec||"",doanDeId:e.properties.doanDeId||"",tenTuyenDe:e.properties.Thuoc_Tde||""}}).filter(Boolean);R(a)}catch(e){ei("Kh\xf4ng thể đọc file. Lỗi: "+e.message)}},a.readAsText(i)},style:{display:"none"}})]})}),U&&(0,a.jsxs)(p.Z,{sx:{width:"100%",mb:2},children:[(0,a.jsxs)(r.Z,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Đang lưu... ",G,"%"]}),(0,a.jsx)(T.Z,{variant:"determinate",value:G})]}),(0,a.jsx)(r.Z,{variant:"body2",color:"text.secondary",sx:{mt:1,mb:2},children:"Nhập tệp GeoJSON c\xf3 cấu tr\xfac FeatureCollection với c\xe1c Feature chứa th\xf4ng tin cống. Mỗi Feature n\xean c\xf3 c\xe1c thuộc t\xednh như tenCong, maCong, viTri... trong properties."}),O.length>0&&(0,a.jsxs)(p.Z,{sx:{mt:3},children:[(0,a.jsxs)(r.Z,{variant:"subtitle2",sx:{mb:1},children:["Xem trước dữ liệu (",O.length," cống)"]}),(0,a.jsx)(C.Z,{component:b.Z,sx:{maxHeight:400,overflow:"auto",width:"100%"},children:(0,a.jsxs)(f.Z,{stickyHeader:!0,size:"small",children:[(0,a.jsx)(Z.Z,{children:(0,a.jsxs)(j.Z,{children:[(0,a.jsx)(y.Z,{width:"40",children:"STT"}),(0,a.jsx)(y.Z,{width:"160",children:"T\xean cống"}),(0,a.jsx)(y.Z,{width:"90",children:"L\xfd tr\xecnh"}),(0,a.jsx)(y.Z,{width:"150",children:"Tuyến đ\xea"}),(0,a.jsx)(y.Z,{width:"100",children:"Loại CT"}),(0,a.jsx)(y.Z,{width:"80",children:"Chức năng"}),(0,a.jsx)(y.Z,{width:"120",children:"Kết cấu"}),(0,a.jsx)(y.Z,{width:"100",children:"K\xedch thước"})]})}),(0,a.jsx)(D.Z,{children:O.map((e,n)=>(0,a.jsxs)(j.Z,{children:[(0,a.jsx)(y.Z,{children:n+1}),(0,a.jsx)(y.Z,{children:e.tenCong}),(0,a.jsx)(y.Z,{children:e.viTriKm||e.viTri}),(0,a.jsx)(y.Z,{children:e.tenTuyenDe||eg(e.tuyenDeId)||"Chưa x\xe1c định"}),(0,a.jsx)(y.Z,{children:e.tenLoaiCongTrinh||"Cống"}),(0,a.jsx)(y.Z,{children:1===e.chucNang?"Ti\xeau":2===e.chucNang?"Cấp/Tưới":3===e.chucNang?"Ti\xeau + Cấp":""}),(0,a.jsxs)(y.Z,{children:[e.vatLieuChinh||""," ",e.hinhThuc||""]}),(0,a.jsx)(y.Z,{children:e.khauDo?e.khauDo:e.chieuDaiCong?e.soKhoang?"".concat(e.soKhoang,"x").concat(e.chieuDaiCong,"m"):"".concat(e.chieuDaiCong,"m"):""})]},n))})]})}),(0,a.jsx)(x.Z,{onClick:()=>{B.current&&(B.current.value=""),R([])},variant:"outlined",fullWidth:!0,sx:{mt:2},children:"X\xf3a dữ liệu"})]})]})})})]})]}),(0,a.jsxs)(L.Z,{children:[(0,a.jsx)(x.Z,{onClick:n,disabled:U,children:"Hủy"}),(0,a.jsx)(x.Z,{onClick:eT,variant:"contained",color:"primary",startIcon:U?(0,a.jsx)(N.Z,{size:20}):(0,a.jsx)(P.Z,{}),disabled:U||q&&!Y.tenCong||!q&&0===O.length,children:U?"Đang lưu...":"Lưu"})]})]})}},79997:function(e,n,i){var a=i(67294),t=i(39153),l=i(45243),o=i.n(l),r=i(29291),s=i(92893),h=i(36637);n.Z=e=>{let n=(0,t.Sx)(),{filteredCongList:i,handleCongClick:l,layerLabelState:u,legendData:c,focusedId:d}=(0,r.Y)(),g=a.useRef(null),m=a.useRef({}),v=a.useRef(null),p=e.data||i;return a.useEffect(()=>{if(!n.getPane("congPane")){let e=n.createPane("congPane");e.style.zIndex="652",e.style.pointerEvents="auto"}},[n]),a.useEffect(()=>{if(g.current&&n.removeLayer(g.current),!p||0===p.length)return;let e=o().featureGroup();return g.current=e,p.forEach(n=>{let i=n.toaDo;if(!i)return;if("string"==typeof i)try{i=JSON.parse(i)}catch(e){return}if(!i.geometry||!i.geometry.coordinates)return;let a=i.geometry.coordinates,t=n.color||"#FF9800";if(!Array.isArray(a)||a.length<2)return;let r=a[1],d=a[0],g=(0,s.oN)(c,n),v=(0,h.L)(r,d,g,t,{pane:"congPane"});n.maLoaiCongTrinh&&u[n.maLoaiCongTrinh]&&v.bindTooltip(n.tenCong,{permanent:!0,className:"map-label cong-label",opacity:1}),v.on("click",e=>{l(n,[e.latlng.lat,e.latlng.lng]),o().DomEvent.stopPropagation(e)}),n.id&&(m.current[n.id]=v),e.addLayer(v)}),e.addTo(n),e.bringToFront(),()=>{g.current&&n.removeLayer(g.current)}},[p,n,l,u,c]),a.useEffect(()=>{if(!n)return;let e=()=>{let e=n.getZoom();setTimeout(()=>{document.querySelectorAll(".cong-label").forEach(n=>{e<12?(n.style.display="none",n.style.opacity="0",n.style.visibility="hidden",n.classList.add("Cong-hidden-tooltip")):(n.style.display="block",n.style.opacity="1",n.style.visibility="visible",n.classList.remove("Cong-hidden-tooltip"))})},100)};return n.on("zoomend",e),e(),()=>{n.off("zoomend",e)}},[n]),a.useEffect(()=>{if(v.current){try{n.removeLayer(v.current)}catch(e){}v.current=null}if(!d)return;let e=m.current[d];if(e)try{if(e.getLatLng){let i=e.getLatLng();n.flyTo(i,Math.max(n.getZoom(),15),{duration:.75});let a=o().circleMarker(i,{radius:10,color:"#ff9800",weight:3,opacity:.9,fillColor:"#ff9800",fillOpacity:.15,pane:"congPane"});a.addTo(n),a.bringToFront(),v.current=a;return}}catch(e){console.error("Kh\xf4ng thể zoom tới cống đ\xe3 chọn:",e)}},[d,n]),a.useEffect(()=>()=>{if(v.current)try{n.removeLayer(v.current)}catch(e){}},[n]),null}},36637:function(e,n,i){i.d(n,{L:function(){return l}});var a=i(45243),t=i.n(a);function l(e,n,i,a,l){let o=["polygon","rect","path","circle","ellipse","line","polyline"],r=/(fill|stroke)="#([0-9A-Fa-f]{6}|[0-9A-Fa-f]{3})"/g.test(i)&&!/(fill|stroke)="#ededed"/g.test(i)||/(fill|stroke)="(red|blue)"/g.test(i)||/<g transform/g.test(i),s=i;r||(s=i.replace(/fill="[^"]*"/g,'fill="'.concat(a,'"')).replace(/stroke="[^"]*"/g,'stroke="'.concat(a,'"')),/fill=/.test(s)||o.forEach(e=>{let n=RegExp("<".concat(e,"([^>]*)"),"gi");s=s.replace(n,"<".concat(e,'$1 fill="').concat(a,'" stroke="').concat(a,'" fill-opacity="0.8" stroke-opacity="1"'))})),s&&("string"!=typeof s||""!==s.trim())||(s='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="8" fill="'.concat(a,'" stroke="#333" stroke-width="1"/></svg>'));let h=[24,24],u=[12,12],c=i.match(/width="(\d+)"/),d=i.match(/height="(\d+)"/);if(c&&d){let e=parseInt(c[1],10),n=parseInt(d[1],10);if(16===e&&16===n)h=[16,16],u=[8,8];else if(e>40||n>40){let i=24/Math.max(e,n);h=[Math.floor(e*i),Math.floor(n*i)],u=[Math.floor(e*i/2),Math.floor(n*i/2)]}else h=[e,n],u=[Math.floor(e/2),Math.floor(n/2)]}let g=t().divIcon({className:"custom-svg-marker",html:s,iconSize:h,iconAnchor:u}),m=t().marker([e,n],{icon:g,...l}),v=new Map;return m.on("mouseover",()=>{let e=m.getElement();e&&o.forEach(n=>{e.querySelectorAll(n).forEach(e=>{v.has(e)||v.set(e,{fill:e.getAttribute("fill")||void 0,stroke:e.getAttribute("stroke")||void 0}),e.setAttribute("fill","#fff"),e.setAttribute("stroke","#333"),e.setAttribute("fill-opacity","0.9"),e.setAttribute("stroke-opacity","1"),e.setAttribute("stroke-width","1.5")})})}),m.on("mouseout",()=>{let e=m.getElement();e&&o.forEach(n=>{e.querySelectorAll(n).forEach(e=>{let n=v.get(e);n?(n.fill&&e.setAttribute("fill",n.fill),n.stroke&&e.setAttribute("stroke",n.stroke)):(e.setAttribute("fill",a),e.setAttribute("stroke",a)),e.setAttribute("fill-opacity","0.8"),e.setAttribute("stroke-opacity","1"),e.setAttribute("stroke-width","1")})})}),m}}}]);