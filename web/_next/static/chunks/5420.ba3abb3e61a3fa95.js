"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5420],{15420:function(e,n,i){i.r(n),i.d(n,{default:function(){return np}});var t=i(85893),l=i(67294),a=i(60990),o=i(96788),r=i(81873),s=i(9122),d=i(69200),h=i(4162),c=i(21038);let u=l.forwardRef((e,n)=>{let{sidebarOpen:i,setSidebarOpen:l}=e;return(0,t.jsx)("a",{ref:n,href:"#",className:"leaflet-bar-part leaflet-bar-part-single",onClick:e=>{e.preventDefault(),l(e=>!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:30,height:30,cursor:"pointer"},tabIndex:0,"aria-label":i?"Đ\xf3ng t\xe1c vụ":"Mở t\xe1c vụ",children:(0,t.jsx)(c.Z,{title:i?"Đ\xf3ng t\xe1c vụ":"Mở t\xe1c vụ",children:(0,t.jsx)(h.Z,{fontSize:"small"})})})});var x=i(70178),g=i(52857),m=i(56912),j=i(38444),p=i(4291),b=i(47407),v=i(19304),C=i(53839),f=i(73837),y=i(85413);let Z={px:1.5,py:2,borderRadius:1,fontWeight:500,fontSize:15,color:"text.primary",mb:.5,transition:"background 0.2s, transform 0.18s cubic-bezier(0.4,0,0.2,1)",position:"relative",pl:4,"&:hover":{backgroundColor:"#d4eaff"}},T=[{label:"Th\xeam dữ liệu đoạn đ\xea",handler:"onAddClick",icon:(0,t.jsx)(C.Z,{sx:{fontSize:18,mr:1,color:"primary.main"}})},{label:"Th\xeam dữ liệu k\xe8",handler:"onImportClick",icon:(0,t.jsx)(C.Z,{sx:{fontSize:18,mr:1,color:"primary.main"}})},{label:"Th\xeam dữ liệu hạt quản l\xfd đ\xea",handler:"onHatQlyDeClick",icon:(0,t.jsx)(C.Z,{sx:{fontSize:18,mr:1,color:"primary.main"}})},{label:"Th\xeam dữ liệu cột km",handler:"onCotKMClick",icon:(0,t.jsx)(C.Z,{sx:{fontSize:18,mr:1,color:"primary.main"}})},{label:"Th\xeam dữ liệu cửa khẩu",handler:"onCuaKhauClick",icon:(0,t.jsx)(C.Z,{sx:{fontSize:18,mr:1,color:"primary.main"}})},{label:"Th\xeam dữ liệu kho vật tư",handler:"onKhoVatTuClick",icon:(0,t.jsx)(C.Z,{sx:{fontSize:18,mr:1,color:"primary.main"}})},{label:"Th\xeam dữ liệu điếm canh đ\xea",handler:"onDCanhClick",icon:(0,t.jsx)(C.Z,{sx:{fontSize:18,mr:1,color:"primary.main"}})},{label:"Th\xeam dữ liệu cống",handler:"onCongClick",icon:(0,t.jsx)(C.Z,{sx:{fontSize:18,mr:1,color:"primary.main"}})},{label:"Th\xeam dữ liệu sự cố đ\xea",handler:"onSuCoDeClick",icon:(0,t.jsx)(C.Z,{sx:{fontSize:18,mr:1,color:"primary.main"}})}];var D=e=>{let{onAddClick:n,onImportClick:i,onCotKMClick:r,onCuaKhauClick:s,onKhoVatTuClick:d,onDCanhClick:h,onCongClick:c,onSuCoDeClick:u,onHatQlyDeClick:x}=e,g={onAddClick:n,onImportClick:i,onCotKMClick:r,onCuaKhauClick:s,onKhoVatTuClick:d,onDCanhClick:h,onSuCoDeClick:u,onCongClick:c,onHatQlyDeClick:x},[j,C]=(0,l.useState)("data"),D=e=>{C(n=>n===e?null:e)};return(0,t.jsx)(a.Z,{children:(0,t.jsxs)(a.Z,{sx:{mt:2,mb:1,border:"1px solid #e0e0e0",borderRadius:2},children:[(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:1.5,cursor:"pointer"},onClick:()=>D("data"),children:[(0,t.jsx)(o.Z,{variant:"subtitle2",sx:{fontWeight:600},children:"Nhập dữ liệu"}),"data"===j?(0,t.jsx)(f.Z,{}):(0,t.jsx)(y.Z,{})]}),(0,t.jsxs)(p.Z,{in:"data"===j,timeout:"auto",unmountOnExit:!0,children:[(0,t.jsx)(m.Z,{}),(0,t.jsx)(b.Z,{component:"nav",sx:{width:"100%",p:0},children:T.map(e=>(0,t.jsxs)(v.ZP,{button:!0,sx:Z,onClick:g[e.handler],children:[e.icon,(0,t.jsx)("span",{className:"menu-action-text",children:e.label})]},e.label))})]})]})})},k=e=>{let{sidebarOpen:n,setSidebarOpen:i,onOpenDialog:l,onOpenImportDialog:r,onOpenCotKMDialog:s,onOpenCuaKhauDialog:d,onOpenKhoVatTuDialog:h,onOpenDCanhDialog:u,onOpenCongDialog:p,onOpenSuCoDeDialog:b,onOpenHatQlyDeDialog:v}=e;return(0,t.jsxs)(x.ZP,{variant:"persistent",open:!0,anchor:"left",transitionDuration:350,PaperProps:{sx:{width:280,position:"absolute",boxSizing:"border-box",left:10,top:10,pt:3,height:"calc(100% - 20px)",borderRadius:1,overflowX:"hidden",overflowY:"auto",px:2,bgcolor:"background.paper",borderRight:"1px solid #eee",zIndex:1200,display:"flex",transition:"transform 0.35s cubic-bezier(0.4,0,0.2,1), opacity 0.35s cubic-bezier(0.4,0,0.2,1)",transform:n?"translateX(0)":"translateX(-120%)",opacity:n?1:0,pointerEvents:n?"auto":"none"}},children:[(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1.75},children:[(0,t.jsx)(a.Z,{sx:{display:"flex",alignItems:"center"},children:(0,t.jsx)(o.Z,{variant:"subtitle1",fontWeight:"bold",children:"T\xe1c vụ"})}),(0,t.jsx)(g.Z,{size:"small",onClick:()=>i(!1),children:(0,t.jsx)(c.Z,{title:"Đ\xf3ng t\xe1c vụ",children:(0,t.jsx)(j.Z,{fontSize:"small"})})})]}),(0,t.jsx)(m.Z,{sx:{my:1}}),(0,t.jsx)(D,{onAddClick:l,onImportClick:r,onCotKMClick:s,onCuaKhauClick:d,onKhoVatTuClick:h,onDCanhClick:u,onCongClick:p,onSuCoDeClick:b,onHatQlyDeClick:v})]})},S=i(93454),L=i(26624),w=i(28907),K=i(97182),I=i(68573),F=[{key:"UpperLimit",label:"Cao tr\xecnh mặt đ\xea",color:"#000000ff",y:5.4,subject:"Cao tr\xecnh mặt đ\xea"},{key:"III",label:"B\xe1o động III",color:"#ff3c00ff",y:5,subject:"BDIII"},{key:"II",label:"B\xe1o động II",color:"#ffa600ff",y:4.5,subject:"BDII"},{key:"I",label:"B\xe1o động I",color:"#00ff0dff",y:4,subject:"BDI"}],z=i(35307),N=i(61193),M=i.n(N),P=i(46312),W=i(64715),B=i(10723),O=i(67017),V=i(25615),H=i(88793),R=i(24570),A=i(78042),E=i(72775),X=i(31712);let _=e=>{let{children:n,value:i,index:l,...o}=e;return(0,t.jsx)("div",{role:"tabpanel",hidden:i!==l,id:"dike-tabpanel-".concat(l),"aria-labelledby":"dike-tab-".concat(l),style:{height:"100%",overflow:"auto",display:i===l?"block":"none"},...o,children:i===l&&(0,t.jsx)(a.Z,{sx:{p:2,height:"100%",overflowY:"auto"},children:n})})},G=()=>{var e;let n=new Date,i=[],t=(null===(e=F.find(e=>"II"===e.key))||void 0===e?void 0:e.y)||4.5;for(let e=-6;e<=0;e++){let l=new Date(n.getTime()+36e5*e),a="".concat(l.getHours(),":00"),o=t+.3*Math.sin(e/6)+.2*Math.random();i.push({time:a,value:parseFloat(o.toFixed(2)),isForecast:!1})}for(let e=1;e<=6;e++){let l=new Date(n.getTime()+36e5*e),a="".concat(l.getHours(),":00"),o=t+.3*Math.sin(e/6)+.05*e;i.push({time:a,value:parseFloat(o.toFixed(2)),isForecast:!0})}return i.sort((e,n)=>parseInt(e.time)-parseInt(n.time))};var J=e=>{var n,i,r,s,d,h,u,x,p,b,v,C,f,y,Z,T,D,k,N,J,Q,q,U,Y,$,ee,en,ei,et,el;let{open:ea,onClose:eo,selectedItem:er,clickedCoordinates:es}=e,[ed,eh]=(0,l.useState)(!1),[ec,eu]=(0,l.useState)([]),[ex,eg]=(0,l.useState)(0),[em,ej]=(0,l.useState)({width:window.innerWidth,height:window.innerHeight}),ep=()=>em.width<=600?{width:Math.min(350,em.width-40),height:400}:em.width<=960?{width:450,height:450}:{width:540,height:500},eb=()=>em.width<=600?{x:10,y:10}:{x:Math.max(20,em.width/2-ep().width/2),y:Math.max(20,em.height/2-ep().height/2)},[ev,eC]=(0,l.useState)(eb()),[ef,ey]=(0,l.useState)(ep()),eZ=(0,l.useRef)(null),[eT,eD]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=()=>{if(ej({width:window.innerWidth,height:window.innerHeight}),ea){let e=ep();ey(e),(ev.x+e.width>window.innerWidth||ev.y+e.height>window.innerHeight)&&eC(eb())}};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[ea,ev,em]),(0,l.useEffect)(()=>{er&&ea&&(eh(!0),eC(eb()),ey(ep()),setTimeout(()=>{eu(G()),eh(!1)},500))},[er,ea,em]),(0,l.useEffect)(()=>{es&&(eD(es),eg(0))},[es]);let ek=ec.findIndex(e=>e.isForecast),eS=ek>0?ek/(ec.length-1)*100:100;return ea?(0,t.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1201,pointerEvents:"none"},children:(0,t.jsx)(M(),{nodeRef:eZ,handle:".drawer-handle",position:ev,onStop:(e,n)=>{eC({x:n.x,y:n.y})},cancel:".cancel-drag",disabled:em.width<=600,children:(0,t.jsx)("div",{ref:eZ,style:{position:"absolute",pointerEvents:"auto",width:em.width<=600?"100%":"auto"},children:(0,t.jsx)(P.e,{size:{width:em.width<=600?Math.min(em.width-20,ef.width):ef.width,height:ef.height},minHeight:300,minWidth:em.width<=600?Math.min(300,em.width-20):300,maxWidth:em.width<=600?em.width-20:1200,maxHeight:em.width<=600?em.height-80:720,onResize:(e,n,i)=>{ey({width:i.offsetWidth,height:i.offsetHeight})},onResizeStop:(e,n,i)=>{ey({width:i.offsetWidth,height:i.offsetHeight})},style:{height:ef.height,width:em.width<=600?Math.min(em.width-20,ef.width):ef.width,transition:"height 0.05s ease-out",margin:em.width<=600?"10px auto":0},enable:{top:!1,right:em.width>600,bottom:em.width>600,left:!1,topRight:em.width>600,bottomRight:em.width>600,bottomLeft:!1,topLeft:!1},children:(0,t.jsxs)(S.Z,{elevation:3,sx:{width:"100%",height:"100%",position:"relative",boxSizing:"border-box",borderRadius:1,bgcolor:"background.paper",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:3},children:[(0,t.jsxs)(a.Z,{className:"drawer-handle",sx:{display:"flex",alignItems:"center",justifyContent:"space-between",bgcolor:"primary.main",color:"white",px:2,py:1,cursor:em.width<=600?"default":"move"},children:[(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center"},children:[em.width>600&&(0,t.jsx)(z.Z,{sx:{mr:1,fontSize:18}}),(0,t.jsx)(o.Z,{variant:em.width<=600?"subtitle2":"subtitle1",fontWeight:"bold",color:"white",noWrap:!0,sx:{maxWidth:em.width<=600?200:"none"},children:er&&"tenDoan"in er?er.tenDoan:"Th\xf4ng tin đ\xea điều"})]}),(0,t.jsx)(g.Z,{size:"small",onClick:eo,className:"cancel-drag",sx:{color:"white"},children:(0,t.jsx)(c.Z,{title:"Đ\xf3ng th\xf4ng tin",children:(0,t.jsx)(j.Z,{fontSize:"small"})})})]}),(0,t.jsx)(a.Z,{sx:{borderBottom:1,borderColor:"divider"},className:"cancel-drag",children:(0,t.jsxs)(L.Z,{value:ex,onChange:(e,n)=>{eg(n)},"aria-label":"Th\xf4ng tin đ\xea điều tabs",variant:"fullWidth",sx:{minHeight:{xs:40,sm:48},"& .MuiTab-root":{fontSize:{xs:12,sm:13},minHeight:{xs:40,sm:48},py:{xs:0,sm:1},fontWeight:"bold"}},children:[(0,t.jsx)(w.Z,{label:"Th\xf4ng số đ\xea",id:"dike-tab-0","aria-controls":"dike-tabpanel-0"}),(0,t.jsx)(w.Z,{label:"Biểu đồ mực nước",id:"dike-tab-1","aria-controls":"dike-tabpanel-1"}),(0,t.jsx)(w.Z,{label:"Ảnh & Bản vẽ",id:"dike-tab-2","aria-controls":"dike-tabpanel-2"})]})}),(0,t.jsxs)(a.Z,{sx:{flexGrow:1,overflow:"auto",height:"calc(100% - 96px)",display:"flex",flexDirection:"column"},children:[(0,t.jsx)(_,{value:ex,index:0,children:er&&"viTriTu"in er?(0,t.jsxs)(a.Z,{children:[(0,t.jsxs)(o.Z,{gutterBottom:!0,fontWeight:"bold",fontSize:"1rem",children:[er.tenDoan||"Chưa c\xf3 t\xean"," ",eT&&(0,t.jsxs)(o.Z,{variant:"caption",sx:{fontWeight:"normal"},children:["(",eT.lat.toFixed(6),", ",eT.lng.toFixed(6),")"]})]}),(0,t.jsx)(m.Z,{sx:{mb:2}}),(0,t.jsx)(a.Z,{sx:{width:"100%",overflowX:"auto","& table":{borderCollapse:"collapse",width:"100%"},"& th":{backgroundColor:"#f5f5f5",fontWeight:600,textAlign:"left",padding:"6px 8px",fontSize:em.width<=600?"0.7rem":"0.75rem",borderBottom:"1px solid #e0e0e0",width:"40%"},"& td":{padding:"6px 8px",fontSize:em.width<=600?"0.7rem":"0.75rem",borderBottom:"1px solid #e0e0e0"}},children:(0,t.jsx)("table",{children:(0,t.jsxs)("tbody",{children:[(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Tuyến đ\xea"}),(0,t.jsx)("td",{children:er.tenTuyenDe||"Chưa x\xe1c định"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Loại đ\xea"}),(0,t.jsx)("td",{children:er.loaiCongTrinh||"Chưa x\xe1c định"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Cấp đ\xea"}),(0,t.jsx)("td",{children:er.capDe||"Chưa x\xe1c định"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Địa danh"}),(0,t.jsx)("td",{children:er.diaDanh||"Chưa x\xe1c định"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Vị tr\xed từ"}),(0,t.jsxs)("td",{children:[null!==(Z=er.viTriTu)&&void 0!==Z?Z:0," m"]})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Vị tr\xed đến"}),(0,t.jsxs)("td",{children:[null!==(T=er.viTriDen)&&void 0!==T?T:0," m"]})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Chiều d\xe0i"}),(0,t.jsxs)("td",{children:[null!==(D=er.chieuDai)&&void 0!==D?D:0," m"]})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Cao tr\xecnh mặt đ\xea"}),(0,t.jsx)("td",{children:null!==(k=null===(n=er.matCat)||void 0===n?void 0:n.caoTrinhMatDe)&&void 0!==k?k:"---"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Cao tr\xecnh thiết kế"}),(0,t.jsx)("td",{children:null!==(N=null===(i=er.matCat)||void 0===i?void 0:i.caoTrinhThietKe)&&void 0!==N?N:"---"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Ch\xeanh cao"}),(0,t.jsx)("td",{children:null!==(J=null===(r=er.matCat)||void 0===r?void 0:r.chenhCao)&&void 0!==J?J:"---"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Bề rộng mặt đ\xea"}),(0,t.jsxs)("td",{children:[null!==(Q=null===(s=er.matCat)||void 0===s?void 0:s.beRongMatDe)&&void 0!==Q?Q:"---"," m"]})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"M\xe1i đ\xea ph\xeda s\xf4ng"}),(0,t.jsx)("td",{children:null!==(q=null===(d=er.matCat)||void 0===d?void 0:d.maiDePhiaSong)&&void 0!==q?q:"---"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"M\xe1i đ\xea ph\xeda đồng"}),(0,t.jsx)("td",{children:null!==(U=null===(h=er.matCat)||void 0===h?void 0:h.maiDePhiaDong)&&void 0!==U?U:"---"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Chiều cao đ\xea"}),(0,t.jsxs)("td",{children:[null!==(Y=null===(u=er.matCat)||void 0===u?void 0:u.chieuCaoDe)&&void 0!==Y?Y:"---"," m"]})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Chiều rộng cơ TL"}),(0,t.jsxs)("td",{children:[null!==($=null===(x=er.matCat)||void 0===x?void 0:x.chieuRongCoTL)&&void 0!==$?$:"---"," m"]})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Chiều rộng cơ HL"}),(0,t.jsxs)("td",{children:[null!==(ee=null===(p=er.matCat)||void 0===p?void 0:p.chieuRongCoHL)&&void 0!==ee?ee:"---"," m"]})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Đ\xe1nh gi\xe1"}),(0,t.jsx)("td",{children:(null===(b=er.matCat)||void 0===b?void 0:b.danhGia)||"Chưa đ\xe1nh gi\xe1"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Cao tr\xecnh mặt"}),(0,t.jsx)("td",{children:null!==(en=null===(v=er.deBoi)||void 0===v?void 0:v.caoTrinhMat)&&void 0!==en?en:"---"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Hệ số m\xe1i"}),(0,t.jsx)("td",{children:null!==(ei=null===(C=er.deBoi)||void 0===C?void 0:C.heSoMai)&&void 0!==ei?ei:"---"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Hiện trạng mặt đ\xea"}),(0,t.jsx)("td",{children:null!==(et=null===(f=er.deBoi)||void 0===f?void 0:f.hienTrangMatDe)&&void 0!==et?et:"---"})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Diện t\xedch được bảo vệ"}),(0,t.jsx)("td",{children:null!==(el=null===(y=er.deBoi)||void 0===y?void 0:y.dienTichDuocBaoVe)&&void 0!==el?el:"---"})]})]})})})]}):eT?(0,t.jsxs)(a.Z,{children:[(0,t.jsx)(o.Z,{variant:"subtitle2",fontWeight:"bold",gutterBottom:!0,children:"Tọa độ vị tr\xed được chọn"}),(0,t.jsxs)(o.Z,{variant:"body2",children:[(0,t.jsx)("b",{children:"Vĩ độ (Latitude):"})," ",eT.lat.toFixed(6)]}),(0,t.jsxs)(o.Z,{variant:"body2",children:[(0,t.jsx)("b",{children:"Kinh độ (Longitude):"})," ",eT.lng.toFixed(6)]})]}):(0,t.jsx)(o.Z,{variant:"body2",children:"Chọn đoạn đ\xea hoặc điểm tr\xean bản đồ để xem th\xf4ng tin."})}),(0,t.jsx)(_,{value:ex,index:1,children:(0,t.jsxs)(a.Z,{sx:{height:"100%"},children:[(0,t.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:(0,t.jsx)(o.Z,{variant:"subtitle1",fontWeight:"bold",children:"Biểu đồ mực nước s\xf4ng"})}),ed?(0,t.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,t.jsx)(K.Z,{size:30})}):(0,t.jsxs)(a.Z,{sx:{width:"100%",height:"calc(100% - 60px)",mt:2},children:[(0,t.jsx)(W.h,{width:"100%",height:em.width<=600?180:"100%",minHeight:180,children:(0,t.jsxs)(B.w,{data:ec,margin:{top:5,right:em.width<=600?10:30,left:em.width<=600?10:20,bottom:5},children:[(0,t.jsx)(O.q,{strokeDasharray:"3 3"}),(0,t.jsx)(V.K,{dataKey:"time",tick:{fontSize:em.width<=600?8:10},interval:em.width<=600?1:0,allowDuplicatedCategory:!1}),(0,t.jsx)(H.B,{domain:[Math.min(...F.map(e=>e.y))-.5,Math.max(...F.map(e=>e.y))+.5],allowDataOverflow:!0,tick:{fontSize:em.width<=600?8:10},width:em.width<=600?30:40,label:em.width<=600?void 0:{value:"H (m)",angle:-90,position:"insideLeft",style:{textAnchor:"middle",fontSize:12}}}),(0,t.jsx)(R.u,{cursor:{strokeDasharray:"3 3"},formatter:(e,n,i)=>{var l,a;if(null==e)return[null,null];let o=parseFloat(e),r=null!==(a=null==i?void 0:null===(l=i.payload)||void 0===l?void 0:l.isForecast)&&void 0!==a?a:"Dự b\xe1o"===n,s=(()=>{let e=[...F].sort((e,n)=>n.y-e.y);for(let n of e)if(o>n.y)return{text:"> ".concat(n.label," = +").concat((o-n.y).toFixed(2),"m"),color:n.color};let n=e[e.length-1];return{text:"< ".concat(n.label," = ").concat((n.y-o).toFixed(2),"m"),color:"#2196F3"}})(),d=s.text,h=s.color;return[(0,t.jsxs)("div",{style:{padding:"8px",backgroundColor:"white",borderRadius:8,boxShadow:"0 2px 10px rgba(0,0,0,0.2)",borderWidth:1,borderColor:"#e0e0e0"},children:[(0,t.jsxs)("div",{style:{fontSize:"14px",fontWeight:"bold",color:r?"#FF5722":"#2196F3",marginBottom:4},children:[r?"H dự b\xe1o":"H",": ",e,"m"]}),(0,t.jsx)("div",{style:{fontSize:"13px",color:h,fontWeight:"500"},children:d})]})]},labelFormatter:e=>"Thời gian: ".concat(e),contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #ccc",padding:"10px",borderRadius:"4px",boxShadow:"0 2px 5px rgba(0,0,0,0.15)"},wrapperStyle:{zIndex:1e3}}),(0,t.jsx)(A.D,{}),F.map(e=>(0,t.jsx)(E.d,{y:e.y,stroke:e.color,strokeWidth:1.5,strokeDasharray:"3 3",label:{value:"".concat(e.label," (").concat(e.y,"m)"),position:"insideBottomLeft",fill:e.color,fontSize:em.width<=600?8:10}},e.key)),(0,t.jsx)("defs",{children:(0,t.jsxs)("linearGradient",{id:"lineColor",x1:"0",y1:"0",x2:"1",y2:"0",children:[(0,t.jsx)("stop",{offset:"".concat(eS,"%"),stopColor:"#2196F3"}),(0,t.jsx)("stop",{offset:"".concat(eS,"%"),stopColor:"#ff0000ff"})]})}),(0,t.jsx)(X.x,{type:"monotone",dataKey:"value",label:"Mực nước (m)",stroke:"url(#lineColor)",strokeWidth:1,connectNulls:!0,dot:e=>{let{cx:n,cy:i,payload:l}=e;if("number"!=typeof n||"number"!=typeof i)return(0,t.jsx)("g",{});let a=null==l?void 0:l.isForecast;return(0,t.jsx)("circle",{cx:n,cy:i,r:2,fill:a?"#FF5722":"#2196F3",stroke:a?"#FF5722":"#2196F3"})}})]})}),(0,t.jsx)(o.Z,{variant:"caption",sx:{display:"block",textAlign:"center",mt:1,fontStyle:"italic",fontSize:em.width<=600?10:12},children:"Mực nước cập nhật theo thời gian thực v\xe0 dự b\xe1o 12 giờ tới"})]})]})}),(0,t.jsx)(_,{value:ex,index:2,children:(0,t.jsxs)(I.ZP,{container:!0,spacing:em.width<=600?1:2,children:[(0,t.jsxs)(I.ZP,{item:!0,xs:12,children:[(0,t.jsx)(o.Z,{variant:em.width<=600?"body2":"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"Ảnh đ\xea"}),(0,t.jsx)(a.Z,{sx:{width:"100%",height:em.width<=600?160:220,bgcolor:"#f5f5f5",borderRadius:1,mb:em.width<=600?2:3,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:(0,t.jsx)("img",{src:(null==er?void 0:er.anhDe)||"/images/de-placeholder.jpg",alt:"Ảnh đ\xea",style:{width:"100%",objectFit:"contain",maxHeight:em.width<=600?160:220}})})]}),(0,t.jsxs)(I.ZP,{item:!0,xs:12,children:[(0,t.jsx)(o.Z,{variant:em.width<=600?"body2":"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"Bản vẽ mặt cắt đ\xea"}),(0,t.jsx)(a.Z,{sx:{width:"100%",height:em.width<=600?180:240,bgcolor:"#f5f5f5",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:(0,t.jsx)("img",{src:(null==er?void 0:er.banVeMatCat)||"/images/matcat-placeholder.jpg",alt:"Bản vẽ mặt cắt đ\xea",style:{width:"100%",objectFit:"contain",maxHeight:em.width<=600?180:240}})})]})]})})]})]})})})})}):null},Q=i(12166),q=i(31925),U=i(47698),Y=i(85290),$=i(94094),ee=i(59021),en=e=>{let{visible:n,onToggle:i,onAddLayerClick:l,computedLegendData:r,expandedItems:s,toggleExpand:d,isItemChecked:h,handleItemCheckboxChange:u,handleCategoryCheckboxChange:x,getCategoryCheckboxState:m,handleToggleLayerLabelCategory:j,handleToggleLayerLabelItem:b,layerLabelState:v,processSvgIcon:C}=e;return n?(0,t.jsxs)(S.Z,{elevation:3,sx:{position:"absolute",top:10,right:10,zIndex:1e3,padding:2.25,borderRadius:2,minWidth:250,maxWidth:250},children:[(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1.75},children:[(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,t.jsx)(q.Z,{sx:{fontSize:18,mr:.75,color:"primary.main"}}),(0,t.jsx)(o.Z,{variant:"subtitle1",fontWeight:"bold",children:"Lớp bản đồ đ\xea điều"})]}),(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(g.Z,{size:"small",onClick:i,sx:{p:.5},children:(0,t.jsx)(U.Z,{fontSize:"small"})}),(0,t.jsx)(g.Z,{size:"small",onClick:l,sx:{p:.5},children:(0,t.jsx)(c.Z,{title:"Th\xeam lớp bản đồ mới",children:(0,t.jsx)("span",{style:{fontSize:18,color:"#1976d2"},children:"＋"})})})]})]}),(0,t.jsx)(a.Z,{sx:{mb:2},children:r.map(e=>Array.isArray(e.children)&&0!==e.children.length?(0,t.jsxs)(a.Z,{sx:{mb:1},children:[(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",py:.5,borderRadius:1,"&:hover":{bgcolor:"action.hover"}},children:[(0,t.jsx)(Q.Z,{checked:m(e).checked,indeterminate:m(e).indeterminate,onChange:()=>x(e),size:"small",sx:{p:0,mr:.5,"& .MuiSvgIcon-root":{fontSize:16}}}),(0,t.jsx)(a.Z,{sx:{display:"flex",alignItems:"center",flexGrow:1},children:(0,t.jsxs)(a.Z,{onClick:()=>{Array.isArray(e.children)&&e.children.length>0&&d(e.id)},sx:{display:"flex",alignItems:"center",cursor:Array.isArray(e.children)&&e.children.length>0?"pointer":"default",flexGrow:1},children:[s[e.id]?(0,t.jsx)(y.Z,{sx:{fontSize:16,mr:.5,color:"text.secondary"}}):(0,t.jsx)(ee.Z,{sx:{fontSize:16,mr:.5,color:"text.secondary"}}),(0,t.jsxs)(o.Z,{sx:{fontSize:"13px",fontWeight:600,color:"text.primary",mr:.5,opacity:m(e).checked||m(e).indeterminate?1:.5},children:[e.icon," ",e.label]}),(0,t.jsx)(g.Z,{size:"small",sx:{p:.5,ml:"auto"},onClick:()=>{j(e)},children:(0,t.jsx)(c.Z,{title:e.children.every(e=>{var n;return v[null===(n=e.data)||void 0===n?void 0:n.maLoai]})?"Ẩn nh\xe3n lớp":"Hiện nh\xe3n lớp",children:e.children.every(e=>{var n;return v[null===(n=e.data)||void 0===n?void 0:n.maLoai]})?(0,t.jsx)(Y.Z,{fontSize:"small",color:"error"}):(0,t.jsx)($.Z,{fontSize:"small",color:"primary"})})})]})})]}),(0,t.jsx)(p.Z,{in:s[e.id],timeout:"auto",unmountOnExit:!0,children:(0,t.jsx)(a.Z,{sx:{mt:.5},children:e.children.map((e,n)=>{var i,l;return(0,t.jsxs)(a.Z,{sx:{ml:2.5,mb:.75,py:.25,display:"flex",alignItems:"center"},children:[(0,t.jsx)(Q.Z,{checked:h(e),onChange:()=>u(e),size:"small",sx:{p:0,mr:1,"& .MuiSvgIcon-root":{fontSize:16}}}),e.icon?(0,t.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:20,height:20,marginRight:8,opacity:h(e)?1:.3},dangerouslySetInnerHTML:{__html:C(e.icon,e.color)}}):(0,t.jsx)(a.Z,{sx:{width:20,height:3,bgcolor:e.color||"#999",mr:1,borderRadius:.5,boxShadow:"0 1px 2px rgba(0,0,0,0.1)",opacity:h(e)?1:.3}}),(0,t.jsx)(o.Z,{sx:{fontSize:"12px",color:"text.primary",opacity:h(e)?1:.5},children:e.label}),(0,t.jsx)(g.Z,{size:"small",sx:{p:.5,ml:"auto"},onClick:()=>b(e),children:(0,t.jsx)(c.Z,{title:v[null===(i=e.data)||void 0===i?void 0:i.maLoai]?"Ẩn nh\xe3n":"Hiện nh\xe3n",children:v[null===(l=e.data)||void 0===l?void 0:l.maLoai]?(0,t.jsx)(Y.Z,{fontSize:"small",color:"error"}):(0,t.jsx)($.Z,{fontSize:"small",color:"primary"})})})]},e.id||n)})})})]},e.id):(0,t.jsx)(a.Z,{sx:{mb:1},children:(0,t.jsxs)(a.Z,{sx:{ml:0,mb:.5,py:.25,display:"flex",alignItems:"center"},children:[(0,t.jsx)(Q.Z,{checked:h(e),onChange:()=>u(e),size:"small",sx:{p:0,mr:1,"& .MuiSvgIcon-root":{fontSize:16}}}),e.icon?(0,t.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:20,height:20,marginRight:8,opacity:h(e)?1:.3},dangerouslySetInnerHTML:{__html:C(e.icon,e.data&&(e.data.maMau||"#3f51b5"))}}):(0,t.jsx)(a.Z,{sx:{width:20,height:3,bgcolor:e.data&&(e.data.maMau||"#999"),mr:1,borderRadius:.5,boxShadow:"0 1px 2px rgba(0,0,0,0.1)",opacity:h(e)?1:.3}}),(0,t.jsx)(o.Z,{sx:{fontSize:"12px",color:"text.primary",opacity:h(e)?1:.5},children:e.label}),(0,t.jsx)(g.Z,{size:"small",sx:{p:.5,ml:"auto"},onClick:()=>b(e),children:(0,t.jsx)(c.Z,{title:e.data&&e.data.maLoai?v[e.data.maLoai]?"Ẩn nh\xe3n":"Hiện nh\xe3n":"Kh\xf4ng c\xf3 maLoai",children:e.data&&e.data.maLoai?v[e.data.maLoai]?(0,t.jsx)(Y.Z,{fontSize:"small",color:"error"}):(0,t.jsx)($.Z,{fontSize:"small",color:"primary"}):(0,t.jsx)($.Z,{fontSize:"small",color:"disabled"})})})]})},e.id))})]}):null},ei=i(88196),et=i(92365),el=i(40110),ea=i(50333),eo=i(40492),er=i(96727),es=i(51015),ed=e=>{let{open:n,onClose:i,newLayer:l,setNewLayer:o,parentOptions:r,onSave:s}=e;return(0,t.jsxs)(ei.Z,{open:n,onClose:i,maxWidth:"sm",fullWidth:!0,children:[(0,t.jsx)(et.Z,{children:"Th\xeam lớp bản đồ mới"}),(0,t.jsx)(el.Z,{children:(0,t.jsxs)(a.Z,{component:"form",sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[(0,t.jsx)(ea.Z,{options:r,getOptionLabel:e=>e.tenLoai,value:l.idParrent&&r.find(e=>e.id===l.idParrent)||null,onChange:(e,n)=>o(e=>({...e,idParrent:(null==n?void 0:n.id)||""})),renderInput:e=>(0,t.jsx)(eo.Z,{...e,label:"Lớp cha (idParrent)",variant:"outlined"})}),(0,t.jsx)(eo.Z,{label:"M\xe3 loại",value:l.maLoai||"",onChange:e=>o(n=>({...n,maLoai:e.target.value})),variant:"outlined",fullWidth:!0}),(0,t.jsx)(eo.Z,{label:"T\xean loại",value:l.tenLoai||"",onChange:e=>o(n=>({...n,tenLoai:e.target.value})),variant:"outlined",fullWidth:!0,required:!0}),(0,t.jsx)(eo.Z,{label:"M\xe3 m\xe0u",type:"color",value:l.maMau||"#1976d2",onChange:e=>o(n=>({...n,maMau:e.target.value})),variant:"outlined",fullWidth:!0,InputLabelProps:{shrink:!0}}),(0,t.jsx)(eo.Z,{label:"Icon",value:l.icon||"",onChange:e=>o(n=>({...n,icon:e.target.value})),variant:"outlined",fullWidth:!0}),(0,t.jsx)(eo.Z,{label:"M\xf4 tả",value:l.moTa||"",onChange:e=>o(n=>({...n,moTa:e.target.value})),variant:"outlined",fullWidth:!0,multiline:!0,minRows:2})]})}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{onClick:i,children:"Hủy"}),(0,t.jsx)(es.Z,{variant:"contained",onClick:s,children:"Lưu"})]})]})},eh=i(22567),ec=i(60553),eu=i(44723),ex=i(90633),eg=i(24961),em=i(68963),ej=i(16855),ep=i(18708),eb=e=>{let{onClose:n,onSaveComplete:i,open:r,editCot:s}=e,[d,h]=(0,l.useState)(null),[c,u]=(0,l.useState)([]),[x,g]=(0,l.useState)({id:"",viTri:"",toaDo:"",loaiCot:""}),[,j]=(0,l.useState)(null),[p,b]=(0,l.useState)(!0),[v,C]=(0,l.useState)(!1),[f,y]=(0,l.useState)(null),[Z,T]=(0,l.useState)(null),[D,k]=(0,l.useState)(""),[S,L]=(0,l.useState)(""),[w,F]=(0,l.useState)([]),[z,N]=(0,l.useState)([]),[M,P]=(0,l.useState)([]),[W,B]=(0,l.useState)(0),[O,V]=(0,l.useState)("");(0,l.useEffect)(()=>{(async()=>{try{var e;let n=await ep.I.getAllTuyenDe({pageNumber:1,pageSize:1e3});F((null===(e=n.items)||void 0===e?void 0:e.map(e=>({id:e.id||"",tenTuyenDe:e.tenTuyenDe||""})))||[])}catch(e){y("Kh\xf4ng thể tải danh s\xe1ch tuyến đ\xea")}})()},[]),(0,l.useEffect)(()=>{(async()=>{if(!D){N([]),L("");return}try{var e;let n=await ep.I.getAllDoanDe({tuyenDeId:D,pageNumber:1,pageSize:1e3});N((null===(e=n.items)||void 0===e?void 0:e.map(e=>({id:e.id||"",tenDoanDe:e.tenDoan||""})))||[])}catch(e){y("Kh\xf4ng thể tải danh s\xe1ch đoạn đ\xea")}})()},[D]),(0,l.useEffect)(()=>{(async()=>{try{let e=await ep.I.getLoaiCongTrinhTree(),n=[];e.forEach(e=>{"CTPT"===e.maLoai&&e.children&&e.children.forEach(e=>{("COT_1_KM"===e.maLoai||"COT_5_KM"===e.maLoai)&&n.push({id:e.id,tenLoai:e.tenLoai})})}),P(n)}catch(e){y("Kh\xf4ng thể tải danh s\xe1ch loại cột")}})()},[]),(0,l.useEffect)(()=>{s&&r&&(g({id:s.id||"",viTri:s.viTri||"",toaDo:s.toaDo?JSON.stringify(s.toaDo):"",loaiCot:s.loaiCot||""}),b(!0),j(null)),r||(g({viTri:"",toaDo:"",loaiCot:""}),j(null))},[s,r]),(0,l.useEffect)(()=>{p||(k(""),L(""))},[p]);let H=e=>{let{name:n,value:i}=e.target;g(e=>({...e,[n]:i}))},R=async()=>{if(!x.viTri){y("Vị tr\xed kh\xf4ng được để trống");return}if(!O){y("Vui l\xf2ng chọn loại cột");return}C(!0),y(null),T(null);try{await ej.f.saveCotKM({...x,loaiCongTrinhId:O,tuyenDeId:D||void 0,doanDeId:S||void 0}),T("Lưu th\xe0nh c\xf4ng bản ghi cột km!"),g({viTri:"",toaDo:"",loaiCot:""}),V(""),k(""),L(""),setTimeout(()=>{i()},1500)}catch(e){y("Lỗi khi lưu bản ghi cột km. Vui l\xf2ng thử lại.")}finally{C(!1)}},A=async()=>{if(0===c.length){y("Kh\xf4ng c\xf3 dữ liệu để lưu");return}if(!O){y("Vui l\xf2ng chọn loại cột");return}C(!0),y(null),T(null);try{let e=c.length,n=0,t=[];for(let i of c)try{await ej.f.saveCotKM({...i,loaiCongTrinhId:O}),n++,B(Math.floor(n/e*100))}catch(e){t.push(i.viTri||"Kh\xf4ng t\xean")}0===t.length?T("Lưu th\xe0nh c\xf4ng ".concat(n," cột km")):(T("Đ\xe3 lưu ".concat(n,"/").concat(e," cột. C\xf3 ").concat(t.length," cột kh\xf4ng lưu được.")),y("C\xe1c cột lỗi: ".concat(t.join(", ")))),n>0&&setTimeout(()=>{i()},2e3)}catch(e){y("Lỗi khi lưu dữ liệu. Vui l\xf2ng thử lại.")}finally{C(!1)}};return(0,t.jsxs)(ei.Z,{open:r,onClose:v?void 0:n,maxWidth:"md",fullWidth:!0,children:[(0,t.jsx)(et.Z,{children:"Quản l\xfd cột km (th\xeam/sửa từng bản ghi hoặc nhập file GeoJSON)"}),(0,t.jsxs)(el.Z,{children:[Z&&(0,t.jsxs)(eu.Z,{severity:"success",sx:{mb:2},children:[(0,t.jsx)(ex.Z,{children:"Th\xe0nh c\xf4ng"}),Z]}),f&&(0,t.jsxs)(eu.Z,{severity:"error",sx:{mb:2},children:[(0,t.jsx)(ex.Z,{children:"Lỗi"}),f]}),v&&(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,t.jsx)(K.Z,{variant:"determinate",value:W,sx:{mr:2}}),(0,t.jsx)(o.Z,{variant:"body2",color:"text.secondary",children:"Đang lưu... %"})]}),(0,t.jsxs)(a.Z,{sx:{mb:3},children:[(0,t.jsx)(o.Z,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Bạn c\xf3 thể nhập từng cột km (ưu ti\xean) hoặc chuyển sang nhập file GeoJSON để th\xeam h\xe0ng loạt. File cần c\xf3 cấu tr\xfac FeatureCollection với c\xe1c Feature chứa th\xf4ng tin cột km."}),(0,t.jsxs)(a.Z,{sx:{display:"flex",gap:2,mb:2},children:[(0,t.jsx)(es.Z,{variant:p?"contained":"outlined",onClick:()=>b(!0),disabled:p||v,children:"Nhập từng cột"}),(0,t.jsx)(es.Z,{variant:p?"outlined":"contained",onClick:()=>b(!1),disabled:!p||v,children:"Import file GeoJSON"})]}),(0,t.jsxs)(I.ZP,{container:!0,spacing:4,sx:{mb:3},children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:4,children:(0,t.jsx)(ea.Z,{options:M,getOptionLabel:e=>e.tenLoai||"",isOptionEqualToValue:(e,n)=>e.id===n.id,value:M.find(e=>e.id===O)||null,onChange:(e,n)=>V(n?n.id:""),renderOption:(e,n)=>(0,l.createElement)("li",{...e,key:n.id},n.tenLoai),renderInput:e=>(0,t.jsx)(eo.Z,{...e,label:"Loại cột",placeholder:"-- Kh\xf4ng chọn --",margin:"dense",size:"small",fullWidth:!0}),disabled:v})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:4,children:(0,t.jsx)(ea.Z,{options:w,getOptionLabel:e=>e.tenTuyenDe||"",isOptionEqualToValue:(e,n)=>e.id===n.id,value:w.find(e=>e.id===D)||null,onChange:(e,n)=>k(n?n.id:""),renderOption:(e,n)=>(0,l.createElement)("li",{...e,key:n.id},n.tenTuyenDe),renderInput:e=>(0,t.jsx)(eo.Z,{...e,label:"Tuyến đ\xea",placeholder:"-- Kh\xf4ng chọn --",margin:"dense",size:"small",fullWidth:!0}),disabled:v||!p})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:4,children:(0,t.jsx)(ea.Z,{options:z,getOptionLabel:e=>e.tenDoanDe||"",isOptionEqualToValue:(e,n)=>e.id===n.id,value:z.find(e=>e.id===S)||null,onChange:(e,n)=>L(n?n.id:""),renderOption:(e,n)=>(0,l.createElement)("li",{...e,key:n.id},n.tenDoanDe),renderInput:e=>(0,t.jsx)(eo.Z,{...e,label:"Đoạn đ\xea",placeholder:"-- Kh\xf4ng chọn --",margin:"dense",size:"small",fullWidth:!0}),disabled:v||!p||!D})})]}),p&&(0,t.jsxs)(a.Z,{sx:{mb:3,p:2,border:"1px solid #eee",borderRadius:2},children:[(0,t.jsx)(m.Z,{textAlign:"center",children:"Th\xf4ng tin cột km"}),(0,t.jsxs)(I.ZP,{container:!0,spacing:4,sx:{mt:2},children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:12,children:(0,t.jsx)(eo.Z,{name:"viTri",label:"Vị tr\xed",value:x.viTri,onChange:H,variant:"outlined",fullWidth:!0,size:"small",disabled:v,InputLabelProps:{shrink:!0}})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{name:"toaDo",label:"Toạ độ (GeoJSON geometry object)",value:x.toaDo,onChange:H,variant:"outlined",fullWidth:!0,size:"small",disabled:v,multiline:!0,minRows:2,InputLabelProps:{shrink:!0}})})]})]}),!p&&(0,t.jsxs)(a.Z,{sx:{border:"1px dashed #ccc",p:3,my:3,textAlign:"center",borderRadius:1},children:[(0,t.jsxs)(es.Z,{variant:"contained",component:"label",startIcon:(0,t.jsx)(eg.Z,{}),disabled:v,children:["Chọn file GeoJSON",(0,t.jsx)("input",{type:"file",hidden:!0,accept:".geojson,.json",onChange:e=>{var n;let i=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!i)return;h(i),y(null);let t=new FileReader;t.onload=async e=>{try{var n;let i=JSON.parse(null===(n=e.target)||void 0===n?void 0:n.result);if(!i.type||"FeatureCollection"!==i.type||!i.features){y("File kh\xf4ng phải l\xe0 GeoJSON FeatureCollection hợp lệ");return}let t=i.features.map((e,n)=>{var i,t,l,a,o,r,s,d,h,c,u;let x=(null===(i=e.properties)||void 0===i?void 0:i.Ten_tuyen)||(null===(t=e.properties)||void 0===t?void 0:t.tenTuyenDe)||"";x||(x=(null===(h=e.properties)||void 0===h?void 0:h.name)||(null===(c=e.properties)||void 0===c?void 0:c.tuyen)||(null===(u=e.properties)||void 0===u?void 0:u.tuyenDe)||""),x.includes("(")&&(x=x.split("(")[0].trim());let g="";if(x&&w.length>0){let e=w.find(e=>e.tenTuyenDe.trim().toLowerCase()===x.trim().toLowerCase());e&&(g=e.id)}return{id:(null===(l=e.properties)||void 0===l?void 0:l.id)||"",viTri:(null===(a=e.properties)||void 0===a?void 0:a.Vitri_Km)||(null===(o=e.properties)||void 0===o?void 0:o.viTri)||"",toaDo:e.type&&e.geometry?{type:e.type,geometry:e.geometry}:void 0,tuyenDeId:g,tenTuyenDe:x,doanDeId:(null===(r=e.properties)||void 0===r?void 0:r.doanDeId)||"",tenDoanDe:(null===(s=e.properties)||void 0===s?void 0:s.tenDoanDe)||"",ngayTao:(null===(d=e.properties)||void 0===d?void 0:d.ngayTao)||"",stt:n+1}});u(t)}catch(e){y("Kh\xf4ng thể đọc file GeoJSON. Kiểm tra định dạng file.")}},t.readAsText(i)}})]}),d&&(0,t.jsxs)(o.Z,{variant:"body2",sx:{display:"flex",alignItems:"center"},children:[d.name," (",(d.size/1024).toFixed(1)," KB)"]})]}),c.length>0&&(0,t.jsxs)(a.Z,{sx:{mt:3},children:[(0,t.jsx)(o.Z,{variant:"subtitle2",sx:{mb:1},children:"Danh s\xe1ch cột km import"}),(0,t.jsx)(a.Z,{sx:{border:"1px solid #eee",borderRadius:2,overflow:"auto"},children:(0,t.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{style:{background:"#f5f5f5"},children:[(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"STT"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"Vị tr\xed KM"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"T\xean tuyến"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"Kiểu dữ liệu"})]})}),(0,t.jsx)("tbody",{children:c.map((e,n)=>{var i,l;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd",textAlign:"center"},children:e.stt}),(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd"},children:e.viTri}),(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd"},children:e.tuyenDeId?" ".concat(e.tenTuyenDe):""}),(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd"},children:null===(l=e.toaDo)||void 0===l?void 0:null===(i=l.geometry)||void 0===i?void 0:i.type})]},n)})})]})})]})]})]}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{onClick:()=>{h(null),u([]),g({viTri:"",toaDo:"",loaiCot:""}),j(null),y(null),T(null),B(0)},disabled:v||0===c.length&&!d,children:"X\xf3a"}),(0,t.jsx)(es.Z,{onClick:n,disabled:v,children:"Đ\xf3ng"}),(0,t.jsx)(es.Z,{onClick:()=>{p&&0===c.length?R():A()},variant:"contained",color:"primary",disabled:v||!O||(p?!x.viTri:0===c.length),startIcon:v?(0,t.jsx)(K.Z,{size:20}):(0,t.jsx)(em.Z,{}),children:v?"Đang lưu...":"Lưu"})]})]})},ev=i(48568);let eC="CUA_KHAU";var ef=e=>{var n,i;let{onClose:r,onSaveComplete:s,open:d,editCuaKhau:h}=e,[c,u]=(0,l.useState)(null),[x,g]=(0,l.useState)([]),[j,p]=(0,l.useState)({tenCuaKhau:"",diaDiem:"",toaDo:"",kichThuoc:void 0,caoTrinhDinh:void 0,caoTrinhNen:void 0,vatLieu:"",coCuaDong:!1,coVanHanhTuDong:!1,ghiChu:"",maLoaiCongTrinh:eC,loaiCongTrinhId:""}),[b,v]=(0,l.useState)(!0),[C,f]=(0,l.useState)(!1),[y,Z]=(0,l.useState)(null),[T,D]=(0,l.useState)(null),[k,S]=(0,l.useState)(0),[L,w]=(0,l.useState)("");(0,l.useEffect)(()=>{(async()=>{try{let e=(await ep.I.getLoaiCongTrinhTree()).find(e=>e.maLoai===eC);e&&w(e.id)}catch(e){Z("Kh\xf4ng thể tải danh s\xe1ch loại c\xf4ng tr\xecnh")}})()},[]),(0,l.useEffect)(()=>{h&&d&&(p({...h,maLoaiCongTrinh:eC,loaiCongTrinhId:h.loaiCongTrinhId||L}),v(!0)),d||p({tenCuaKhau:"",diaDiem:"",toaDo:"",kichThuoc:void 0,caoTrinhDinh:void 0,caoTrinhNen:void 0,vatLieu:"",coCuaDong:!1,coVanHanhTuDong:!1,ghiChu:"",maLoaiCongTrinh:eC,loaiCongTrinhId:L})},[h,d,L]);let F=e=>{let{name:n,value:i,type:t,checked:l}=e.target;p(e=>({...e,[n]:"checkbox"===t?l:i}))},z=async()=>{if(!j.tenCuaKhau){Z("T\xean cửa khẩu kh\xf4ng được để trống");return}f(!0),Z(null),D(null);try{let e=j.toaDo;if("string"==typeof e&&e)try{e=JSON.parse(e)}catch(n){e=null}await ev.s.saveCuaKhau({...j,maLoaiCongTrinh:eC,loaiCongTrinhId:j.loaiCongTrinhId||L,toaDo:e}),D("Lưu th\xe0nh c\xf4ng bản ghi cửa khẩu!"),p({tenCuaKhau:"",diaDiem:"",toaDo:"",kichThuoc:void 0,caoTrinhDinh:void 0,caoTrinhNen:void 0,vatLieu:"",coCuaDong:!1,coVanHanhTuDong:!1,ghiChu:"",maLoaiCongTrinh:eC,loaiCongTrinhId:L}),setTimeout(()=>{s()},1500)}catch(e){Z("Lỗi khi lưu bản ghi cửa khẩu. Vui l\xf2ng thử lại.")}finally{f(!1)}},N=async()=>{if(0===x.length){Z("Kh\xf4ng c\xf3 dữ liệu để lưu");return}f(!0),Z(null),D(null);try{let e=x.length,n=0,i=[];for(let t of x){let l=t.toaDo;if("string"==typeof l&&l)try{l=JSON.parse(l)}catch(e){l=null}try{await ev.s.saveCuaKhau({...t,maLoaiCongTrinh:eC,loaiCongTrinhId:t.loaiCongTrinhId||L,toaDo:l}),n++,S(Math.floor(n/e*100))}catch(e){i.push(t.tenCuaKhau||"Kh\xf4ng t\xean")}}0===i.length?D("Lưu th\xe0nh c\xf4ng ".concat(n," cửa khẩu")):(D("Đ\xe3 lưu ".concat(n,"/").concat(e," cửa khẩu. C\xf3 ").concat(i.length," cửa khẩu kh\xf4ng lưu được.")),Z("C\xe1c cửa khẩu lỗi: ".concat(i.join(", ")))),n>0&&setTimeout(()=>{s()},2e3)}catch(e){Z("Lỗi khi lưu dữ liệu. Vui l\xf2ng thử lại.")}finally{f(!1)}};return(0,t.jsxs)(ei.Z,{open:d,onClose:C?void 0:r,maxWidth:"md",fullWidth:!0,children:[(0,t.jsx)(et.Z,{children:"Quản l\xfd cửa khẩu (th\xeam/sửa từng bản ghi hoặc nhập file GeoJSON)"}),(0,t.jsxs)(el.Z,{children:[T&&(0,t.jsxs)(eu.Z,{severity:"success",sx:{mb:2},children:[(0,t.jsx)(ex.Z,{children:"Th\xe0nh c\xf4ng"}),T]}),y&&(0,t.jsxs)(eu.Z,{severity:"error",sx:{mb:2},children:[(0,t.jsx)(ex.Z,{children:"Lỗi"}),y]}),C&&(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,t.jsx)(K.Z,{variant:"determinate",value:k,sx:{mr:2}}),(0,t.jsxs)(o.Z,{variant:"body2",color:"text.secondary",children:["Đang lưu... ",k,"%"]})]}),(0,t.jsxs)(a.Z,{sx:{mb:3},children:[(0,t.jsx)(o.Z,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Bạn c\xf3 thể nhập từng cửa khẩu hoặc chuyển sang nhập file GeoJSON để th\xeam h\xe0ng loạt. File cần c\xf3 cấu tr\xfac FeatureCollection với c\xe1c Feature chứa th\xf4ng tin cửa khẩu."}),(0,t.jsxs)(a.Z,{sx:{display:"flex",gap:2,mb:2},children:[(0,t.jsx)(es.Z,{variant:b?"contained":"outlined",onClick:()=>v(!0),disabled:b||C,children:"Nhập từng cửa khẩu"}),(0,t.jsx)(es.Z,{variant:b?"outlined":"contained",onClick:()=>v(!1),disabled:!b||C,children:"Import file GeoJSON"})]}),b&&(0,t.jsxs)(a.Z,{sx:{mb:3,p:2,border:"1px solid #eee",borderRadius:2},children:[(0,t.jsx)(m.Z,{textAlign:"center",children:"Th\xf4ng tin cửa khẩu"}),(0,t.jsxs)(I.ZP,{container:!0,spacing:4,sx:{mt:2},children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{name:"tenCuaKhau",label:"T\xean cửa khẩu",value:j.tenCuaKhau,onChange:F,variant:"outlined",fullWidth:!0,size:"small",disabled:C,InputLabelProps:{shrink:!0}})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{name:"diaDiem",label:"Địa điểm",value:j.diaDiem,onChange:F,variant:"outlined",fullWidth:!0,size:"small",disabled:C,InputLabelProps:{shrink:!0}})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{name:"toaDo",label:"Toạ độ (GeoJSON Feature object)",value:j.toaDo,onChange:F,variant:"outlined",fullWidth:!0,size:"small",disabled:C,multiline:!0,minRows:2,InputLabelProps:{shrink:!0}})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{name:"kichThuoc",label:"K\xedch thước (m)",value:null!==(n=j.kichThuoc)&&void 0!==n?n:"",onChange:F,type:"number",variant:"outlined",fullWidth:!0,size:"small",disabled:C,InputLabelProps:{shrink:!0}})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{name:"caoTrinhDinh",label:"Cao tr\xecnh đỉnh",value:null!==(i=j.caoTrinhDinh)&&void 0!==i?i:"",onChange:F,type:"number",variant:"outlined",fullWidth:!0,size:"small",disabled:C,InputLabelProps:{shrink:!0}})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{name:"vatLieu",label:"Vật liệu",value:j.vatLieu,onChange:F,variant:"outlined",fullWidth:!0,size:"small",disabled:C,InputLabelProps:{shrink:!0}})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{name:"ghiChu",label:"Ghi ch\xfa",value:j.ghiChu,onChange:F,variant:"outlined",fullWidth:!0,size:"small",disabled:C,InputLabelProps:{shrink:!0}})})]})]}),!b&&(0,t.jsxs)(a.Z,{sx:{border:"1px dashed #ccc",p:3,my:3,textAlign:"center",borderRadius:1},children:[(0,t.jsxs)(es.Z,{variant:"contained",component:"label",startIcon:(0,t.jsx)(eg.Z,{}),disabled:C,children:["Chọn file GeoJSON",(0,t.jsx)("input",{type:"file",hidden:!0,accept:".geojson,.json",onChange:e=>{var n;let i=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!i)return;u(i),Z(null);let t=new FileReader;t.onload=e=>{try{var n;let i=JSON.parse(null===(n=e.target)||void 0===n?void 0:n.result);if(!i.type||"FeatureCollection"!==i.type||!i.features){Z("File kh\xf4ng phải l\xe0 GeoJSON FeatureCollection hợp lệ");return}let t=i.features.map((e,n)=>{var i,t,l,a,o,r;let s=e;if("string"==typeof s)try{s=JSON.parse(s)}catch(e){s=null}return{tenCuaKhau:(null===(i=e.properties)||void 0===i?void 0:i.Ten_CK)||"Cửa khẩu ".concat(n+1),diaDiem:(null===(t=e.properties)||void 0===t?void 0:t.Vitri_DiaLy)||"",toaDo:s,kichThuoc:(null===(l=e.properties)||void 0===l?void 0:l.Chieu_rong)||void 0,caoTrinhDinh:(null===(a=e.properties)||void 0===a?void 0:a.Cao_trinhday)||void 0,vatLieu:(null===(o=e.properties)||void 0===o?void 0:o.Ket_cau)||"",coCuaDong:!1,coVanHanhTuDong:!1,ghiChu:(null===(r=e.properties)||void 0===r?void 0:r.Hien_trang)||"",maLoaiCongTrinh:eC,loaiCongTrinhId:L}});g(t)}catch(e){Z("Kh\xf4ng thể đọc file GeoJSON. Kiểm tra định dạng file.")}},t.readAsText(i)}})]}),c&&(0,t.jsxs)(o.Z,{variant:"body2",sx:{display:"flex",alignItems:"center"},children:[c.name," (",(c.size/1024).toFixed(1)," KB)"]})]}),x.length>0&&(0,t.jsxs)(a.Z,{sx:{mt:3},children:[(0,t.jsxs)(o.Z,{variant:"subtitle2",sx:{mb:1},children:["Xem trước dữ liệu (",x.length," cửa khẩu)"]}),(0,t.jsx)(a.Z,{sx:{border:"1px solid #eee",borderRadius:2,overflow:"auto"},children:(0,t.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{style:{background:"#f5f5f5"},children:[(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"STT"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"T\xean cửa khẩu"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"Địa điểm"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"K\xedch thước"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"Vật liệu"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"Ghi ch\xfa"})]})}),(0,t.jsx)("tbody",{children:x.map((e,n)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd",textAlign:"center"},children:n+1}),(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd"},children:e.tenCuaKhau}),(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd"},children:e.diaDiem}),(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd"},children:e.kichThuoc}),(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd"},children:e.vatLieu}),(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd"},children:e.ghiChu})]},n))})]})})]})]})]}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{onClick:()=>{u(null),g([]),p({tenCuaKhau:"",diaDiem:"",toaDo:"",kichThuoc:void 0,caoTrinhDinh:void 0,caoTrinhNen:void 0,vatLieu:"",coCuaDong:!1,coVanHanhTuDong:!1,ghiChu:"",maLoaiCongTrinh:eC,loaiCongTrinhId:L}),Z(null),D(null),S(0)},disabled:C||0===x.length&&!c,children:"X\xf3a"}),(0,t.jsx)(es.Z,{onClick:r,disabled:C,children:"Đ\xf3ng"}),(0,t.jsx)(es.Z,{onClick:()=>{b&&0===x.length?z():N()},variant:"contained",color:"primary",disabled:C||(b?!j.tenCuaKhau:0===x.length),startIcon:C?(0,t.jsx)(K.Z,{size:20}):(0,t.jsx)(em.Z,{}),children:C?"Đang lưu...":"Lưu"})]})]})},ey=i(25026),eZ=i(76592),eT=i(70360),eD=i(46577),ek=i(8863),eS=i(19827),eL=i(21773),ew=i(61756);let eK="KHO_VAT_TU";var eI=e=>{let{onClose:n,onSaveComplete:i,open:r,editKhoVatTu:s}=e,[d,h]=(0,l.useState)(null),[c,u]=(0,l.useState)([]),[x,g]=(0,l.useState)({tenKho:"",loaiKho:"",viTriKM:"",kichThuoc:"",ketCau:"",toaDo:"",vatTu:"",namXD:"",moTa:"",maLoaiCongTrinh:eK,loaiCongTrinhId:"",tuyenDeId:null,tenTuyenDe:"",doanDeId:null,tenDoanDe:""}),[,m]=(0,l.useState)(!0),[j,p]=(0,l.useState)(!1),[b,v]=(0,l.useState)(null),[C,f]=(0,l.useState)(null),[y,Z]=(0,l.useState)(0),[T,D]=(0,l.useState)(""),[k,F]=(0,l.useState)([]),[z,N]=(0,l.useState)([]),[M,P]=(0,l.useState)(0);(0,l.useEffect)(()=>{let e=async()=>{try{let e=(await (await ep.I.getAllLoaiCongTrinh(1,1e3)).items).find(e=>e.maLoai===eK);e&&(D(e.id),g(n=>({...n,loaiCongTrinhId:e.id,maLoaiCongTrinh:eK})))}catch(e){v("Kh\xf4ng thể tải danh s\xe1ch loại c\xf4ng tr\xecnh")}},n=async()=>{try{let e=await ep.I.getAllTuyenDe({pageNumber:1,pageSize:1e3});e&&e.items&&F(e.items)}catch(e){console.error("Lỗi khi tải danh s\xe1ch tuyến đ\xea:",e)}};r&&(e(),n())},[r]),(0,l.useEffect)(()=>{(async()=>{if(x.tuyenDeId)try{let e=await ep.I.getAllDoanDe({tuyenDeId:x.tuyenDeId,pageNumber:1,pageSize:1e3});e&&e.items&&N(e.items)}catch(e){console.error("Lỗi khi tải danh s\xe1ch đoạn đ\xea:",e)}else N([])})()},[x.tuyenDeId]),(0,l.useEffect)(()=>{s&&r&&(g({...s,maLoaiCongTrinh:eK,loaiCongTrinhId:s.loaiCongTrinhId||T}),m(!0)),r||g({tenKho:"",loaiKho:"",viTriKM:"",kichThuoc:"",ketCau:"",toaDo:"",vatTu:"",namXD:"",moTa:"",maLoaiCongTrinh:eK,loaiCongTrinhId:T,tuyenDeId:null,tenTuyenDe:"",doanDeId:null,tenDoanDe:""})},[s,r,T]);let W=e=>{let{name:n,value:i,type:t,checked:l}=e.target;g(e=>({...e,[n]:"checkbox"===t?l:i}))},B=async()=>{if(!x.tenKho){v("T\xean kho vật tư kh\xf4ng được để trống");return}if(!x.loaiKho){v("Loại kho kh\xf4ng được để trống");return}p(!0),v(null),f(null);try{let e=x.toaDo;if("string"==typeof e&&e)try{e=JSON.parse(e)}catch(n){e=null}await ew.d.saveKhoVatTu({...x,maLoaiCongTrinh:eK,loaiCongTrinhId:x.loaiCongTrinhId||T,toaDo:e}),f("Lưu th\xe0nh c\xf4ng bản ghi kho vật tư!"),g({tenKho:"",loaiKho:"",viTriKM:"",kichThuoc:"",ketCau:"",toaDo:"",vatTu:"",namXD:"",moTa:"",maLoaiCongTrinh:eK,loaiCongTrinhId:T,tuyenDeId:null,tenTuyenDe:"",doanDeId:null,tenDoanDe:""}),setTimeout(()=>{i()},1500)}catch(e){v("Lỗi khi lưu bản ghi kho vật tư. Vui l\xf2ng thử lại.")}finally{p(!1)}},O=async()=>{if(0===c.length){v("Kh\xf4ng c\xf3 dữ liệu để lưu");return}let e=c.filter(e=>!e.tenKho||!e.loaiKho);if(e.length>0){v("C\xf3 ".concat(e.length," bản ghi thiếu th\xf4ng tin t\xean kho hoặc loại kho. Vui l\xf2ng kiểm tra lại dữ liệu."));return}p(!0),v(null),f(null);try{let e=c.length,n=0,t=[];for(let i of c){let l=i.toaDo;if("string"==typeof l&&l)try{l=JSON.parse(l)}catch(e){l=null}try{await ew.d.saveKhoVatTu({...i,maLoaiCongTrinh:eK,loaiCongTrinhId:i.loaiCongTrinhId||T,toaDo:l}),n++,Z(Math.floor(n/e*100))}catch(e){t.push(i.tenKho||"Kh\xf4ng t\xean")}}0===t.length?f("Lưu th\xe0nh c\xf4ng ".concat(n," kho vật tư")):(f("Đ\xe3 lưu ".concat(n,"/").concat(e," kho vật tư. C\xf3 ").concat(t.length," kho vật tư kh\xf4ng lưu được.")),v("C\xe1c kho vật tư lỗi: ".concat(t.join(", ")))),n>0&&setTimeout(()=>{i()},2e3)}catch(e){v("Lỗi khi lưu dữ liệu. Vui l\xf2ng thử lại.")}finally{p(!1),u([])}};return(0,t.jsxs)(ei.Z,{open:r,onClose:j?void 0:n,maxWidth:"md",fullWidth:!0,children:[(0,t.jsx)(et.Z,{children:"Quản l\xfd kho vật tư (th\xeam/sửa từng bản ghi hoặc nhập file GeoJSON)"}),(0,t.jsxs)(el.Z,{children:[C&&(0,t.jsxs)(eu.Z,{severity:"success",sx:{mb:2},children:[(0,t.jsx)(ex.Z,{children:"Th\xe0nh c\xf4ng"}),C]}),b&&(0,t.jsxs)(eu.Z,{severity:"error",sx:{mb:2},children:[(0,t.jsx)(ex.Z,{children:"Lỗi"}),b]}),j&&(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,t.jsx)(K.Z,{variant:"determinate",value:y,sx:{mr:2}}),(0,t.jsxs)(o.Z,{variant:"body2",color:"text.secondary",children:["Đang lưu... ",y,"%"]})]}),(0,t.jsxs)(a.Z,{sx:{mb:3},children:[(0,t.jsx)(o.Z,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Bạn c\xf3 thể nhập từng kho vật tư hoặc chuyển sang nhập file GeoJSON để th\xeam h\xe0ng loạt. File cần c\xf3 cấu tr\xfac FeatureCollection với c\xe1c Feature chứa th\xf4ng tin kho vật tư."}),(0,t.jsxs)(L.Z,{value:M,onChange:(e,n)=>{P(n),m(0===n)},"aria-label":"import tabs",sx:{mb:2},children:[(0,t.jsx)(w.Z,{label:"Nhập thủ c\xf4ng"}),(0,t.jsx)(w.Z,{label:"Nhập từ file GeoJSON"})]}),0===M&&(0,t.jsx)(a.Z,{children:(0,t.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{label:"T\xean kho vật tư",name:"tenKho",value:x.tenKho||"",onChange:W,fullWidth:!0,margin:"dense",required:!0,size:"small"})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(ea.Z,{options:["Nh\xe0 kho v\xe0 b\xe3i","Nh\xe0 kho","B\xe3i"],value:x.loaiKho||null,onChange:(e,n)=>{g(e=>({...e,loaiKho:n||""}))},renderOption:(e,n)=>(0,l.createElement)("li",{...e,key:n},n),renderInput:e=>(0,t.jsx)(eo.Z,{...e,label:"Loại kho",placeholder:"-- Chọn loại kho --",margin:"dense",size:"small",fullWidth:!0,helperText:"Nh\xe0 kho: k\xedn, c\xf3 m\xe1i; B\xe3i: hở, ngo\xe0i trời; Nh\xe0 kho v\xe0 b\xe3i: cả hai loại"}),disabled:j})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{label:"Vị tr\xed KM",name:"viTriKM",value:x.viTriKM||"",onChange:W,fullWidth:!0,margin:"dense",size:"small"})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{label:"K\xedch thước",name:"kichThuoc",value:x.kichThuoc||"",onChange:W,fullWidth:!0,margin:"dense",size:"small"})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{label:"Kết cấu",name:"ketCau",value:x.ketCau||"",onChange:W,fullWidth:!0,margin:"dense",size:"small"})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{label:"Vật tư",name:"vatTu",value:x.vatTu||"",onChange:W,fullWidth:!0,margin:"dense",size:"small"})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{label:"Năm x\xe2y dựng",name:"namXD",value:x.namXD||"",onChange:W,fullWidth:!0,margin:"dense",size:"small"})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(ea.Z,{options:k,getOptionLabel:e=>e.tenTuyenDe||"",isOptionEqualToValue:(e,n)=>e.id===n.id,value:k.find(e=>e.id===x.tuyenDeId)||null,onChange:(e,n)=>{g(e=>({...e,tuyenDeId:n?n.id:"",tenTuyenDe:n?n.tenTuyenDe:"",doanDeId:null,tenDoanDe:""}))},renderOption:(e,n)=>(0,l.createElement)("li",{...e,key:n.id},n.tenTuyenDe),renderInput:e=>(0,t.jsx)(eo.Z,{...e,label:"Tuyến đ\xea",placeholder:"-- Kh\xf4ng chọn --",margin:"dense",size:"small",fullWidth:!0}),disabled:j})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(ea.Z,{options:z,getOptionLabel:e=>e.tenDoan||"",isOptionEqualToValue:(e,n)=>e.id===n.id,value:z.find(e=>e.id===x.doanDeId)||null,onChange:(e,n)=>{g(e=>({...e,doanDeId:n?n.id:"",tenDoan:n?n.tenDoan:""}))},renderOption:(e,n)=>(0,l.createElement)("li",{...e,key:n.id},n.tenDoan),renderInput:e=>(0,t.jsx)(eo.Z,{...e,label:"Đoạn đ\xea",placeholder:"-- Kh\xf4ng chọn --",margin:"dense",size:"small",fullWidth:!0}),disabled:j||!x.tuyenDeId})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{label:"Tọa độ (GeoJSON)",name:"toaDo",value:x.toaDo||"",onChange:W,multiline:!0,rows:4,fullWidth:!0,margin:"dense",size:"small",helperText:"Nhập dữ liệu tọa độ dạng GeoJSON hoặc để trống nếu th\xeam bằng c\xf4ng cụ tr\xean bản đồ"})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{label:"M\xf4 tả",name:"moTa",value:x.moTa||"",onChange:W,multiline:!0,rows:2,fullWidth:!0,margin:"dense",size:"small"})})]})}),1===M&&(0,t.jsxs)(a.Z,{sx:{border:"1px dashed #ccc",p:3,textAlign:"center",borderRadius:1},children:[(0,t.jsx)("input",{accept:".geojson,.json",style:{display:"none"},id:"raised-button-file",type:"file",onChange:e=>{var n;let i=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!i)return;h(i),v(null);let t=new FileReader;t.onload=e=>{try{var n;let i=JSON.parse(null===(n=e.target)||void 0===n?void 0:n.result);if(!i.type||"FeatureCollection"!==i.type||!i.features){v("File kh\xf4ng phải l\xe0 GeoJSON FeatureCollection hợp lệ");return}let t=i.features.map((e,n)=>{var i,t,l,a,o,r,s,d,h,c,u;let x=e;if("string"==typeof x)try{x=JSON.parse(x)}catch(e){}let g=(null===(i=e.properties)||void 0===i?void 0:i.Thuoc_Tde)||"",m=k.find(e=>e.tenTuyenDe===g),j=(null===(t=e.properties)||void 0===t?void 0:t.Loai_kho)||"",p=j.toLowerCase().includes("k\xedn")||j.toLowerCase().includes("kho k\xedn")||j.toLowerCase().includes("nh\xe0 kho")||"nh\xe0"===j.toLowerCase()||j.toLowerCase().includes("m\xe1i bằng")||j.toLowerCase().includes("nh\xe0 gạch"),b=j.toLowerCase().includes("hở")||j.toLowerCase().includes("kho hở")||"b\xe3i"===j.toLowerCase()||j.toLowerCase().includes("ngo\xe0i trời"),v=p&&b||j.includes(";")||j.includes("v\xe0")||j.toLowerCase().includes("nh\xe0 kho v\xe0 b\xe3i")||j.toLowerCase().includes("nh\xe0 gạch m\xe1i bằng + b\xe3i"),C={tenKho:(null===(l=e.properties)||void 0===l?void 0:l.Ten_kho)||"Kho vật tư ".concat(n+1),viTriKM:(null===(a=e.properties)||void 0===a?void 0:a.Vitri_Km)||"",kichThuoc:(null===(r=e.properties)||void 0===r?void 0:null===(o=r.Kich_thuoc)||void 0===o?void 0:o.toString())||"",ketCau:(null===(s=e.properties)||void 0===s?void 0:s.Ket_cau)||"",toaDo:x,vatTu:(null===(d=e.properties)||void 0===d?void 0:d.CLoai_vattu)||"",namXD:(null===(h=e.properties)||void 0===h?void 0:h.Nam_XD)||"",moTa:(null===(c=e.properties)||void 0===c?void 0:c.Vitri_DiaLy)||(null===(u=e.properties)||void 0===u?void 0:u.Thuoc_huyen)||"",maLoaiCongTrinh:eK,loaiCongTrinhId:T,tuyenDeId:(null==m?void 0:m.id)||null,tenTuyenDe:g,doanDeId:null,tenDoanDe:""},f="Nh\xe0 kho";return"Nh\xe0 kho v\xe0 b\xe3i"===j||"Nh\xe0 kho"===j||"B\xe3i"===j?f=j:v?f="Nh\xe0 kho v\xe0 b\xe3i":p?f="Nh\xe0 kho":b&&(f="B\xe3i"),{...C,loaiKho:f}});u(t)}catch(e){v("Kh\xf4ng thể đọc file GeoJSON. Kiểm tra định dạng file.")}},t.readAsText(i)}}),(0,t.jsx)("label",{htmlFor:"raised-button-file",children:(0,t.jsx)(es.Z,{variant:"contained",component:"span",startIcon:(0,t.jsx)(eL.Z,{}),sx:{mb:2},disabled:j,children:"Chọn file GeoJSON"})}),d&&(0,t.jsxs)(o.Z,{variant:"body2",sx:{mt:1},children:["Đ\xe3 chọn: ",d.name," (",(d.size/1024).toFixed(2)," KB)"]})]}),c.length>0&&(0,t.jsxs)(a.Z,{sx:{mt:3},children:[(0,t.jsxs)(o.Z,{variant:"subtitle1",gutterBottom:!0,children:["Dữ liệu đ\xe3 nhập (",c.length," kho vật tư)"]}),(0,t.jsx)(ey.Z,{component:S.Z,sx:{maxHeight:400},children:(0,t.jsxs)(eZ.Z,{stickyHeader:!0,size:"small",children:[(0,t.jsx)(eT.Z,{children:(0,t.jsxs)(eD.Z,{children:[(0,t.jsx)(ek.Z,{children:"STT"}),(0,t.jsx)(ek.Z,{children:"T\xean kho"}),(0,t.jsx)(ek.Z,{children:"Loại kho"}),(0,t.jsx)(ek.Z,{children:"Vị tr\xed KM"}),(0,t.jsx)(ek.Z,{children:"Tuyến đ\xea"}),(0,t.jsx)(ek.Z,{children:"K\xedch thước"}),(0,t.jsx)(ek.Z,{children:"Kết cấu"}),(0,t.jsx)(ek.Z,{children:"Vật tư"}),(0,t.jsx)(ek.Z,{children:"Năm x\xe2y dựng"})]})}),(0,t.jsx)(eS.Z,{children:c.map((e,n)=>(0,t.jsxs)(eD.Z,{children:[(0,t.jsx)(ek.Z,{children:n+1}),(0,t.jsx)(ek.Z,{children:e.tenKho}),(0,t.jsx)(ek.Z,{children:e.loaiKho}),(0,t.jsx)(ek.Z,{children:e.viTriKM}),(0,t.jsx)(ek.Z,{children:e.tenTuyenDe}),(0,t.jsx)(ek.Z,{children:e.kichThuoc}),(0,t.jsx)(ek.Z,{children:e.ketCau}),(0,t.jsx)(ek.Z,{children:e.vatTu}),(0,t.jsx)(ek.Z,{children:e.namXD})]},n))})]})})]})]})]}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{onClick:()=>{h(null),u([]),g({tenKho:"",loaiKho:"",viTriKM:"",kichThuoc:"",ketCau:"",toaDo:"",vatTu:"",namXD:"",moTa:"",maLoaiCongTrinh:eK,loaiCongTrinhId:T,tuyenDeId:null,tenTuyenDe:"",doanDeId:null,tenDoanDe:""}),v(null),f(null),Z(0)},disabled:j||0===c.length&&!d&&!x.tenKho,children:"X\xf3a"}),(0,t.jsx)(es.Z,{onClick:n,disabled:j,children:"Đ\xf3ng"}),(0,t.jsx)(es.Z,{onClick:()=>{0===M&&0===c.length?B():O()},variant:"contained",color:"primary",disabled:j||(0===M?!x.tenKho:0===c.length),startIcon:j?(0,t.jsx)(K.Z,{size:20}):(0,t.jsx)(em.Z,{}),children:j?"Đang lưu...":"Lưu"})]})]})},eF=i(51052),ez=i(29291),eN=i(55782),eM=i(82777),eP=i(97562);let eW="SU_CO";var eB=e=>{let{onClose:n,onSaveComplete:i,open:r}=e,[s,d]=(0,l.useState)(null),[h,c]=(0,l.useState)([]),[u,x]=(0,l.useState)(!1),[g,m]=(0,l.useState)(null),[j,p]=(0,l.useState)(null),[b,v]=(0,l.useState)(0),[C,f]=(0,l.useState)(""),[y,Z]=(0,l.useState)([]),[T,D]=(0,l.useState)([]),[k,S]=(0,l.useState)([]);(0,l.useEffect)(()=>{(async()=>{try{let e=(await ep.I.getLoaiCongTrinhTree()).find(e=>e.maLoai===eW);e&&f(e.id)}catch(e){console.error("Lỗi khi tải loại c\xf4ng tr\xecnh:",e)}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{let e=await eP.H.getAllSuCoLoai({pageNumber:1,pageSize:1e3}),n=(null==e?void 0:e.items)||[],i=await ep.I.getAllTuyenDe({pageNumber:1,pageSize:1e3}),t=(null==i?void 0:i.items)||[],l=await ep.I.getAllLoaiCongTrinh(1,1e3),a=(null==l?void 0:l.items)||[];n.length&&Z(n),t.length&&D(t),a.length&&S(a)}catch(e){}})()},[]);let L=e=>{if(!e||0===y.length)return null;let n=e.toString().toLowerCase(),i=y.find(e=>(e.ten||"").toString().toLowerCase()===n);return i||(i=y.find(e=>n.includes((e.ten||"").toString().toLowerCase()))),i||(i=y.find(e=>(e.phanNhom||"").toString().toLowerCase()&&n.includes((e.phanNhom||"").toString().toLowerCase()))),i||(i=y.find(e=>(e.ma||"").toString().toLowerCase()===n)),i||(i=y.find(e=>"KHAC"===(e.ma||"").toString().toUpperCase())),i?i.id:null},w=e=>{if(!e||0===T.length)return null;let n=e.toString().toLowerCase(),i=T.find(e=>(e.tenTuyenDe||"").toString().toLowerCase()===n);return i||(i=T.find(e=>n.includes((e.tenTuyenDe||"").toString().toLowerCase()))),i||(i=T.find(e=>(e.maTuyen||e.ma||"").toString().toLowerCase()===n)),i?i.id:null},I=async()=>{if(0===h.length){m("Kh\xf4ng c\xf3 dữ liệu để lưu");return}x(!0),m(null),p(null);try{let e=C;if(!e)try{let n=await ep.I.getAllLoaiCongTrinh(1,1e3),i=((null==n?void 0:n.items)||n||[]).find(e=>e.maLoai===eW);i&&i.id&&(e=i.id,f(i.id))}catch(e){}let n=h.length,t=0,l=[];for(let i=0;i<h.length;i++){let a=h[i],o=a.toaDo;if("string"==typeof o&&o)try{o=JSON.parse(o)}catch(e){o=null}try{let i=a.loaiCongTrinhId||e||C||null,l={...a,maLoaiCongTrinh:eW,loaiCongTrinhId:i,toaDo:o};await eP.H.createSuCoDe(l),t++,v(Math.floor(t/n*100))}catch(e){l.push(a.tenSuCo||"#".concat(i+1))}}0===l.length?p("Lưu th\xe0nh c\xf4ng ".concat(t," sự cố")):(p("Đ\xe3 lưu ".concat(t,"/").concat(n," sự cố. ").concat(l.length," mục lỗi.")),m("C\xe1c mục lỗi: ".concat(l.join(", ")))),t>0&&setTimeout(()=>i(),1200),c([]),d(null)}catch(e){m("Lỗi khi lưu dữ liệu. Vui l\xf2ng thử lại.")}finally{x(!1)}};return(0,t.jsxs)(ei.Z,{open:r,onClose:u?void 0:n,maxWidth:"md",fullWidth:!0,children:[(0,t.jsx)(et.Z,{children:"Nhập h\xe0ng loạt sự cố đ\xea từ file GeoJSON"}),(0,t.jsxs)(el.Z,{children:[j&&(0,t.jsxs)(eu.Z,{severity:"success",sx:{mb:2},children:[(0,t.jsx)(ex.Z,{children:"Th\xe0nh c\xf4ng"}),j]}),g&&(0,t.jsxs)(eu.Z,{severity:"error",sx:{mb:2},children:[(0,t.jsx)(ex.Z,{children:"Lỗi"}),g]}),u&&(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,t.jsx)(K.Z,{variant:"determinate",value:b,sx:{mr:2}}),(0,t.jsxs)(o.Z,{variant:"body2",color:"text.secondary",children:["Đang lưu... ",b,"%"]})]}),(0,t.jsxs)(a.Z,{sx:{mb:3},children:[(0,t.jsx)(o.Z,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Chỉ hỗ trợ nhập h\xe0ng loạt từ file GeoJSON. File cần c\xf3 cấu tr\xfac FeatureCollection với c\xe1c Feature chứa th\xf4ng tin sự cố."}),(0,t.jsxs)(a.Z,{sx:{border:"1px dashed #ccc",p:3,my:3,textAlign:"center",borderRadius:1},children:[(0,t.jsxs)(es.Z,{variant:"contained",component:"label",startIcon:(0,t.jsx)(eg.Z,{}),disabled:u,children:["Chọn file GeoJSON",(0,t.jsx)("input",{type:"file",hidden:!0,accept:".geojson,.json",onChange:e=>{var n;let i=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!i)return;d(i),m(null);let t=new FileReader;t.onload=e=>{try{var n;let i=JSON.parse(null===(n=e.target)||void 0===n?void 0:n.result);if(!i.type||"FeatureCollection"!==i.type||!i.features){m("File kh\xf4ng phải l\xe0 GeoJSON FeatureCollection hợp lệ");return}let t=i.features.map((e,n)=>{var i;let t=e;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t=null}let l=e.properties||{},a=L(l.Loai_Suco||l.Ten_Suco||l.Loai),o=w(l.Thuoc_Tde||l.Thuoc_tde),r=C||null,s=y.find(e=>e.id===a)||y.find(e=>(e.ten||"").toLowerCase().includes((l.Loai_Suco||l.Ten_Suco||"").toString().toLowerCase())),d=T.find(e=>(e.tenTuyenDe||"").toString().toLowerCase().includes((l.Thuoc_Tde||l.Thuoc_tde||"").toString().toLowerCase())),h=k.find(e=>e.id===r)||k.find(e=>(e.maLoai||"").toString().toLowerCase()===(l.Ma_Loai_Cong_Trinh||l.maLoai||"").toString().toLowerCase())||k.find(e=>(e.tenLoai||"").toString().toLowerCase().includes((l.Ten_Loai||l.Ten_Loai_CongTrinh||"").toString().toLowerCase())),c=o||d&&d.id||null,u=r||h&&h.id||null;return{tenSuCo:l.Ten_Suco||l.Loai_Suco||"Sự cố ".concat(n+1),diaDanh:l.Thuoc_huyen||"",viTriKM:l.Vitri_Km||"",thoiGianPhatHienText:l.Thoi_gian||"",kieuHinhHoc:(null==t?void 0:null===(i=t.geometry)||void 0===i?void 0:i.type)||"LineString",toaDo:t,dienBien:l.Dien_bien||"",nguyenNhan:l.Nguyen_nhan||l.NguyenNhan||"",trangThaiXuLy:l.Tinh_trang||"",bienPhapXuLy:l.Bien_phap||"",ketQuaXuLy:l.Ketqua_xuly||"",donViQuanLy:l.Thuoc_tinh||"",lienKetNgoai:l.Lien_ket||"",loaiSuCoId:a,tenLoaiSuCo:(null==s?void 0:s.ten)||void 0,tuyenDeId:c,tenTuyenDe:d?d.tenTuyenDe||"":void 0,loaiCongTrinhId:u,maLoaiCongTrinh:eW,tenLoaiCongTrinh:(null==h?void 0:h.tenLoai)||void 0}});c(t)}catch(e){m("Kh\xf4ng thể đọc file GeoJSON. Kiểm tra định dạng file.")}},t.readAsText(i)}})]}),s&&(0,t.jsxs)(o.Z,{variant:"body2",sx:{display:"flex",alignItems:"center",mt:1},children:[s.name," (",(s.size/1024).toFixed(1)," KB)"]})]}),h.length>0&&(0,t.jsxs)(a.Z,{sx:{mt:3},children:[(0,t.jsxs)(o.Z,{variant:"subtitle2",sx:{mb:1},children:["Xem trước dữ liệu (",h.length," sự cố)"]}),(0,t.jsx)(a.Z,{sx:{border:"1px solid #eee",borderRadius:2,overflow:"auto"},children:(0,t.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{style:{background:"#f5f5f5"},children:[(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"STT"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"T\xean sự cố"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"Tuyến đ\xea (t\xean / id)"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"Loại c\xf4ng tr\xecnh (t\xean / id)"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"Loại sự cố"}),(0,t.jsx)("th",{style:{padding:8,border:"1px solid #ddd"},children:"Vị tr\xed"})]})}),(0,t.jsx)("tbody",{children:h.map((e,n)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd",textAlign:"center"},children:n+1}),(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd"},children:e.tenSuCo}),(0,t.jsxs)("td",{style:{padding:8,border:"1px solid #ddd"},children:[e.tenTuyenDe?"".concat(e.tenTuyenDe):"",e.tuyenDeId?" / ".concat(e.tuyenDeId):""]}),(0,t.jsxs)("td",{style:{padding:8,border:"1px solid #ddd"},children:[e.tenLoaiCongTrinh?"".concat(e.tenLoaiCongTrinh):"",e.loaiCongTrinhId?" / ".concat(e.loaiCongTrinhId):""]}),(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd"},children:e.tenLoaiSuCo||""}),(0,t.jsx)("td",{style:{padding:8,border:"1px solid #ddd"},children:e.viTriKM})]},n))})]})})]})]})]}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{onClick:()=>{d(null),c([]),m(null),p(null),v(0)},disabled:u||0===h.length&&!s,children:"X\xf3a"}),(0,t.jsx)(es.Z,{onClick:n,disabled:u,children:"Đ\xf3ng"}),(0,t.jsx)(es.Z,{onClick:I,variant:"contained",color:"primary",disabled:u||0===h.length,startIcon:u?(0,t.jsx)(K.Z,{size:20}):(0,t.jsx)(em.Z,{}),children:u?"Đang lưu...":"Lưu"})]})]})},eO=e=>{let{visible:n,onToggle:i,onDataChange:a,onFilterChange:o}=e,[r,s]=(0,l.useState)(!1),[d,h]=(0,l.useState)({}),[c,x]=(0,l.useState)({}),[g,m]=(0,l.useState)([]),{infoDrawerOpen:j,setInfoDrawerOpen:p,selectedItem:b,clickedCoordinates:v}=(0,ez.Y)(),C=(0,l.useRef)({}),f=(0,l.useRef)([]),[y,Z]=(0,l.useState)({de:!1,ke:!1,cong:!1,other:!1}),{selectedMaLoaiList:T,setSelectedMaLoaiList:D,layerLabelState:S,setLayerLabelState:L}=(0,ez.Y)(),w=async()=>{try{let e=await ep.I.getLoaiCongTrinhTree();e&&e.length>0&&m(e)}catch(e){console.error("Lỗi khi tải danh s\xe1ch loại c\xf4ng tr\xecnh:",e)}};(0,l.useEffect)(()=>{w()},[]),(0,l.useEffect)(()=>{g&&g.length>0&&Z(e=>{let n={...e};return g.forEach(e=>{n[e.id]=!1}),n})},[g]);let K=(0,l.useMemo)(()=>{let e=g.map(e=>{let n=e.children||[],i=e.icon,t=e=>{var n;let i=e.tenLoai||"Kh\xf4ng c\xf3 t\xean",l=e.maMau||"#3f51b5",a=e.icon||"",o=(null===(n=e.children)||void 0===n?void 0:n.length)>0?e.children.map(t):[];return{id:e.id,label:i,color:l,icon:a,data:e,children:o}};return{id:e.id,label:e.tenLoai||"Kh\xf4ng c\xf3 t\xean",icon:i,data:e,children:n.map(t)}});return e.length>0?e:[]},[g]);(0,l.useEffect)(()=>{let e={},n={};K.forEach(i=>{n[i.id]=!0,Array.isArray(i.children)&&0!==i.children.length?i.children.forEach(n=>{e[n.label]=!0}):e[i.label]=!0}),h(e),x(n)},[K]),(0,l.useEffect)(()=>{if(o){let e={},n=[];K.forEach(i=>{if(!Array.isArray(i.children)||0===i.children.length){let t=i.label,l=d[t]||!1;e[t]=l,l&&i.data&&i.data.maLoai&&n.push(i.data.maLoai);return}c[i.id]?i.children.forEach(i=>{e[i.label]=!0,i.data&&i.data.maLoai&&n.push(i.data.maLoai)}):i.children.forEach(i=>{let t=d[i.label]||!1;e[i.label]=t,t&&i.data&&i.data.maLoai&&n.push(i.data.maLoai)})});let i=[...new Set(n)],t=JSON.stringify(C.current)!==JSON.stringify(e),l=JSON.stringify(f.current)!==JSON.stringify(i);(t||l)&&(C.current={...e},f.current=[...i],setTimeout(()=>{o(e,i)},0))}},[d,c,K]);let I=()=>s(!1),F=e=>e?e.data&&e.data.maLoai||e.data&&e.data.maLoai?{maLoai:e.data.maLoai,label:e.label}:{label:e.label}:{},z=e=>e&&Array.isArray(e)&&0!==e.length?e.reduce((e,n)=>(e.push(n),(null==n?void 0:n.children)&&Array.isArray(n.children)&&n.children.length>0&&e.push(...z(n.children)),e),[]):[],[N,M]=(0,l.useState)(!1),[P,W]=(0,l.useState)(!1),[B,O]=(0,l.useState)(!1),[V,H]=(0,l.useState)(!1),[R,A]=(0,l.useState)(!1),[E,X]=(0,l.useState)(!1),[_,G]=(0,l.useState)(!1),[Q,q]=(0,l.useState)(!1),[U,Y]=(0,l.useState)(!1),$=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=document.querySelector(".leaflet-control-zoom"),n=$.current;return e&&n&&!e.contains(n)&&e.appendChild(n),()=>{e&&n&&e.contains(n)&&e.removeChild(n)}},[]);let[ee,ei]=(0,l.useState)(!1),[et,el]=(0,l.useState)({}),[ea,eo]=(0,l.useState)([]);return(0,l.useEffect)(()=>{let e=async()=>{eo(((await ep.I.getAllLoaiCongTrinh(1,1e3)).items||[]).filter(e=>!e.idParrent).map(e=>({id:e.id,tenLoai:e.tenLoai})))};ee&&e()},[ee]),(0,l.useEffect)(()=>{let e={};K.forEach(n=>{n.children.forEach(n=>{var i;(null===(i=n.data)||void 0===i?void 0:i.maLoai)&&(e[n.data.maLoai]=!1)})}),L(e)},[K,L]),(0,l.useEffect)(()=>{if(K.length>0){let e=[];K.forEach(n=>{var i;((n.label||"").toLowerCase().includes("đ\xea")||(n.label||"").toLowerCase().includes("de"))&&!(null===(i=n.label)||void 0===i?void 0:i.toLowerCase().includes("sự cố"))&&z(n.children).forEach(n=>{var i;(null===(i=n.data)||void 0===i?void 0:i.maLoai)&&e.push(n.data.maLoai)})}),D(e)}},[K]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u,{ref:$,sidebarOpen:N,setSidebarOpen:M}),(0,t.jsx)(k,{sidebarOpen:N,setSidebarOpen:M,onDataChange:a,onOpenDialog:()=>s(!0),onOpenImportDialog:()=>W(!0),onOpenCotKMDialog:()=>O(!0),onOpenCuaKhauDialog:()=>H(!0),onOpenKhoVatTuDialog:()=>A(!0),onOpenDCanhDialog:()=>X(!0),onOpenCongDialog:()=>G(!0),onOpenSuCoDeDialog:()=>q(!0),onOpenHatQlyDeDialog:()=>Y(!0)}),(0,t.jsx)(J,{open:j,onClose:()=>p(!1),selectedItem:b,clickedCoordinates:v}),(0,t.jsx)(ed,{open:ee,onClose:()=>ei(!1),newLayer:et,setNewLayer:el,parentOptions:ea,onSave:async()=>{await ep.I.saveLoaiCongTrinh(et)&&(ei(!1),el({}),w())}}),(0,t.jsx)(en,{visible:n,onToggle:i,onAddLayerClick:()=>ei(!0),computedLegendData:K,expandedItems:y,toggleExpand:e=>{Z(n=>({...n,[e]:!n[e]}))},isItemChecked:e=>{let{maLoai:n,label:i}=F(e);return n?T.includes(n):d[i||""]||!1},handleItemCheckboxChange:e=>{let{maLoai:n,label:i}=F(e);if(n){let e=!T.includes(n);D(i=>e?[...i,n]:i.filter(e=>e!==n))}else i&&h(e=>({...e,[i]:!e[i]}))},handleCategoryCheckboxChange:e=>{if(!Array.isArray(e.children)||0===e.children.length)return;let n=z(e.children).map(e=>{var n;return null===(n=e.data)||void 0===n?void 0:n.maLoai}).filter(Boolean);if(0===n.length)return;let i=n.every(e=>T.includes(e));D(e=>i?e.filter(e=>!n.includes(e)):[...new Set([...e,...n])])},getCategoryCheckboxState:e=>{if(!Array.isArray(e.children)||0===e.children.length)return{checked:!1,indeterminate:!1};let n=z(e.children).map(e=>{var n;return null===(n=e.data)||void 0===n?void 0:n.maLoai}).filter(Boolean);if(0===n.length)return{checked:!1,indeterminate:!1};let i=n.filter(e=>T.includes(e)).length;return 0===i?{checked:!1,indeterminate:!1}:i===n.length?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}},handleToggleLayerLabelCategory:e=>{Array.isArray(e.children)&&0!==e.children.length&&L(n=>{let i={...n},t=e.children.map(e=>{var n;return null===(n=e.data)||void 0===n?void 0:n.maLoai}).filter(Boolean);if(0===t.length)return n;let l=t.every(e=>n[e]);return t.forEach(e=>{i[e]=!l}),i})},handleToggleLayerLabelItem:e=>{var n;let i=null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.maLoai;i&&L(e=>({...e,[i]:!e[i]}))},layerLabelState:S,processSvgIcon:(e,n)=>{let i=e.replace(/fill="[^"]*"/g,'fill="'.concat(n,'"')).replace(/stroke="[^"]*"/g,'stroke="'.concat(n,'"'));return/fill=/.test(i)||["polygon","rect","path","circle","ellipse","line","polyline"].forEach(e=>{let t=RegExp("<".concat(e,"([^>]*)"),"gi");i=i.replace(t,"<".concat(e,'$1 fill="').concat(n,'" stroke="').concat(n,'" fill-opacity="0.8" stroke-opacity="1"'))}),i}}),(0,t.jsx)(eh.Z,{open:r,onClose:I,onSaveComplete:e=>{e&&(I(),a&&a())}}),(0,t.jsx)(eI,{open:R,onClose:()=>A(!1),onSaveComplete:()=>{A(!1),a&&a()}}),(0,t.jsx)(ec.Z,{open:P,onClose:()=>W(!1),onSaveComplete:()=>{W(!1),a&&a()}}),(0,t.jsx)(eb,{open:B,onClose:()=>O(!1),onSaveComplete:()=>{O(!1),a&&a()}}),(0,t.jsx)(ef,{open:V,onClose:()=>H(!1),onSaveComplete:()=>{H(!1),a&&a()}}),(0,t.jsx)(eN.Z,{open:E,onClose:()=>X(!1),onSaveComplete:()=>{X(!1),a&&a()}}),(0,t.jsx)(eM.Z,{open:_,onClose:()=>G(!1),onSaveComplete:()=>{G(!1),a&&a()}}),(0,t.jsx)(eB,{open:Q,onClose:()=>q(!1),onSaveComplete:()=>{q(!1),a&&a()}}),(0,t.jsx)(eF.Z,{open:U,onClose:()=>Y(!1),onSaveComplete:()=>{Y(!1),a&&a()}})]})},eV=i(58585),eH=i(39892),eR=e=>{var n,i,r,s,d,h,c,u,x,g,m,j,p,b,v,C,f,y,Z,T,D,k,L,w,I,F,z;let{open:N,onClose:M,dike:P,onDataChange:W}=e,[B,O]=(0,l.useState)(!1),[V,H]=(0,l.useState)(!1);if(!P)return null;let R=async()=>{H(!0),setTimeout(()=>{O(!0),H(!1)},10)},A=()=>O(!1),E={tenDoan:P.tenDoan||"Chưa c\xf3 t\xean",viTriTu:null!==(C=P.viTriTu)&&void 0!==C?C:0,viTriDen:null!==(f=P.viTriDen)&&void 0!==f?f:0,diaDanh:P.diaDanh||"Chưa x\xe1c định",chieuDai:null!==(y=P.chieuDai)&&void 0!==y?y:0,matDe:null!==(Z=null===(n=P.matCat)||void 0===n?void 0:n.caoTrinhMatDe)&&void 0!==Z?Z:null,mntk:null!==(T=null===(i=P.matCat)||void 0===i?void 0:i.caoTrinhThietKe)&&void 0!==T?T:null,chenh:null!==(D=null===(r=P.matCat)||void 0===r?void 0:r.chenhCao)&&void 0!==D?D:null,beRong:null!==(k=null===(s=P.matCat)||void 0===s?void 0:s.beRongMatDe)&&void 0!==k?k:null,matDePhiaSong:null!==(L=null===(d=P.matCat)||void 0===d?void 0:d.maiDePhiaSong)&&void 0!==L?L:null,matDePhiaDong:null!==(w=null===(h=P.matCat)||void 0===h?void 0:h.maiDePhiaDong)&&void 0!==w?w:null,chieuCaoDe:null!==(I=null===(c=P.matCat)||void 0===c?void 0:c.chieuCaoDe)&&void 0!==I?I:null,chieuRongCoTL:null!==(F=null===(u=P.matCat)||void 0===u?void 0:u.chieuRongCoTL)&&void 0!==F?F:null,chieuRongCoHL:null!==(z=null===(x=P.matCat)||void 0===x?void 0:x.chieuRongCoHL)&&void 0!==z?z:null,danhGia:(null===(g=P.matCat)||void 0===g?void 0:g.danhGia)||"Chưa đ\xe1nh gi\xe1"};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(ei.Z,{open:N,onClose:M,maxWidth:"xl",fullWidth:!0,children:[(0,t.jsxs)(et.Z,{sx:{py:2,px:3},children:[(0,t.jsx)(o.Z,{variant:"h6",gutterBottom:!0,color:"primary",textTransform:"uppercase",textAlign:"center",margin:0,children:"Th\xf4ng tin đoạn đ\xea"}),(0,t.jsx)(eV.Z,{onClick:M,size:"small",sx:{ml:2},ariaLabel:"close"})]}),(0,t.jsxs)(el.Z,{dividers:!0,sx:{p:3,overflowY:"auto",overflowX:"hidden"},children:[(0,t.jsx)(a.Z,{mb:2,children:(0,t.jsxs)(a.Z,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:3,children:[(0,t.jsx)(S.Z,{variant:"outlined",sx:{p:2},children:(0,t.jsxs)(o.Z,{variant:"subtitle2",color:"text.secondary",children:["Tuyến đ\xea:",(0,t.jsx)(o.Z,{variant:"body1",fontWeight:"bold",children:P.tenTuyenDe||"Chưa x\xe1c định"})]})}),(0,t.jsxs)(S.Z,{variant:"outlined",sx:{p:2},children:[(0,t.jsx)(o.Z,{variant:"subtitle2",color:"text.secondary",children:"Cấp đ\xea"}),(0,t.jsx)(o.Z,{variant:"body1",fontWeight:"bold",children:P.capDe||"Chưa x\xe1c định"})]}),(0,t.jsxs)(S.Z,{variant:"outlined",sx:{p:2},children:[(0,t.jsx)(o.Z,{variant:"subtitle2",color:"text.secondary",children:"Loại đ\xea"}),(0,t.jsx)(o.Z,{variant:"body1",fontWeight:"bold",children:P.loaiCongTrinh||"Chưa x\xe1c định"})]})]})}),(0,t.jsx)(a.Z,{sx:{width:"100%",overflowX:"auto",border:"1px solid #e0e0e0",borderRadius:1,"& .MuiTable-root":{minWidth:"max-content"},"& .MuiTableCell-root":{whiteSpace:"nowrap",fontSize:"0.75rem",padding:"6px 8px"},"& .MuiTableCell-head":{fontWeight:600,backgroundColor:"#f5f5f5"}},children:(0,t.jsx)(eH.Z,{columns:(e=>{let n=(null==e?void 0:e.toLowerCase())||"";return n.includes("de_bien")?[{id:"tuyenDe",label:(0,t.jsxs)(t.Fragment,{children:["Tuyến đ\xea ",(0,t.jsx)("br",{})," biển"]}),align:"center"},{id:"diaDanh",label:(0,t.jsxs)(t.Fragment,{children:["Địa danh",(0,t.jsx)("br",{})]}),align:"center"},{id:"capDe",label:(0,t.jsxs)(t.Fragment,{children:["Cấp đ\xea",(0,t.jsx)("br",{})]}),align:"center"},{id:"chieuDai",label:(0,t.jsxs)(t.Fragment,{children:["Chiều d\xe0i",(0,t.jsx)("br",{})]}),align:"center",children:[{id:"phanCap",label:(0,t.jsxs)(t.Fragment,{children:["Ph\xe2n cấp ",(0,t.jsx)("br",{})," (Km đ\xea)"]}),align:"center"},{id:"chuaPhanCap",label:(0,t.jsxs)(t.Fragment,{children:["Chưa ",(0,t.jsx)("br",{})," ph\xe2n cấp ",(0,t.jsx)("br",{})," (Km đ\xea)"]}),align:"center"}]},{id:"caoTrinh",label:(0,t.jsxs)(t.Fragment,{children:["Cao tr\xecnh theo ",(0,t.jsx)("br",{})," 3302/QĐ-BNN-TCTL"]}),align:"center",children:[{id:"duCaoTrinh",label:(0,t.jsxs)(t.Fragment,{children:["Đủ ",(0,t.jsx)("br",{})," cao tr\xecnh ",(0,t.jsx)("br",{})," (Km đ\xea)"]}),align:"center"},{id:"chuaDuCaoTrinh",label:(0,t.jsxs)(t.Fragment,{children:["Chưa đủ ",(0,t.jsx)("br",{})," cao tr\xecnh ",(0,t.jsx)("br",{})," (Km đ\xea)"]}),align:"center"}]},{id:"matCatThietKe",label:(0,t.jsxs)(t.Fragment,{children:["Mặt cắt thiết kế ",(0,t.jsx)("br",{})," (rộng TB: 6-7m)"]}),align:"center",children:[{id:"duMatCat",label:(0,t.jsxs)(t.Fragment,{children:["Đủ ",(0,t.jsx)("br",{})," mặt cắt TK ",(0,t.jsx)("br",{})," (Km đ\xea)"]}),align:"center"},{id:"chuaDuMatCat",label:(0,t.jsxs)(t.Fragment,{children:["Chưa đủ ",(0,t.jsx)("br",{})," mặt cắt TK ",(0,t.jsx)("br",{})," (Km đ\xea)"]}),align:"center"}]},{id:"nangCap",label:(0,t.jsx)(t.Fragment,{children:"Cần đầu tư n\xe2ng cấp"}),align:"center",children:[{id:"canDauTu",label:(0,t.jsxs)(t.Fragment,{children:["(Km đ\xea)",(0,t.jsx)("br",{})]}),align:"center"},{id:"ghiChuDauTu",label:(0,t.jsxs)(t.Fragment,{children:["Ghi ch\xfa (Km c\xe1c đoạn ",(0,t.jsx)("br",{})," cần đầu tư n\xe2ng cấp ",(0,t.jsx)("br",{}),"do thiếu cao tr\xecnh ",(0,t.jsx)("br",{}),"hay mặt cắt TK)"]}),align:"center"}]},{id:"nangCapMatDe",label:(0,t.jsx)(t.Fragment,{children:"Cần đầu tư n\xe2ng cấp mặt đ\xea"}),align:"center",children:[{id:"canDauTuMatDe",label:(0,t.jsxs)(t.Fragment,{children:["(Km đ\xea)",(0,t.jsx)("br",{})]}),align:"center"},{id:"ghiChuMatDe",label:(0,t.jsxs)(t.Fragment,{children:["Ghi ch\xfa (Km c\xe1c đoạn cần ",(0,t.jsx)("br",{})," đầu tư n\xe2ng cấp ",(0,t.jsx)("br",{})," mặt đ\xea hư hỏng)"]}),align:"center"}]}]:n.includes("de_cua_song")?[{id:"tuyenDe",label:(0,t.jsxs)(t.Fragment,{children:["Tuyến đ\xea ",(0,t.jsx)("br",{})," cửa s\xf4ng"]}),align:"center"},{id:"diaDanh",label:(0,t.jsx)(t.Fragment,{children:"Địa danh"}),align:"center"},{id:"capDe",label:(0,t.jsx)(t.Fragment,{children:"Cấp đ\xea"}),align:"center"},{id:"chieuDai",label:(0,t.jsx)(t.Fragment,{children:"Chiều d\xe0i"}),align:"center",children:[{id:"phanCap",label:(0,t.jsxs)(t.Fragment,{children:["Ph\xe2n cấp ",(0,t.jsx)("br",{})," (Km đ\xea)"]}),align:"center"},{id:"chuaPhanCap",label:(0,t.jsxs)(t.Fragment,{children:["Chưa ph\xe2n cấp ",(0,t.jsx)("br",{})," (Km đ\xea)"]}),align:"center"}]},{id:"caoTrinh",label:(0,t.jsxs)(t.Fragment,{children:["Cao tr\xecnh theo ",(0,t.jsx)("br",{})," 3302/QĐ-BNN-TCTL"]}),align:"center",children:[{id:"duCaoTrinh",label:(0,t.jsxs)(t.Fragment,{children:["Đủ cao tr\xecnh ",(0,t.jsx)("br",{})," (Km đ\xea)"]}),align:"center"},{id:"chuaDuCaoTrinh",label:(0,t.jsxs)(t.Fragment,{children:["Chưa đủ cao tr\xecnh ",(0,t.jsx)("br",{})," (Km đ\xea)"]}),align:"center"}]},{id:"matCatThietKe",label:(0,t.jsxs)(t.Fragment,{children:["Mặt cắt thiết kế ",(0,t.jsx)("br",{})," (rộng TB: 6-7m)"]}),align:"center",children:[{id:"duMatCat",label:(0,t.jsxs)(t.Fragment,{children:["Đủ mặt cắt TK ",(0,t.jsx)("br",{})," (Km đ\xea)"]}),align:"center"},{id:"chuaDuMatCat",label:(0,t.jsxs)(t.Fragment,{children:["Chưa đủ mặt cắt TK ",(0,t.jsx)("br",{})," (Km đ\xea)"]}),align:"center"}]},{id:"nangCap",label:(0,t.jsxs)(t.Fragment,{children:["Cần đầu tư ",(0,t.jsx)("br",{})," n\xe2ng cấp"]}),align:"center",children:[{id:"canDauTu",label:(0,t.jsx)(t.Fragment,{children:"(Km đ\xea)"}),align:"center"},{id:"ghiChuDauTu",label:(0,t.jsxs)(t.Fragment,{children:["Ghi ch\xfa ",(0,t.jsx)("br",{}),"(Km c\xe1c đoạn cần ",(0,t.jsx)("br",{}),"đầu tư n\xe2ng cấp ",(0,t.jsx)("br",{}),"do thiếu cao tr\xecnh ",(0,t.jsx)("br",{}),"hay mặt cắt TK)"]}),align:"center"}]},{id:"nangCapMatDe",label:(0,t.jsxs)(t.Fragment,{children:["Cần đầu tư n\xe2ng cấp ",(0,t.jsx)("br",{})," mặt đ\xea"]}),align:"center",children:[{id:"canDauTuMatDe",label:(0,t.jsx)(t.Fragment,{children:"(Km đ\xea)"}),align:"center"},{id:"ghiChuMatDe",label:(0,t.jsxs)(t.Fragment,{children:["Ghi ch\xfa (Km c\xe1c đoạn cần ",(0,t.jsx)("br",{})," đầu tư n\xe2ng cấp mặt đ\xea ",(0,t.jsx)("br",{})," hư hỏng)"]}),align:"center"}]}]:n.includes("de_boi")?[{id:"tuyenDe",label:(0,t.jsxs)(t.Fragment,{children:["Tuyến đ\xea ",(0,t.jsx)("br",{})," bối"]}),align:"center"},{id:"viTri",label:(0,t.jsxs)(t.Fragment,{children:["Vị tr\xed ",(0,t.jsx)("br",{})," Km - Km"]}),align:"center",children:[{id:"viTriTu",label:(0,t.jsx)(t.Fragment,{children:"Km từ"}),align:"center"},{id:"viTriDen",label:(0,t.jsx)(t.Fragment,{children:"Km đến"}),align:"center"}]},{id:"diaDanh",label:(0,t.jsx)(t.Fragment,{children:"Địa danh"}),align:"center"},{id:"chieuDai",label:(0,t.jsxs)(t.Fragment,{children:["Chiều d\xe0i ",(0,t.jsx)("br",{})," (km)"]}),align:"center"},{id:"tuongUngKm",label:(0,t.jsxs)(t.Fragment,{children:["Tương ứng với ",(0,t.jsx)("br",{})," Km đ\xea ch\xednh"]}),align:"center"},{id:"capDe",label:(0,t.jsx)(t.Fragment,{children:"Cấp đ\xea"}),align:"center"},{id:"caoTrinhMat",label:(0,t.jsxs)(t.Fragment,{children:["Cao tr\xecnh ",(0,t.jsx)("br",{})," mặt"]}),align:"center"},{id:"hienTrangMat",label:(0,t.jsxs)(t.Fragment,{children:["Hiện trạng ",(0,t.jsx)("br",{})," mặt"]}),align:"center"},{id:"heSoMai",label:(0,t.jsxs)(t.Fragment,{children:["Hệ số ",(0,t.jsx)("br",{})," m\xe1i"]}),align:"center"},{id:"dienTichDanSo",label:(0,t.jsxs)(t.Fragment,{children:["Diện t\xedch, số d\xe2n ",(0,t.jsx)("br",{})," được đ\xea bối bảo vệ"]}),align:"center"},{id:"danhGia",label:(0,t.jsx)(t.Fragment,{children:"Đ\xe1nh gi\xe1"}),align:"center"}]:[{id:"tuyenDe",label:(0,t.jsxs)(t.Fragment,{children:["Tuyến đ\xea ",(0,t.jsx)("br",{})," s\xf4ng"]}),align:"center"},{id:"viTri",label:(0,t.jsx)(t.Fragment,{children:"Vị tr\xed"}),align:"center",children:[{id:"viTriTu",label:(0,t.jsx)(t.Fragment,{children:"Km"}),align:"center"},{id:"viTriDen",label:(0,t.jsx)(t.Fragment,{children:"- Km"}),align:"center"}]},{id:"diaDanh",label:(0,t.jsx)(t.Fragment,{children:"Địa danh"}),align:"center"},{id:"capDe",label:(0,t.jsx)(t.Fragment,{children:"Cấp đ\xea"}),align:"center"},{id:"chieuDai",label:(0,t.jsxs)(t.Fragment,{children:["Chiều d\xe0i ",(0,t.jsx)("br",{})," (km)"]}),align:"center"},{id:"caoTrinh",label:(0,t.jsxs)(t.Fragment,{children:["Cao tr\xecnh ",(0,t.jsx)("br",{})," (m)"]}),align:"center",children:[{id:"matDe",label:(0,t.jsx)(t.Fragment,{children:"Mặt đ\xea"}),align:"center"},{id:"mntk",label:(0,t.jsx)(t.Fragment,{children:"MNTK"}),align:"center"},{id:"chenh",label:(0,t.jsxs)(t.Fragment,{children:["Ch\xeanh cao ",(0,t.jsx)("br",{})," (Mặt đ\xea - TK)"]}),align:"center"}]},{id:"kichThuoc",label:(0,t.jsxs)(t.Fragment,{children:["K\xedch thước mặt cắt ",(0,t.jsx)("br",{})," ngang đ\xea hiện tại"]}),align:"center",children:[{id:"beRong",label:(0,t.jsxs)(t.Fragment,{children:["Bề rộng ",(0,t.jsx)("br",{})," mặt đ\xea (m)"]}),align:"center"},{id:"matDePhiaSong",label:(0,t.jsxs)(t.Fragment,{children:["M\xe1i đ\xea ",(0,t.jsx)("br",{})," ph\xeda s\xf4ng (m)"]}),align:"center"},{id:"matDePhiaDong",label:(0,t.jsxs)(t.Fragment,{children:["M\xe1i đ\xea ",(0,t.jsx)("br",{})," ph\xeda đồng (m)"]}),align:"center"},{id:"chieuCaoDe",label:(0,t.jsxs)(t.Fragment,{children:["Chiều cao ",(0,t.jsx)("br",{})," đ\xea (m)"]}),align:"center"},{id:"chieuRongCoTL",label:(0,t.jsxs)(t.Fragment,{children:["Chiều rộng ",(0,t.jsx)("br",{})," cơ TL (m)"]}),align:"center"},{id:"chieuRongCoHL",label:(0,t.jsxs)(t.Fragment,{children:["Chiều rộng ",(0,t.jsx)("br",{})," cơ HL (m)"]}),align:"center"}]},{id:"danhGia",label:(0,t.jsx)(t.Fragment,{children:"Đ\xe1nh gi\xe1"}),align:"center"}]})(P.maLoaiCongTrinh||""),rows:[{tt:1,tuyenDeBien:P.tenTuyenDe||"Chưa x\xe1c định",tuyenDe:P.tenTuyenDe||"Chưa x\xe1c định",diaDanh:E.diaDanh,capDe:P.capDe||"Chưa x\xe1c định",viTriTu:E.viTriTu,viTriDen:E.viTriDen,chieuDai:E.chieuDai,phanCap:E.chieuDai||0,chuaPhanCap:0,duCaoTrinh:E.chieuDai||0,chuaDuCaoTrinh:0,duMatCat:E.chieuDai||0,chuaDu:0,canDauTuKm:0,canDauTuNangCap:0,ghiChuKmCacDoan:"-",matDe:E.matDe,mntk:E.mntk,chenh:E.chenh,beRong:E.beRong,matDePhiaSong:E.matDePhiaSong,matDePhiaDong:E.matDePhiaDong,chieuCaoDe:E.chieuCaoDe,chieuRongCoTL:E.chieuRongCoTL,chieuRongCoHL:E.chieuRongCoHL,caoTrinhMat:null===(m=P.deBoi)||void 0===m?void 0:m.caoTrinhMat,heSoMai:null===(j=P.deBoi)||void 0===j?void 0:j.heSoMai,hienTrangMatDe:null===(p=P.deBoi)||void 0===p?void 0:p.hienTrangMatDe,dienTichDuocBaoVe:null===(b=P.deBoi)||void 0===b?void 0:b.dienTichDuocBaoVe,danSoDuocBaoVe:null===(v=P.deBoi)||void 0===v?void 0:v.danSoDuocBaoVe,danhGia:E.danhGia}],pagination:!1})})]}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{onClick:R,variant:"outlined",color:"primary",disabled:V,startIcon:V?(0,t.jsx)(K.Z,{size:16}):void 0,children:V?"Đang mở...":"Sửa"}),(0,t.jsx)(es.Z,{onClick:M,variant:"outlined",color:"error",children:"Đ\xf3ng"})]})]}),(0,t.jsx)(eh.Z,{open:B,onClose:A,editId:P.id,onSaveComplete:e=>{e&&(A(),W&&W())}})]})},eA=e=>{let{open:n,onClose:i,ke:r,onEdit:s}=e,[d,h]=(0,l.useState)(!1),c=e=>null==e||""===e?"Kh\xf4ng x\xe1c định":e,u=r?{tenKe:c(r.tenKe),tenTuyenDe:c(r.tenTuyenDe),viTriTu:c(r.diaDiem),chieuDai:r.chieuDai?"".concat(r.chieuDai," m"):"Kh\xf4ng x\xe1c định",loaiCongTrinh:c(r.loaiCongTrinh),vatLieu:c(r.vatLieu)}:{};return r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(ei.Z,{open:n,onClose:i,maxWidth:"xl",fullWidth:!0,children:[(0,t.jsxs)(et.Z,{sx:{py:2,px:3},children:[(0,t.jsx)(o.Z,{variant:"h6",gutterBottom:!0,color:"primary",textTransform:"uppercase",textAlign:"center",margin:0,children:"Th\xf4ng tin k\xe8"}),(0,t.jsx)(eV.Z,{onClick:i,size:"small",sx:{ml:2},ariaLabel:"close"})]}),(0,t.jsx)(el.Z,{dividers:!0,sx:{p:3,overflowY:"auto",overflowX:"hidden"},children:(0,t.jsx)(a.Z,{sx:{width:"100%",overflowX:"auto",border:"1px solid #e0e0e0",borderRadius:1,background:"#f5f5f5","& .MuiTable-root":{minWidth:"max-content"},"& .MuiTableCell-root":{whiteSpace:"nowrap",fontSize:"0.75rem",padding:"6px 8px"},"& .MuiTableCell-head":{fontWeight:600,backgroundColor:"#f5f5f5"}},children:(0,t.jsx)(eH.Z,{columns:[{id:"tenKe",label:"T\xean k\xe8",align:"center"},{id:"tenTuyenDe",label:"Tuyến đ\xea",align:"center"},{id:"viTriTu",label:"Vị tr\xed (Km)",align:"center"},{id:"chieuDai",label:"Chiều d\xe0i (m)",align:"center"},{id:"loaiCongTrinh",label:"Loại k\xe8",align:"center"},{id:"vatLieu",label:"Kết cấu",align:"center"},{id:"tinhTrang",label:"T\xecnh trạng",align:"center"}],rows:r?[u]:[],pagination:!1})})}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{onClick:()=>{h(!0),"function"==typeof s&&r&&s(r)},variant:"outlined",color:"primary",children:"Sửa"}),(0,t.jsx)(es.Z,{onClick:i,variant:"outlined",color:"primary",children:"Đ\xf3ng"})]})]}),(0,t.jsx)(ec.Z,{open:d,onClose:()=>h(!1),onSaveComplete:()=>h(!1),editKe:r})]}):null},eE=i(42638),eX=i(55536),e_=i(55395),eG=i(2323),eJ=i(647),eQ=e=>{let{open:n,onClose:i,cot:l}=e,r=e=>null==e||""===e?"Kh\xf4ng x\xe1c định":e,s=l?{viTri:r(l.viTri),tenTuyenDe:r(l.tenTuyenDe),tenDoanDe:r(l.tenDoanDe)}:{};return l?(0,t.jsxs)(ei.Z,{open:n,onClose:i,maxWidth:"md",fullWidth:!0,children:[(0,t.jsxs)(et.Z,{sx:{py:2,px:3},children:[(0,t.jsx)(o.Z,{variant:"h6",gutterBottom:!0,color:"primary",textTransform:"uppercase",textAlign:"center",margin:0,children:"Th\xf4ng tin cột chỉ mục"}),(0,t.jsx)(eV.Z,{onClick:i,size:"small",sx:{ml:2},ariaLabel:"close"})]}),(0,t.jsx)(el.Z,{dividers:!0,sx:{p:3,overflowY:"auto",overflowX:"hidden"},children:(0,t.jsx)(a.Z,{sx:{width:"100%",overflowX:"auto",border:"1px solid #e0e0e0",borderRadius:1,background:"#f5f5f5","& .MuiTable-root":{minWidth:"max-content"},"& .MuiTableCell-root":{whiteSpace:"nowrap",fontSize:"0.75rem",padding:"6px 8px"},"& .MuiTableCell-head":{fontWeight:600,backgroundColor:"#f5f5f5"}},children:(0,t.jsx)(eH.Z,{columns:[{id:"viTri",label:"Vị tr\xed",align:"center"},{id:"tenTuyenDe",label:"Tuyến đ\xea",align:"center"},{id:"tenDoanDe",label:"Đoạn đ\xea",align:"center"}],rows:l?[s]:[],pagination:!1})})}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{variant:"outlined",color:"primary",disabled:!0,children:"Sửa"}),(0,t.jsx)(es.Z,{onClick:i,variant:"outlined",color:"primary",children:"Đ\xf3ng"})]})]}):null},eq=e=>{var n,i;let{open:r,onClose:s,cuaKhau:d,onEdit:h,onDataChange:c}=e,[u,x]=(0,l.useState)(!1),g=e=>null==e||""===e?"Kh\xf4ng x\xe1c định":e,m=d?{tenCuaKhau:g(d.tenCuaKhau),viTri:g(d.viTri),diaDiem:g(d.diaDiem),kichThuoc:d.kichThuoc?"".concat(d.kichThuoc," m, Cao tr\xecnh đỉnh: ").concat(null!==(n=d.caoTrinhDinh)&&void 0!==n?n:"-",", Cao tr\xecnh nền: ").concat(null!==(i=d.caoTrinhNen)&&void 0!==i?i:"-"):"Kh\xf4ng x\xe1c định",vatLieu:g(d.vatLieu),tinhTrangHoatDong:"Cửa đ\xf3ng: ".concat(d.coCuaDong?"C\xf3":"Kh\xf4ng",", Vận h\xe0nh tự động: ").concat(d.coVanHanhTuDong?"C\xf3":"Kh\xf4ng"),donViChiuTrach:g(d.donViQuanLy||"Chưa x\xe1c định"),ghiChu:g(d.ghiChu)}:{};return d?(0,t.jsxs)(t.Fragment,{children:[u&&d&&(0,t.jsx)(ef,{open:u,onClose:()=>x(!1),onSaveComplete:()=>{x(!1),c&&c()},editCuaKhau:d}),(0,t.jsxs)(ei.Z,{open:r,onClose:s,maxWidth:"xl",fullWidth:!0,children:[(0,t.jsxs)(et.Z,{sx:{py:2,px:3},children:[(0,t.jsx)(o.Z,{variant:"h6",gutterBottom:!0,color:"primary",textTransform:"uppercase",textAlign:"center",margin:0,children:"Th\xf4ng tin cửa khẩu"}),(0,t.jsx)(eV.Z,{onClick:s,size:"small",sx:{ml:2},ariaLabel:"close"})]}),(0,t.jsx)(el.Z,{dividers:!0,sx:{p:3,overflowY:"auto",overflowX:"hidden"},children:(0,t.jsx)(a.Z,{sx:{width:"100%",overflowX:"auto",border:"1px solid #e0e0e0",borderRadius:1,background:"#f5f5f5","& .MuiTable-root":{minWidth:"max-content"},"& .MuiTableCell-root":{whiteSpace:"nowrap",fontSize:"0.75rem",padding:"6px 8px"},"& .MuiTableCell-head":{fontWeight:600,backgroundColor:"#f5f5f5"}},children:(0,t.jsx)(eH.Z,{columns:[{id:"tenCuaKhau",label:"T\xean cửa khẩu",align:"center"},{id:"viTri",label:"Vị tr\xed Km",align:"center"},{id:"diaDiem",label:"Địa điểm",align:"center"},{id:"kichThuoc",label:"H\xecnh thức, kết cấu",align:"center"},{id:"vatLieu",label:"Hiện trạng cửa khẩu",align:"center"},{id:"tinhTrangHoatDong",label:"T\xecnh trạng hoạt động",align:"center"},{id:"donViChiuTrach",label:"Đơn vị chịu tr\xe1ch nhiệm quản l\xfd, vận h\xe0nh trong m\xf9a lũ",align:"center"},{id:"ghiChu",label:"Đ\xe1nh gi\xe1",align:"center"}],rows:d?[m]:[],pagination:!1})})}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{onClick:()=>{x(!0),"function"==typeof h&&d&&h(d)},variant:"outlined",color:"primary",children:"Sửa"}),(0,t.jsx)(es.Z,{onClick:s,variant:"outlined",color:"primary",children:"Đ\xf3ng"})]})]})]}):null},eU=i(39123),eY=e=>{let{open:n,onClose:i,cong:r,onEdit:s,onDataChange:d}=e,[h,c]=(0,l.useState)(!1),u=e=>null==e||""===e?"Kh\xf4ng x\xe1c định":e,x=r?{tenCong:u(r.tenCong),viTri:u(r.viTri),kichThuoc:"".concat(r.soKhoang||"?"," khoang x ").concat(r.beRongKhoang||"?","m x ").concat(r.chieuCaoCua||"?","m x ").concat(r.chieuDaiCong||"?","m"),thuyLuc:"Cao tr\xecnh đỉnh: ".concat(r.caoTrinhDinh||"?","m, Cao tr\xecnh nền: ").concat(r.caoTrinhNen||"?","m, Lưu lượng ti\xeau: ").concat(r.luuLuongTieu||"?","m\xb3/s"),vatLieu:u(r.vatLieuChinh),tinhTrang:u(r.tinhTrang),vanHanh:u(eU.m.getHinhThucDongMoText(r.hinhThucDongMo)),chuQuanLy:u(r.chuQuanLy)}:{};return r?(0,t.jsxs)(t.Fragment,{children:[h&&r&&(0,t.jsx)(eM.Z,{open:h,onClose:()=>c(!1),onSaveComplete:()=>{c(!1),d&&d()},editCong:r}),(0,t.jsxs)(ei.Z,{open:n,onClose:i,maxWidth:"xl",fullWidth:!0,children:[(0,t.jsxs)(et.Z,{sx:{py:2,px:3},children:[(0,t.jsx)(o.Z,{variant:"h6",gutterBottom:!0,color:"primary",textTransform:"uppercase",textAlign:"center",margin:0,children:"Th\xf4ng tin cống"}),(0,t.jsx)(eV.Z,{onClick:i,size:"small",sx:{ml:2},ariaLabel:"close"})]}),(0,t.jsx)(el.Z,{dividers:!0,sx:{p:3,overflowY:"auto",overflowX:"hidden"},children:(0,t.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,t.jsx)(eH.Z,{columns:[{id:"tenCong",label:"T\xean cống",align:"center"},{id:"viTri",label:"Vị tr\xed Km",align:"center"},{id:"kichThuoc",label:"K\xedch thước",align:"center"},{id:"thuyLuc",label:"Th\xf4ng số thủy lực",align:"center"},{id:"vatLieu",label:"Vật liệu ch\xednh",align:"center"},{id:"tinhTrang",label:"T\xecnh trạng",align:"center"},{id:"vanHanh",label:"H\xecnh thức vận h\xe0nh",align:"center"},{id:"chuQuanLy",label:"Đơn vị quản l\xfd",align:"center"}],rows:r?[x]:[],pagination:!1}),(0,t.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,t.jsxs)(o.Z,{variant:"body2",color:"text.secondary",children:["Chức năng: ",eU.m.getChucNangText(r.chucNang)," | Vị tr\xed:"," ",eU.m.getViTriCongText(r.viTriCong)," | Kiểu van:"," ",eU.m.getKieuVanChinhText(r.kieuVanChinh)," | Năm x\xe2y dựng:"," ",r.namXayDung||"Kh\xf4ng x\xe1c định"," | Năm n\xe2ng cấp: ",r.namNangCap||"Kh\xf4ng x\xe1c định"]})}),(0,t.jsxs)(a.Z,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[(0,t.jsx)(es.Z,{variant:"outlined",onClick:()=>{c(!0),"function"==typeof s&&r&&s(r)},sx:{mr:1},children:"Sửa"}),(0,t.jsx)(es.Z,{variant:"outlined",onClick:i,children:"Đ\xf3ng"})]})]})})]})]}):null},e$=i(34279),e0=e=>{let{open:n,onClose:i,khoVatTu:r,onDataChange:s,onEdit:d}=e,[h,c]=(0,l.useState)(!1),u=e=>null==e||""===e?"Kh\xf4ng x\xe1c định":e,x=r?{tenKho:u(r.tenKho),loaiKho:u(r.loaiKho),viTriKM:u(r.viTriKM),tenTuyenDe:u(r.tenTuyenDe),tenDoanDe:u(r.tenDoanDe),kichThuoc:u(r.kichThuoc),ketCau:u(r.ketCau),vatTu:u(r.vatTu),namXD:u(r.namXD)}:{};return r?(0,t.jsxs)(t.Fragment,{children:[h&&r&&(0,t.jsx)(eI,{open:h,onClose:()=>c(!1),onSaveComplete:()=>{c(!1),s&&s()},editKhoVatTu:r}),(0,t.jsxs)(ei.Z,{open:n,onClose:i,maxWidth:"xl",fullWidth:!0,children:[(0,t.jsxs)(et.Z,{sx:{py:2,px:3},children:[(0,t.jsx)(o.Z,{variant:"h6",gutterBottom:!0,color:"primary",textTransform:"uppercase",textAlign:"center",margin:0,children:"Th\xf4ng tin kho vật tư"}),(0,t.jsx)(eV.Z,{onClick:i,size:"small",sx:{ml:2},ariaLabel:"close"})]}),(0,t.jsx)(el.Z,{dividers:!0,sx:{p:3,overflowY:"auto",overflowX:"hidden",position:"relative"},children:(0,t.jsx)(a.Z,{sx:{width:"100%",overflowX:"auto",border:"1px solid #e0e0e0",borderRadius:1,background:"#f5f5f5","& .MuiTable-root":{minWidth:"max-content"},"& .MuiTableCell-root":{whiteSpace:"nowrap",fontSize:"0.75rem",padding:"6px 8px"},"& .MuiTableCell-head":{fontWeight:600,backgroundColor:"#f5f5f5"}},children:(0,t.jsx)(eH.Z,{columns:[{id:"tenKho",label:"T\xean kho",align:"center"},{id:"loaiKho",label:"Loại kho",align:"center"},{id:"viTriKM",label:"Vị tr\xed (Km)",align:"center"},{id:"tenTuyenDe",label:"Tuyến đ\xea",align:"center"},{id:"tenDoanDe",label:"Đoạn đ\xea",align:"center"},{id:"kichThuoc",label:"K\xedch thước",align:"center"},{id:"ketCau",label:"Kết cấu",align:"center"},{id:"vatTu",label:"Vật tư",align:"center"},{id:"namXD",label:"Năm XD",align:"center"}],rows:r?[x]:[],pagination:!1})})}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{startIcon:(0,t.jsx)(e$.Z,{}),variant:"outlined",color:"primary",onClick:()=>{c(!0),"function"==typeof d&&r&&d(r)},children:"Sửa"}),(0,t.jsx)(es.Z,{variant:"outlined",color:"primary",onClick:i,children:"Đ\xf3ng"})]})]})]}):null},e1=i(32604),e2=i(74841);let e5=()=>{let e=new Date,n=[];for(let i=-72;i<=72;i++){let t=new Date(e.getTime()+36e5*i),l="".concat(t.getDate(),"/").concat(t.getMonth()+1," ").concat(t.getHours(),"h"),a=5+.5*Math.sin(i/12)+(.3*Math.random()-.15);i>0&&(a+=.01*i),n.push({time:l,level:a.toFixed(2),type:i<=0?"actual":"forecast"})}return n};var e6=e=>{let{kmPoint:n}=e,[i,r]=(0,l.useState)(!0),[s,d]=(0,l.useState)([]);return((0,l.useEffect)(()=>{r(!0),setTimeout(()=>{d(e5()),r(!1)},500)},[n]),i)?(0,t.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,t.jsx)(K.Z,{size:30})}):(0,t.jsxs)(a.Z,{sx:{width:"100%",height:200,mt:2},children:[(0,t.jsx)(o.Z,{variant:"subtitle2",fontWeight:"bold",sx:{mb:1},children:"Biểu đồ mực nước trong 72 giờ qua v\xe0 dự b\xe1o 72 giờ tới"}),(0,t.jsx)(W.h,{width:"100%",height:"80%",children:(0,t.jsxs)(B.w,{children:[(0,t.jsx)(O.q,{strokeDasharray:"3 3"}),(0,t.jsx)(V.K,{dataKey:"time",tick:{fontSize:10},allowDuplicatedCategory:!1}),(0,t.jsx)(H.B,{label:{value:"Mực nước (m)",angle:-90,position:"insideLeft",style:{textAnchor:"middle"}},domain:["dataMin - 0.5","dataMax + 0.5"]}),(0,t.jsx)(R.u,{formatter:e=>["".concat(Number(e).toFixed(2),"m"),"Mực nước"]}),(0,t.jsx)(A.D,{}),(0,t.jsx)(X.x,{type:"monotone",dataKey:"level",name:"Mực nước thực tế",stroke:"#8884d8",strokeWidth:2,dot:!1,isAnimationActive:!1,connectNulls:!0,data:s.filter(e=>"actual"===e.type)}),(0,t.jsx)(X.x,{type:"monotone",dataKey:"level",name:"Dự b\xe1o",stroke:"#ff0000ff",strokeWidth:2,strokeDasharray:"5 5",dot:!1,isAnimationActive:!1,connectNulls:!0,data:s.filter(e=>"forecast"===e.type)})]})})]})},e3=i(14959),e8=i(60762),e4=i(37093),e7=i(44189),e9=i(89090),ne=e=>{let{open:n,onClose:i,position:r,selectedDoanDe:s,onSaveComplete:d}=e,h="SU_CO",[c,u]=(0,l.useState)({tenSuCo:"",diaDanh:"",viTriKM:"",dienBien:"",nguyenNhan:"",bienPhapXuLy:"",ketQuaXuLy:"",deXuatKienNghi:"",donViQuanLy:"",nguoiBaoCao:"",ghiChu:"",loaiSuCoId:"",tuyenDeId:"",doanDeId:"",loaiCongTrinhId:""}),[x,m]=(0,l.useState)([]),[j,p]=(0,l.useState)(!1),[b,v]=(0,l.useState)(!1),[C,f]=(0,l.useState)(null),[y,Z]=(0,l.useState)(null),[T,D]=(0,l.useState)([]),[,k]=(0,l.useState)([]),[S,L]=(0,l.useState)([]),w=(0,l.useRef)(null),{handleDataChange:F}=(0,ez.Y)();l.useEffect(()=>{n&&(z(),u(e=>({...e,toaDo:JSON.stringify({type:"Point",coordinates:[r[1],r[0]]}),tuyenDeId:(null==s?void 0:s.tuyenDeId)||"",doanDeId:(null==s?void 0:s.id)||"",viTriKM:(null==s?void 0:s.viTriTu)?"Km".concat(s.viTriTu," - Km").concat(s.viTriDen):"",diaDanh:(null==s?void 0:s.tenDoan)?"Đoạn đ\xea ".concat(s.tenDoan):""})))},[n,r,s]);let z=async()=>{try{var e,n;let[i,t,l]=await Promise.all([eP.H.getAllSuCoLoai({pageNumber:1,pageSize:1e3}),ep.I.getAllTuyenDe({pageNumber:1,pageSize:1e3}),ep.I.getAllLoaiCongTrinh(1,1e3)]);D((null==i?void 0:i.items)||[]),k((null==t?void 0:t.items)||[]),L((null==l?void 0:l.items)||[]);let a=null==l?void 0:null===(e=l.items)||void 0===e?void 0:e.find(e=>e.ma===h);if(a||(a=null==l?void 0:null===(n=l.items)||void 0===n?void 0:n.find(e=>e.maLoai===h)),a&&a.id){let e=a.id;u(n=>({...n,loaiCongTrinhId:e}))}}catch(e){console.error("Error loading dropdown data:",e)}},N=(e,n)=>{u(i=>({...i,[e]:n})),f(null)},M=e=>{m(n=>{let i=n.find(n=>n.id===e);return i&&URL.revokeObjectURL(i.preview),n.filter(n=>n.id!==e)})},P=async e=>{for(let n of x.filter(e=>!e.id)){let i=new FormData;for(let[t,l]of(i.append("SuCoDeId",e),i.append("File",n.file),i.append("Loai","image"===n.type?"Image":"Video"),i.append("TieuDe",n.file.name),i.append("ThuTu",x.indexOf(n).toString()),console.log("Uploading media file:",{fileName:n.file.name,fileSize:n.file.size,fileType:n.file.type,suCoDeId:e}),console.log("FormData contents:"),i.entries()))console.log(t,":",l);let t=await eP.H.uploadSuCoDeMedia(i);if(console.log("Upload result:",t),!t)throw Error("Failed to upload media: ".concat(n.file.name))}},W=async()=>{if(!c.tenSuCo.trim()){f("T\xean sự cố kh\xf4ng được để trống");return}v(!0),f(null),Z(null);try{let e={type:"Feature",geometry:{type:"Point",coordinates:[r[1],r[0]]},properties:{}},n=c.loaiCongTrinhId;if(!n){let e=S.find(e=>e.maLoai===h||e.maLoai===h);e&&e.id&&(n=e.id)}let i=S.find(e=>e.id===n),t={...c,loaiCongTrinhId:n,toaDo:e,kieuHinhHoc:"Point",maLoaiCongTrinh:(null==i?void 0:i.maLoai)||(null==i?void 0:i.maLoai)||h};console.log("Sending suCoData:",t);let l=await eP.H.createSuCoDe(t);l&&l.id&&(x.length>0&&await P(l.id),Z("Th\xeam sự cố th\xe0nh c\xf4ng!"),F(),setTimeout(()=>{d(),B()},1500))}catch(e){console.error("Error creating sự cố:",e),f("Lỗi khi th\xeam sự cố. Vui l\xf2ng thử lại.")}finally{v(!1)}},B=()=>{x.forEach(e=>{URL.revokeObjectURL(e.preview)}),u({tenSuCo:"",diaDanh:"",viTriKM:"",dienBien:"",nguyenNhan:"",bienPhapXuLy:"",ketQuaXuLy:"",deXuatKienNghi:"",donViQuanLy:"",nguoiBaoCao:"",ghiChu:"",loaiSuCoId:"",tuyenDeId:"",doanDeId:"",loaiCongTrinhId:""}),m([]),D([]),k([]),L([]),f(null),Z(null),v(!1),p(!1),i()};return(0,t.jsxs)(ei.Z,{open:n,onClose:b?void 0:B,maxWidth:"md",fullWidth:!0,children:[(0,t.jsxs)(et.Z,{sx:{py:2,px:3},children:[(0,t.jsx)(o.Z,{variant:"h6",gutterBottom:!0,color:"primary",textTransform:"uppercase",textAlign:"center",margin:0,children:"Th\xeam sự cố tại điểm"}),(0,t.jsx)(eV.Z,{onClick:i,size:"small",sx:{ml:2},ariaLabel:"close"})]}),(0,t.jsxs)(el.Z,{dividers:!0,children:[(0,t.jsxs)(eu.Z,{severity:"info",sx:{mb:2},children:[(0,t.jsxs)(o.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Tọa độ:"})," ",r[0].toFixed(6),"\xb0N, ",r[1].toFixed(6),"\xb0E"]}),s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(o.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Đoạn đ\xea:"})," ",s.tenDoan||"Chưa x\xe1c định"]}),(0,t.jsxs)(o.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Tuyến đ\xea:"})," ",s.tenTuyenDe||"Chưa x\xe1c định"]})]})]}),y&&(0,t.jsx)(eu.Z,{severity:"success",sx:{mb:2},children:y}),C&&(0,t.jsx)(eu.Z,{severity:"error",sx:{mb:2},children:C}),(b||j)&&(0,t.jsxs)(a.Z,{sx:{width:"100%",mb:2},children:[(0,t.jsx)(e3.Z,{}),(0,t.jsx)(o.Z,{variant:"body2",color:"text.secondary",sx:{mt:1},children:j?"Đang upload media...":"Đang lưu sự cố..."})]}),(0,t.jsxs)(I.ZP,{container:!0,spacing:3,children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:8,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",required:!0,label:"T\xean sự cố",value:c.tenSuCo,onChange:e=>N("tenSuCo",e.target.value),disabled:b})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:4,children:(0,t.jsx)(ea.Z,{options:T,size:"small",getOptionLabel:e=>e.ten||"",value:T.find(e=>e.id===c.loaiSuCoId)||null,onChange:(e,n)=>N("loaiSuCoId",(null==n?void 0:n.id)||""),disabled:b,renderInput:e=>(0,t.jsx)(eo.Z,{...e,label:"Loại sự cố"})})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",label:"Địa danh",value:c.diaDanh,onChange:e=>N("diaDanh",e.target.value),disabled:b})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",label:"Vị tr\xed KM",value:c.viTriKM,onChange:e=>N("viTriKM",e.target.value),disabled:b})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",multiline:!0,rows:3,label:"Diễn biến",value:c.dienBien,onChange:e=>N("dienBien",e.target.value),disabled:b})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",multiline:!0,rows:2,label:"Nguy\xean nh\xe2n",value:c.nguyenNhan,onChange:e=>N("nguyenNhan",e.target.value),disabled:b})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",multiline:!0,rows:2,label:"Biện ph\xe1p xử l\xfd",value:c.bienPhapXuLy,onChange:e=>N("bienPhapXuLy",e.target.value),disabled:b})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",label:"Đơn vị quản l\xfd",value:c.donViQuanLy,onChange:e=>N("donViQuanLy",e.target.value),disabled:b})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",label:"Người b\xe1o c\xe1o",value:c.nguoiBaoCao,onChange:e=>N("nguoiBaoCao",e.target.value),disabled:b})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",multiline:!0,rows:2,label:"Ghi ch\xfa",value:c.ghiChu,onChange:e=>N("ghiChu",e.target.value),disabled:b})})]}),(0,t.jsxs)(a.Z,{sx:{mt:3},children:[(0,t.jsx)(o.Z,{variant:"subtitle1",gutterBottom:!0,children:"Tải l\xean ảnh/video minh chứng"}),(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,t.jsx)(es.Z,{variant:"outlined",startIcon:(0,t.jsx)(eL.Z,{}),onClick:()=>{var e;null===(e=w.current)||void 0===e||e.click()},disabled:b,children:"Chọn ảnh/video"}),(0,t.jsx)(o.Z,{variant:"body2",color:"text.secondary",children:"Hỗ trợ: JPG, PNG, GIF, MP4, AVI, MOV"})]}),(0,t.jsx)("input",{ref:w,type:"file",multiple:!0,accept:"image/*,video/*",onChange:e=>{Array.from(e.target.files||[]).forEach(e=>{let n=e.type.startsWith("image/"),i=e.type.startsWith("video/");if(!n&&!i){f("Chỉ chấp nhận file ảnh hoặc video");return}let t={id:Date.now().toString()+Math.random(),file:e,type:n?"image":"video",preview:URL.createObjectURL(e)};m(e=>[...e,t])}),w.current&&(w.current.value="")},style:{display:"none"}}),x.length>0&&(0,t.jsx)(I.ZP,{container:!0,spacing:2,children:x.map(e=>(0,t.jsx)(I.ZP,{item:!0,xs:6,sm:4,md:3,children:(0,t.jsxs)(e8.Z,{sx:{position:"relative"},children:["image"===e.type?(0,t.jsx)(e4.Z,{component:"img",height:"120",image:e.preview,alt:e.file.name}):(0,t.jsx)(a.Z,{sx:{height:120,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"grey.200"},children:(0,t.jsx)(e7.Z,{sx:{fontSize:40,color:"grey.600"}})}),(0,t.jsx)(g.Z,{sx:{position:"absolute",top:4,right:4,bgcolor:"rgba(255,255,255,0.8)","&:hover":{bgcolor:"rgba(255,255,255,0.9)"}},size:"small",onClick:()=>M(e.id),disabled:b,children:(0,t.jsx)(e9.Z,{fontSize:"small"})}),(0,t.jsx)(o.Z,{variant:"caption",sx:{position:"absolute",bottom:0,left:0,right:0,bgcolor:"rgba(0,0,0,0.7)",color:"white",p:.5,fontSize:"0.7rem"},children:e.file.name})]})},e.id))})]})]}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{onClick:B,disabled:b,children:"Hủy"}),(0,t.jsx)(es.Z,{onClick:W,variant:"contained",disabled:b||!c.tenSuCo.trim(),startIcon:b?(0,t.jsx)(K.Z,{size:20}):null,children:b?"Đang lưu...":"Lưu sự cố"})]})]})},nn=e=>{let{position:n}=e,{selectedItem:i,handleViewDetails:r}=(0,ez.Y)(),[s,d]=(0,l.useState)(!1);return i?(0,t.jsxs)(e1.G,{position:n,closeButton:!0,closeOnClick:!1,autoPan:!0,children:[(0,t.jsxs)(a.Z,{sx:{py:1},children:[(()=>{var e,l;if("viTriTu"in i)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(o.Z,{variant:"subtitle1",fontWeight:"bold",sx:{mb:1},children:["Đoạn đ\xea: ",i.tenDoan||"Chưa c\xf3 t\xean"]}),(0,t.jsx)(m.Z,{sx:{mb:1}}),(0,t.jsxs)(o.Z,{variant:"subtitle2",sx:{mb:1},children:[(0,t.jsx)("strong",{children:"Tuyến đ\xea:"})," ",i.tenTuyenDe||"Chưa x\xe1c định"]}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Vị tr\xed:"})," Km",i.viTriTu," - Km",i.viTriDen]}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Cấp đ\xea:"})," ",i.capDe||"Chưa x\xe1c định"]}),(0,t.jsxs)(o.Z,{variant:"subtitle2",sx:{color:"primary.main",fontWeight:"medium"},children:[(0,t.jsx)("strong",{children:"Tọa độ điểm click:"})," ",n[0].toFixed(6),"\xb0N, ",n[1].toFixed(6),"\xb0E"]}),(null===(e=i.matCat)||void 0===e?void 0:e.danhGia)&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Đ\xe1nh gi\xe1:"})," ",i.matCat.danhGia]}),(0,t.jsx)(a.Z,{sx:{mt:2,display:"flex",gap:1},children:(0,t.jsx)(es.Z,{variant:"contained",size:"small",startIcon:(0,t.jsx)(C.Z,{}),onClick:()=>d(!0),sx:{fontSize:"0.8rem"},children:"Th\xeam sự cố tại điểm n\xe0y"})})]});if("tenKe"in i)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(o.Z,{variant:"subtitle1",fontWeight:"bold",sx:{mb:1},children:["K\xe8: ",i.tenKe||"Chưa c\xf3 t\xean"]}),(0,t.jsx)(m.Z,{sx:{mb:1}}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Loại k\xe8:"})," ",i.loaiCongTrinh||"Chưa x\xe1c định"]}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Địa điểm:"})," ",i.viTri||"Chưa x\xe1c định"]}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Chiều d\xe0i:"})," ",i.chieuDai||0," m"]})]});if("tenCuaKhau"in i)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Z,{variant:"subtitle1",fontWeight:"bold",sx:{mb:1},children:i.tenCuaKhau||"Chưa c\xf3 t\xean"}),(0,t.jsx)(m.Z,{sx:{mb:1}}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Loại:"})," ",i.loaiCongTrinh||"Chưa x\xe1c định"]}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Địa điểm:"})," ",i.diaDanh||"Chưa x\xe1c định"]})]});if("tenKho"in i)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(o.Z,{variant:"subtitle1",fontWeight:"bold",sx:{mb:1},children:["Kho vật tư: ",i.tenKho||"Chưa c\xf3 t\xean"]}),(0,t.jsx)(m.Z,{sx:{mb:1}}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Loại kho:"})," ",i.loaiKho||"Chưa x\xe1c định"]}),i.viTriKM&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Vị tr\xed:"})," Km",i.viTriKM]}),i.tenTuyenDe&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Tuyến đ\xea:"})," ",i.tenTuyenDe]}),i.tenDoanDe&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Đoạn đ\xea:"})," ",i.tenDoanDe]}),i.vatTu&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Vật tư:"})," ",i.vatTu]})]});if("tenDiemCanh"in i)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(o.Z,{variant:"subtitle1",fontWeight:"bold",sx:{mb:1},children:["Điếm: ",i.tenDiemCanh||"Chưa c\xf3 t\xean"]}),(0,t.jsx)(m.Z,{sx:{mb:1}}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Loại:"})," ",i.loaiCongTrinh||"Chưa x\xe1c định"]}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Địa điểm:"})," ",i.viTriKM||"Chưa x\xe1c định"]})]});if("tenCong"in i)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(o.Z,{variant:"subtitle1",fontWeight:"bold",sx:{mb:1},children:["Cống: ",i.tenCong||"Chưa c\xf3 t\xean"]}),(0,t.jsx)(m.Z,{sx:{mb:1}}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Loại:"})," ",i.loaiCongTrinh||i.maLoaiCongTrinh||"Chưa x\xe1c định"]}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Vị tr\xed:"})," ",i.viTriKm]}),i.tenTuyenDe&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Tuyến đ\xea:"})," ",i.tenTuyenDe]})]});if("tenSuCo"in i)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(o.Z,{variant:"subtitle1",fontWeight:"bold",sx:{mb:1},children:["Sự cố: ",i.tenSuCo||"Chưa c\xf3 t\xean"]}),(0,t.jsx)(m.Z,{sx:{mb:1}}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Loại sự cố:"})," ",i.tenLoaiSuCo||"Chưa x\xe1c định"]}),i.viTriKM&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Vị tr\xed:"})," Km",i.viTriKM]}),i.tenTuyenDe&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Tuyến đ\xea:"})," ",i.tenTuyenDe]}),i.diaDanh&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Địa danh:"})," ",i.diaDanh]}),i.thoiGianPhatHienText&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Thời gian ph\xe1t hiện:"})," ",i.thoiGianPhatHienText]}),void 0!==i.mucDoNguyHiem&&null!==i.mucDoNguyHiem&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Mức độ nguy hiểm:"})," ",["Thấp","Trung b\xecnh","Cao","Rất cao"][i.mucDoNguyHiem-1]||"Kh\xf4ng x\xe1c định"]}),i.trangThaiXuLy&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Trạng th\xe1i xử l\xfd:"})," ",i.trangThaiXuLy]})]});else if("viTri"in i&&!("tenKe"in i)&&!("tenKho"in i)&&!("viTriTu"in i)&&!("tenCuaKhau"in i))return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Z,{variant:"subtitle1",fontWeight:"bold",sx:{mb:1},children:i.viTri||i.tenCot||"Chưa c\xf3 t\xean"}),(0,t.jsx)(m.Z,{sx:{mb:1}}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Tuyến đ\xea:"})," ",i.tenTuyenDe||"Chưa x\xe1c định"]}),i.tenDoanDe&&(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Đoạn đ\xea:"})," ",i.tenDoanDe]}),(0,t.jsxs)(o.Z,{variant:"subtitle2",children:[(0,t.jsx)("strong",{children:"Km:"})," ",i.viTri||0]}),(0,t.jsx)(e6,{kmPoint:(null===(l=i.viTri)||void 0===l?void 0:l.toString())||"0"})]});return(0,t.jsx)(o.Z,{children:"Kh\xf4ng c\xf3 th\xf4ng tin"})})(),(0,t.jsx)(a.Z,{sx:{width:"100%",mt:2,display:"flex",justifyContent:"flex-end"},children:(0,t.jsx)(es.Z,{variant:"text",size:"small",color:"primary",onClick:r,startIcon:(0,t.jsx)(e2.Z,{}),children:"Xem chi tiết"})})]}),(0,t.jsx)(ne,{open:s,onClose:()=>d(!1),position:n,selectedDoanDe:i,onSaveComplete:()=>{d(!1)}})]}):null},ni=i(87643),nt=e=>{let{open:n,onClose:i,diemCanhDe:r,onEdit:s,onDataChange:d}=e,[h,c]=(0,l.useState)(!1),u=e=>null==e||""===e?"Kh\xf4ng x\xe1c định":e,x=r?{tenDiemCanh:u(r.tenDiemCanh),viTriKM:u(r.viTriKM),tuyenDe:u(r.tenTuyenDe),doanDe:u(r.tenDoanDe),kieuNhaTruc:u(r.kieuNhaTruc),soNguoiTruc:u(r.soNguoiTruc),moTa:u(r.moTa)}:{};return r?(0,t.jsxs)(t.Fragment,{children:[h&&r&&(0,t.jsx)(eN.Z,{open:h,onClose:()=>c(!1),onSaveComplete:()=>{c(!1),d&&d()},editDiemCanhDe:r}),(0,t.jsxs)(ei.Z,{open:n,onClose:i,maxWidth:"lg",fullWidth:!0,children:[(0,t.jsxs)(et.Z,{sx:{py:2,px:3},children:[(0,t.jsx)(o.Z,{variant:"h6",gutterBottom:!0,color:"primary",textTransform:"uppercase",textAlign:"center",margin:0,children:"Th\xf4ng tin điểm canh đ\xea"}),(0,t.jsx)(eV.Z,{onClick:i,size:"small",sx:{ml:2},ariaLabel:"close"})]}),(0,t.jsx)(el.Z,{dividers:!0,sx:{p:3,overflowY:"auto",overflowX:"hidden"},children:(0,t.jsx)(a.Z,{sx:{width:"100%",overflowX:"auto",border:"1px solid #e0e0e0",borderRadius:1,background:"#f5f5f5","& .MuiTable-root":{minWidth:"max-content"},"& .MuiTableCell-root":{whiteSpace:"nowrap",fontSize:"0.75rem",padding:"6px 8px"},"& .MuiTableCell-head":{fontWeight:600,backgroundColor:"#f5f5f5"}},children:(0,t.jsx)(eH.Z,{columns:[{id:"tenDiemCanh",label:"T\xean điểm canh đ\xea",align:"center"},{id:"viTriKM",label:"Vị tr\xed Km",align:"center"},{id:"tuyenDe",label:"Tuyến đ\xea",align:"center"},{id:"doanDe",label:"Đoạn đ\xea",align:"center"},{id:"kieuNhaTruc",label:"Kiểu nh\xe0 trực",align:"center"},{id:"soNguoiTruc",label:"Số người trực",align:"center"},{id:"moTa",label:"M\xf4 tả",align:"center"}],rows:r?[x]:[],pagination:!1})})}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{onClick:()=>{c(!0),"function"==typeof s&&r&&s(r)},variant:"outlined",color:"primary",children:"Sửa"}),(0,t.jsx)(es.Z,{onClick:i,variant:"outlined",color:"primary",children:"Đ\xf3ng"})]})]})]}):null},nl=i(79997),na=i(39153),no=i(45243),nr=i.n(no),ns=e=>{let n=(0,na.Sx)(),{filteredSuCoDeList:i,handleSuCoDeClick:t,layerLabelState:a}=(0,ez.Y)(),o=l.useRef(null),r=e.data||i;return l.useEffect(()=>{if(!n.getPane("sucoDePane")){let e=n.createPane("sucoDePane");e.style.zIndex="654",e.style.pointerEvents="auto"}},[n]),l.useEffect(()=>{if(o.current&&n.removeLayer(o.current),!r||0===r.length)return;let i=nr().featureGroup();return o.current=i,r.forEach(n=>{let l=n.toaDo;if(!l)return;if("string"==typeof l)try{l=JSON.parse(l)}catch(e){return}if(!l.geometry||!l.geometry.coordinates)return;let a=l.geometry.coordinates;if("Point"===l.geometry.type){if(!Array.isArray(a)||a.length<2)return;let l=a[1],o=a[0],r=nr().circleMarker([l,o],{radius:4,fillColor:"#FF0000",color:"#FFFFFF",weight:2,opacity:1,fillOpacity:.8,pane:"sucoDePane"});r.bindTooltip(n.tenSuCo||"Sự cố đ\xea",{permanent:e.showLabel||!1,direction:"top",className:"suco-tooltip"}),r.on("click",i=>{let l=i.latlng,a=e.onSuCoClick||t;a&&a(n,[l.lat,l.lng])}),r.addTo(i)}else if("LineString"===l.geometry.type||"MultiLineString"===l.geometry.type){let o=[];if("LineString"===l.geometry.type)o=a.map(e=>[e[1],e[0]]);else if("MultiLineString"===l.geometry.type){a.forEach(l=>{let a=l.map(e=>[e[1],e[0]]),o=nr().polyline(a,{color:"#FF0000",weight:4,opacity:.8,dashArray:"10, 10",pane:"sucoDePane"});o.on("click",i=>{let l=i.latlng,a=e.onSuCoClick||t;a&&a(n,[l.lat,l.lng])}),o.bindTooltip(n.tenSuCo||"Sự cố đ\xea",{sticky:!0,direction:"center",className:"suco-tooltip"}),o.addTo(i)});return}nr().polyline(o,{color:"#FFFFFF",weight:6,opacity:1,dashArray:"5, 5",pane:"sucoDePane"}).addTo(i);let r=nr().polyline(o,{color:"#FF0000",weight:2,opacity:.8,dashArray:"5, 5",pane:"sucoDePane"});r.on("click",i=>{let l=i.latlng,a=e.onSuCoClick||t;a&&a(n,[l.lat,l.lng])}),r.bindTooltip(n.tenSuCo||"Sự cố đ\xea",{sticky:!0,direction:"center",className:"suco-tooltip"}),r.addTo(i)}}),i.addTo(n),()=>{i&&n.removeLayer(i)}},[r,n,e.showLabel,e.onSuCoClick,t,a]),null},nd=i(76465),nh=e=>{let{open:n,onClose:i,onSaveComplete:r,editData:s}=e,[d,h]=(0,l.useState)({tenSuCo:"",diaDanh:"",viTriKM:"",dienBien:"",nguyenNhan:"",bienPhapXuLy:"",ketQuaXuLy:"",deXuatKienNghi:"",donViQuanLy:"",nguoiBaoCao:"",ghiChu:"",loaiSuCoId:"",tuyenDeId:"",doanDeId:"",loaiCongTrinhId:"",toaDo:"",kieuHinhHoc:"Point"}),[c,u]=(0,l.useState)([]),[x,m]=(0,l.useState)(!1),[j,p]=(0,l.useState)(null),[b,v]=(0,l.useState)(null),[C,f]=(0,l.useState)([]),[y,Z]=(0,l.useState)([]),[T,D]=(0,l.useState)([]),[k,S]=(0,l.useState)([]),L=(0,l.useRef)(null);(0,l.useEffect)(()=>{n&&Promise.all([eP.H.getAllSuCoLoai({pageNumber:1,pageSize:1e3}),ep.I.getAllTuyenDe({pageNumber:1,pageSize:1e3}),ep.I.getAllDoanDe({pageNumber:1,pageSize:1e3}),ep.I.getAllLoaiCongTrinh(1,1e3)]).then(e=>{let[n,i,t,l]=e;f((null==n?void 0:n.items)||[]),Z((null==i?void 0:i.items)||[]),D((null==t?void 0:t.items)||[]),S((null==l?void 0:l.items)||[])})},[n]),(0,l.useEffect)(()=>{s&&n&&h({...d,...s,toaDo:"object"==typeof s.toaDo?JSON.stringify(s.toaDo):s.toaDo||""})},[s,n]);let w=(e,n)=>{h(i=>({...i,[e]:n})),p(null)},F=e=>{u(n=>{let i=n.find(n=>n.id===e);return i&&URL.revokeObjectURL(i.preview),n.filter(n=>n.id!==e)})},z=async e=>{if(0!==c.length)for(let n of c){let i=new FormData;i.append("SuCoDeId",e),i.append("File",n.file),i.append("Loai","image"===n.type?"Image":"Video"),i.append("TieuDe",n.file.name),i.append("ThuTu",c.indexOf(n).toString()),await eP.H.uploadSuCoDeMedia(i)}},N=async()=>{if(!d.tenSuCo.trim()){p("T\xean sự cố kh\xf4ng được để trống");return}if(!d.toaDo.trim()){p("Tọa độ kh\xf4ng được để trống");return}m(!0),p(null),v(null);try{let e=d.toaDo;if("string"==typeof e&&e)try{e=JSON.parse(e)}catch(n){e=null}let n={...d,toaDo:e,maLoaiCongTrinh:"SU_CO"},i=await eP.H.createSuCoDe(n);i&&i.id&&(c.length>0&&await z(i.id),v("Th\xeam sự cố th\xe0nh c\xf4ng!"),setTimeout(()=>{r(),M()},1200))}catch(e){p("Lỗi khi th\xeam sự cố. Vui l\xf2ng thử lại.")}finally{m(!1)}},M=()=>{c.forEach(e=>URL.revokeObjectURL(e.preview)),h({tenSuCo:"",diaDanh:"",viTriKM:"",dienBien:"",nguyenNhan:"",bienPhapXuLy:"",ketQuaXuLy:"",deXuatKienNghi:"",donViQuanLy:"",nguoiBaoCao:"",ghiChu:"",loaiSuCoId:"",tuyenDeId:"",doanDeId:"",loaiCongTrinhId:"",toaDo:"",kieuHinhHoc:"Point"}),u([]),p(null),v(null),m(!1),i()};return(0,t.jsxs)(ei.Z,{open:n,onClose:x?void 0:M,maxWidth:"md",fullWidth:!0,children:[(0,t.jsx)(et.Z,{children:"Th\xeam sự cố đ\xea thủ c\xf4ng"}),(0,t.jsxs)(el.Z,{dividers:!0,children:[b&&(0,t.jsx)(eu.Z,{severity:"success",sx:{mb:2},children:b}),j&&(0,t.jsx)(eu.Z,{severity:"error",sx:{mb:2},children:j}),(0,t.jsxs)(I.ZP,{container:!0,spacing:3,children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:8,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",required:!0,label:"T\xean sự cố",value:d.tenSuCo,onChange:e=>w("tenSuCo",e.target.value),disabled:x})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:4,children:(0,t.jsx)(ea.Z,{options:C,size:"small",getOptionLabel:e=>e.ten||"",value:C.find(e=>e.id===d.loaiSuCoId)||null,onChange:(e,n)=>w("loaiSuCoId",(null==n?void 0:n.id)||""),disabled:x,renderInput:e=>(0,t.jsx)(eo.Z,{...e,label:"Loại sự cố"})})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(ea.Z,{options:y,size:"small",getOptionLabel:e=>e.tenTuyenDe||"",value:y.find(e=>e.id===d.tuyenDeId)||null,onChange:(e,n)=>w("tuyenDeId",(null==n?void 0:n.id)||""),disabled:x,renderInput:e=>(0,t.jsx)(eo.Z,{...e,label:"Tuyến đ\xea"})})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(ea.Z,{options:T,size:"small",getOptionLabel:e=>e.tenDoan||"",value:T.find(e=>e.id===d.doanDeId)||null,onChange:(e,n)=>w("doanDeId",(null==n?void 0:n.id)||""),disabled:x,renderInput:e=>(0,t.jsx)(eo.Z,{...e,label:"Đoạn đ\xea"})})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(ea.Z,{options:k,size:"small",getOptionLabel:e=>e.tenLoai||"",value:k.find(e=>e.id===d.loaiCongTrinhId)||null,onChange:(e,n)=>w("loaiCongTrinhId",(null==n?void 0:n.id)||""),disabled:x,renderInput:e=>(0,t.jsx)(eo.Z,{...e,label:"Loại c\xf4ng tr\xecnh"})})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",label:"Địa danh",value:d.diaDanh,onChange:e=>w("diaDanh",e.target.value),disabled:x})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",label:"Vị tr\xed KM",value:d.viTriKM,onChange:e=>w("viTriKM",e.target.value),disabled:x})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",multiline:!0,rows:3,label:"Diễn biến",value:d.dienBien,onChange:e=>w("dienBien",e.target.value),disabled:x})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",multiline:!0,rows:2,label:"Nguy\xean nh\xe2n",value:d.nguyenNhan,onChange:e=>w("nguyenNhan",e.target.value),disabled:x})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",multiline:!0,rows:2,label:"Biện ph\xe1p xử l\xfd",value:d.bienPhapXuLy,onChange:e=>w("bienPhapXuLy",e.target.value),disabled:x})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",label:"Đơn vị quản l\xfd",value:d.donViQuanLy,onChange:e=>w("donViQuanLy",e.target.value),disabled:x})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",label:"Người b\xe1o c\xe1o",value:d.nguoiBaoCao,onChange:e=>w("nguoiBaoCao",e.target.value),disabled:x})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",multiline:!0,rows:2,label:"Ghi ch\xfa",value:d.ghiChu,onChange:e=>w("ghiChu",e.target.value),disabled:x})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(eo.Z,{fullWidth:!0,size:"small",label:"Tọa độ (GeoJSON Feature object)",value:d.toaDo,onChange:e=>w("toaDo",e.target.value),disabled:x,multiline:!0,minRows:2,InputLabelProps:{shrink:!0},placeholder:'{"type":"Feature","geometry":{"type":"Point","coordinates":[106.123,20.456]},...}'})})]}),(0,t.jsxs)(a.Z,{sx:{mt:3},children:[(0,t.jsx)(o.Z,{variant:"subtitle1",gutterBottom:!0,children:"Tải l\xean ảnh/video minh chứng"}),(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,t.jsx)(es.Z,{variant:"outlined",startIcon:(0,t.jsx)(eL.Z,{}),onClick:()=>{var e;null===(e=L.current)||void 0===e||e.click()},disabled:x,children:"Chọn ảnh/video"}),(0,t.jsx)(o.Z,{variant:"body2",color:"text.secondary",children:"Hỗ trợ: JPG, PNG, GIF, MP4, AVI, MOV"})]}),(0,t.jsx)("input",{ref:L,type:"file",multiple:!0,accept:"image/*,video/*",onChange:e=>{Array.from(e.target.files||[]).forEach(e=>{let n=e.type.startsWith("image/"),i=e.type.startsWith("video/");if(!n&&!i){p("Chỉ chấp nhận file ảnh hoặc video");return}let t={id:Date.now().toString()+Math.random(),file:e,type:n?"image":"video",preview:URL.createObjectURL(e)};u(e=>[...e,t])}),L.current&&(L.current.value="")},style:{display:"none"}}),c.length>0&&(0,t.jsx)(I.ZP,{container:!0,spacing:2,children:c.map(e=>(0,t.jsx)(I.ZP,{item:!0,xs:6,sm:4,md:3,children:(0,t.jsxs)(e8.Z,{sx:{position:"relative"},children:["image"===e.type?(0,t.jsx)(e4.Z,{component:"img",height:"120",image:e.preview,alt:e.file.name}):(0,t.jsx)(a.Z,{sx:{height:120,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"grey.200"},children:(0,t.jsx)(e7.Z,{sx:{fontSize:40,color:"grey.600"}})}),(0,t.jsx)(g.Z,{sx:{position:"absolute",top:4,right:4,bgcolor:"rgba(255,255,255,0.8)","&:hover":{bgcolor:"rgba(255,255,255,0.9)"}},size:"small",onClick:()=>F(e.id),disabled:x,children:(0,t.jsx)(e9.Z,{fontSize:"small"})}),(0,t.jsx)(o.Z,{variant:"caption",sx:{position:"absolute",bottom:0,left:0,right:0,bgcolor:"rgba(0,0,0,0.7)",color:"white",p:.5,fontSize:"0.7rem"},children:e.file.name})]})},e.id))})]})]}),(0,t.jsxs)(er.Z,{children:[(0,t.jsx)(es.Z,{onClick:M,disabled:x,children:"Hủy"}),(0,t.jsx)(es.Z,{onClick:N,variant:"contained",disabled:x||!d.tenSuCo.trim()||!d.toaDo.trim(),startIcon:x?(0,t.jsx)(K.Z,{size:20}):null,children:x?"Đang lưu...":"Lưu sự cố"})]})]})},nc=i(41664),nu=i.n(nc),nx=i(3085),ng=e=>{let{open:n,onClose:i,suCoDe:s,onDataChange:d}=e,[h,c]=(0,l.useState)(!1),[u,x]=(0,l.useState)(null),[g,m]=(0,l.useState)(!1),j=e=>null==e||""===e?"Kh\xf4ng x\xe1c định":e,p=async()=>{if(null==s?void 0:s.id){m(!0);try{let e=await eP.H.getSuCoDeById(s.id);x(e),c(!0)}finally{m(!1)}}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(ei.Z,{open:n,onClose:i,maxWidth:"md",fullWidth:!0,children:[(0,t.jsxs)(et.Z,{children:["Th\xf4ng tin sự cố đ\xea",(0,t.jsx)(eV.Z,{onClick:i})]}),(0,t.jsx)(el.Z,{children:s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(a.Z,{sx:{mb:2},children:[(0,t.jsx)(o.Z,{variant:"h6",gutterBottom:!0,children:s.tenSuCo}),(0,t.jsxs)(I.ZP,{container:!0,spacing:2,sx:{mb:2},children:[(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(o.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Loại sự cố:"})," ",j(s.tenLoaiSuCo||s.phanNhom)]})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(o.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Vị tr\xed:"})," ",j(s.tenTuyenDe),", ",j(s.viTriKM)]})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(o.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Thời gian:"})," ",j(s.thoiGianPhatHienText||(e=>{if(!e)return"Kh\xf4ng x\xe1c định";try{return("string"==typeof e?new Date(e):e).toLocaleDateString("vi-VN")}catch(n){return String(e)}})(s.thoiGianPhatHien))]})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(o.Z,{variant:"body2",children:(0,t.jsx)("strong",{children:"Mức độ nguy hiểm:"})}),(0,t.jsx)(r.Z,{label:s.mucDoNguyHiem?"Mức ".concat(s.mucDoNguyHiem):"Chưa x\xe1c định",size:"small",style:{backgroundColor:(e=>{switch(e){case 1:return"#4CAF50";case 2:return"#8BC34A";case 3:return"#FFC107";case 4:return"#FF9800";case 5:return"#F44336";default:return"#757575"}})(s.mucDoNguyHiem),color:"#fff"}})]})}),(0,t.jsx)(I.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(o.Z,{variant:"body2",children:(0,t.jsx)("strong",{children:"Trạng th\xe1i:"})}),(0,t.jsx)(r.Z,{label:s.trangThaiXuLy||"Chưa x\xe1c định",size:"small",style:{backgroundColor:(e=>{switch(null==e?void 0:e.toLowerCase()){case"chưa xử l\xfd":return"#F44336";case"đang xử l\xfd":return"#FF9800";case"đ\xe3 xử l\xfd":return"#4CAF50";case"theo d\xf5i":return"#2196F3";default:return"#757575"}})(s.trangThaiXuLy),color:"#fff"}})]})})]})]}),(0,t.jsxs)(I.ZP,{container:!0,spacing:3,children:[(0,t.jsxs)(I.ZP,{item:!0,xs:12,md:6,children:[(0,t.jsx)(o.Z,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Th\xf4ng tin chi tiết"}),(0,t.jsxs)(a.Z,{sx:{ml:2},children:[(0,t.jsxs)(o.Z,{variant:"body2",gutterBottom:!0,children:[(0,t.jsx)("strong",{children:"Địa danh:"})," ",j(s.diaDanh)]}),(0,t.jsxs)(o.Z,{variant:"body2",gutterBottom:!0,children:[(0,t.jsx)("strong",{children:"Đơn vị quản l\xfd:"})," ",j(s.donViQuanLy)]}),(0,t.jsxs)(o.Z,{variant:"body2",gutterBottom:!0,children:[(0,t.jsx)("strong",{children:"Người b\xe1o c\xe1o:"})," ",j(s.nguoiBaoCao)]}),s.lienKetNgoai&&(0,t.jsxs)(o.Z,{variant:"body2",gutterBottom:!0,children:[(0,t.jsx)("strong",{children:"Li\xean kết hồ sơ:"})," ",(0,t.jsx)(nu(),{href:s.lienKetNgoai,target:"_blank",rel:"noopener noreferrer",children:s.lienKetNgoai})]}),(0,t.jsxs)(o.Z,{variant:"body2",gutterBottom:!0,children:[(0,t.jsx)("strong",{children:"Ghi ch\xfa:"})," ",j(s.ghiChu)]})]})]}),(0,t.jsxs)(I.ZP,{item:!0,xs:12,sm:6,children:[(0,t.jsx)(o.Z,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Diễn biến v\xe0 nguy\xean nh\xe2n"}),(0,t.jsxs)(a.Z,{sx:{ml:2},children:[(0,t.jsxs)(o.Z,{variant:"body2",gutterBottom:!0,children:[(0,t.jsx)("strong",{children:"Diễn biến:"})," ",j(s.dienBien)]}),(0,t.jsxs)(o.Z,{variant:"body2",gutterBottom:!0,children:[(0,t.jsx)("strong",{children:"Nguy\xean nh\xe2n:"})," ",j(s.nguyenNhan)]})]})]}),(0,t.jsxs)(I.ZP,{item:!0,xs:12,sm:6,children:[(0,t.jsx)(o.Z,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Xử l\xfd sự cố"}),(0,t.jsxs)(a.Z,{sx:{ml:2},children:[(0,t.jsxs)(o.Z,{variant:"body2",gutterBottom:!0,children:[(0,t.jsx)("strong",{children:"Biện ph\xe1p xử l\xfd:"})," ",j(s.bienPhapXuLy)]}),(0,t.jsxs)(o.Z,{variant:"body2",gutterBottom:!0,children:[(0,t.jsx)("strong",{children:"Kết quả xử l\xfd:"})," ",j(s.ketQuaXuLy)]}),(0,t.jsxs)(o.Z,{variant:"body2",gutterBottom:!0,children:[(0,t.jsx)("strong",{children:"Đề xuất, kiến nghị:"})," ",j(s.deXuatKienNghi)]})]})]})]}),(0,t.jsxs)(I.ZP,{item:!0,xs:12,sm:6,children:[(0,t.jsx)(o.Z,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Video/H\xecnh ảnh"}),s.media&&s.media.length>0?(0,t.jsx)(I.ZP,{container:!0,spacing:1,children:s.media.map(e=>{let n=(e.url||"").replace(/\\/g,"/").split("/"),i=n.slice(0,-1).join("/"),l=n[n.length-1],a="".concat(nx.apiUrl,"/file/readfile?FilePath=").concat(i,"&FileName=").concat(l);return(0,t.jsx)(I.ZP,{item:!0,xs:12,children:(0,t.jsx)(e8.Z,{sx:{height:"100%"},children:"Video"===e.loai?(0,t.jsx)(e4.Z,{component:"video",height:"260",src:a,controls:!0,sx:{objectFit:"contain"}}):(0,t.jsx)(e4.Z,{component:"img",height:"260",image:a,alt:e.tieuDe||"H\xecnh ảnh sự cố",sx:{objectFit:"contain"}})})},e.id)})}):(0,t.jsx)(o.Z,{variant:"body2",children:"Kh\xf4ng c\xf3 h\xecnh ảnh"})]}),(0,t.jsx)(a.Z,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:(0,t.jsx)(es.Z,{variant:"outlined",color:"primary",onClick:p,disabled:g,children:g?"Đang tải...":"Chỉnh sửa"})})]}):(0,t.jsx)(o.Z,{children:"Kh\xf4ng c\xf3 th\xf4ng tin sự cố"})})]}),h&&u&&(0,t.jsx)(nh,{open:h,onClose:()=>c(!1),onSaveComplete:()=>{c(!1),x(null),d&&d()},editData:u})]})},nm=e=>{let{open:n,onClose:i,hatQlyDe:l,onEdit:r}=e,s=e=>null==e||""===e?"Kh\xf4ng x\xe1c định":e,d=l?{tenHatQL:s(l.tenHatQL),tenLoaiCongTrinh:s(l.tenLoaiCongTrinh),viTriKm:s(l.viTriKm),diaChi:s(l.diaChi)}:{},h=l?{thuocHuyen:s(l.thuocHuyen),thuocTinh:s(l.thuocTinh)}:{},c=l?{dienThoai:s(l.dienThoai),fax:s(l.fax)}:{},u=l?{namXD:s(l.namXD),namTuBo:s(l.namTuBo),ketCau:s(l.ketCau)}:{},x=l?{chieuDaiQLy:s(l.chieuDaiQLy),khoQLy:s(l.khoQLy),tenTuyenDe:s(l.tenTuyenDe)}:{};return l?(0,t.jsxs)(ei.Z,{open:n,onClose:i,maxWidth:"md",fullWidth:!0,children:[(0,t.jsxs)(et.Z,{sx:{py:2,px:3},children:[(0,t.jsx)(o.Z,{variant:"h6",gutterBottom:!0,color:"primary",textTransform:"uppercase",textAlign:"center",margin:0,children:"Th\xf4ng tin Hạt Quản L\xfd Đ\xea"}),(0,t.jsx)(eV.Z,{onClick:i,size:"small",sx:{ml:2},ariaLabel:"close"})]}),(0,t.jsx)(el.Z,{dividers:!0,sx:{p:3,overflowY:"auto",overflowX:"hidden"},children:(0,t.jsxs)(I.ZP,{container:!0,spacing:2,children:[(0,t.jsxs)(I.ZP,{item:!0,xs:12,children:[(0,t.jsx)(o.Z,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Th\xf4ng tin cơ bản"}),(0,t.jsx)(a.Z,{sx:{width:"100%",overflowX:"auto",border:"1px solid #e0e0e0",borderRadius:1,background:"#f5f5f5"},children:(0,t.jsx)(eH.Z,{columns:[{id:"tenHatQL",label:"T\xean hạt quản l\xfd",align:"left"},{id:"tenLoaiCongTrinh",label:"Loại c\xf4ng tr\xecnh",align:"center"},{id:"viTriKm",label:"Vị tr\xed Km",align:"center"},{id:"diaChi",label:"Địa chỉ",align:"left"}],rows:l?[d]:[],pagination:!1})})]}),(0,t.jsxs)(I.ZP,{item:!0,xs:12,children:[(0,t.jsx)(o.Z,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Vị tr\xed địa l\xfd"}),(0,t.jsx)(a.Z,{sx:{width:"100%",overflowX:"auto",border:"1px solid #e0e0e0",borderRadius:1,background:"#f5f5f5"},children:(0,t.jsx)(eH.Z,{columns:[{id:"thuocHuyen",label:"Thuộc huyện",align:"center"},{id:"thuocTinh",label:"Thuộc tỉnh",align:"center"}],rows:l?[h]:[],pagination:!1})})]}),(0,t.jsxs)(I.ZP,{item:!0,xs:12,children:[(0,t.jsx)(o.Z,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Th\xf4ng tin li\xean hệ"}),(0,t.jsx)(a.Z,{sx:{width:"100%",overflowX:"auto",border:"1px solid #e0e0e0",borderRadius:1,background:"#f5f5f5"},children:(0,t.jsx)(eH.Z,{columns:[{id:"dienThoai",label:"Điện thoại",align:"center"},{id:"fax",label:"Fax",align:"center"}],rows:l?[c]:[],pagination:!1})})]}),(0,t.jsxs)(I.ZP,{item:!0,xs:12,children:[(0,t.jsx)(o.Z,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Th\xf4ng tin x\xe2y dựng"}),(0,t.jsx)(a.Z,{sx:{width:"100%",overflowX:"auto",border:"1px solid #e0e0e0",borderRadius:1,background:"#f5f5f5"},children:(0,t.jsx)(eH.Z,{columns:[{id:"namXD",label:"Năm x\xe2y dựng",align:"center"},{id:"namTuBo",label:"Năm tu bổ",align:"center"},{id:"ketCau",label:"Kết cấu",align:"left"}],rows:l?[u]:[],pagination:!1})})]}),(0,t.jsxs)(I.ZP,{item:!0,xs:12,children:[(0,t.jsx)(o.Z,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Th\xf4ng tin quản l\xfd"}),(0,t.jsx)(a.Z,{sx:{width:"100%",overflowX:"auto",border:"1px solid #e0e0e0",borderRadius:1,background:"#f5f5f5"},children:(0,t.jsx)(eH.Z,{columns:[{id:"chieuDaiQLy",label:"Chiều d\xe0i quản l\xfd (km)",align:"center"},{id:"khoQLy",label:"Kho quản l\xfd",align:"center"},{id:"tenTuyenDe",label:"Tuyến đ\xea",align:"left"}],rows:l?[x]:[],pagination:!1})})]})]})}),(0,t.jsxs)(er.Z,{children:[r&&(0,t.jsx)(es.Z,{variant:"outlined",color:"primary",onClick:()=>{r&&l&&r(l)},children:"Sửa"}),(0,t.jsx)(es.Z,{onClick:i,variant:"outlined",color:"primary",children:"Đ\xf3ng"})]})]}):null};let nj=()=>{let{doanDeList:e,keList:n,legendData:i,filteredDoanDeList:l,filteredKeList:h,filteredCotKMList:c,filteredKhoVatTuList:u,filteredDCanhList:x,filteredCongList:g,filteredSuCoDeList:m,filteredHatQlyDeList:j,selectedItem:p,dialogOpen:b,setDialogOpen:v,legendVisible:C,setLegendVisible:f,handleDikeClick:y,handleKeClick:Z,handleCotKMClick:T,handleKhoVatTuClick:D,handleCongClick:k,handleDataChange:S,handleDCanhClick:L,handleSuCoDeClick:w,popupOpen:K,popupPosition:I}=(0,ez.Y)();return(0,t.jsxs)("div",{style:{height:"100%",width:"100%",position:"relative",overflow:"hidden"},children:[(0,t.jsxs)(d.default,{boundaryFile:"",children:[(0,t.jsx)(eX.Z,{data:l,onDikeClick:y}),(0,t.jsx)(eE.Z,{data:h,onKeClick:Z}),(0,t.jsx)(e_.Z,{data:c,onCotClick:T}),(0,t.jsx)(eJ.Z,{data:u,onKhoVatTuClick:D}),(0,t.jsx)(eG.Z,{}),(0,t.jsx)(nl.Z,{}),(0,t.jsx)(ni.Z,{data:x,onDCanhClick:L}),(0,t.jsx)(nl.Z,{data:g,onCongClick:k}),(0,t.jsx)(ns,{data:m,onSuCoClick:w}),(0,t.jsx)(nd.Z,{data:j}),K&&I&&(0,t.jsx)(nn,{position:I})]}),(0,t.jsx)(eO,{visible:C,onToggle:()=>f(!C),onDataChange:S,legendData:i}),(e.length>0||n.length>0)&&(0,t.jsxs)(a.Z,{sx:{position:"absolute",bottom:10,left:10,zIndex:1e3,backgroundColor:"rgba(255, 255, 255, 0.9)",padding:1,borderRadius:1,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[(0,t.jsxs)(o.Z,{variant:"caption",sx:{color:"text.secondary"},children:["Hiển thị: ",l.length+h.length,"/",e.length+n.length," c\xf4ng tr\xecnh"]}),(l.length!==e.length||h.length!==n.length)&&(0,t.jsx)(r.Z,{label:"Đ\xe3 lọc",size:"small",color:"primary",sx:{ml:1,height:20,fontSize:"10px"}}),(0,t.jsx)("br",{}),(0,t.jsx)(o.Z,{variant:"caption",sx:{color:"text.secondary"},children:"Zoom về gần để hiển thị t\xean c\xf4ng tr\xecnh"})]}),!C&&(0,t.jsx)("button",{onClick:()=>f(!0),style:{position:"absolute",top:10,right:10,zIndex:1e3,backgroundColor:"white",border:"none",padding:10,borderRadius:6,cursor:"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",alignItems:"center"},children:(0,t.jsx)(s.Z,{style:{fontSize:18}})}),p&&"viTriTu"in p&&(0,t.jsx)(eR,{open:b,onClose:()=>v(!1),dike:p,onDataChange:S}),p&&"tenKe"in p&&(0,t.jsx)(eA,{open:b,onClose:()=>v(!1),ke:p,onDataChange:S}),p&&"viTri"in p&&!("tenKe"in p)&&!("tenKho"in p)&&!("viTriTu"in p)&&!("tenCuaKhau"in p)&&(0,t.jsx)(eQ,{open:b,onClose:()=>v(!1),cot:p,onDataChange:S}),p&&"tenCuaKhau"in p&&(0,t.jsx)(eq,{open:b,onClose:()=>v(!1),cuaKhau:p}),p&&"tenKho"in p&&(0,t.jsx)(e0,{open:b,onClose:()=>v(!1),khoVatTu:p,onDataChange:S}),p&&"tenDiemCanh"in p&&(0,t.jsx)(nt,{open:b,onClose:()=>v(!1),diemCanhDe:p,onDataChange:S}),p&&"tenSuCo"in p&&(0,t.jsx)(ng,{open:b,onClose:()=>v(!1),suCoDe:p,onDataChange:S}),p&&"tenCong"in p&&(0,t.jsx)(eY,{open:b,onClose:()=>v(!1),cong:p,onDataChange:S}),p&&"tenHatQL"in p&&(0,t.jsx)(nm,{open:b,onClose:()=>v(!1),hatQlyDe:p,onDataChange:S})]})};var np=()=>(0,t.jsx)(ez.x,{children:(0,t.jsx)(nj,{})})}}]);