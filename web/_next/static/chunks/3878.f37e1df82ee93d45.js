"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3878],{51052:function(e,t,n){var a=n(85893),r=n(67294),o=n(88196),l=n(92365),i=n(40110),c=n(44723),u=n(60990),s=n(26624),h=n(28907),d=n(68573),g=n(40492),y=n(50333),f=n(51015),m=n(96788),p=n(47407),v=n(19304),x=n(81873),L=n(32200),T=n(96727),b=n(97182),k=n(21773),Z=n(68963),C=n(36280),D=n(18708);t.Z=e=>{let{onClose:t,onSaveComplete:n,open:j,editItem:P}=e,[S,K]=(0,r.useState)(0),[E,N]=(0,r.useState)({tenHatQL:"",viTriKm:"",diaChi:"",thuocHuyen:"",thuocTinh:"",kichThuoc:"",ketCau:"",namXD:"",namTuBo:"",dienThoai:"",fax:"",chieuDaiQLy:0,khoQLy:0,toaDo:""}),[w,H]=(0,r.useState)(!1),[Q,I]=(0,r.useState)(null),[F,q]=(0,r.useState)(""),[O,A]=(0,r.useState)(""),[z,_]=(0,r.useState)(""),[J,W]=(0,r.useState)([]),[B,G]=(0,r.useState)([]),[M,R]=(0,r.useState)([]),[V,X]=(0,r.useState)([]),[Y,U]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{try{let e=(await D.I.getAllLoaiCongTrinh(1,1e3,!1)).items||[];W(e.map(e=>({id:e.id||"",tenLoai:e.tenLoai||""})));let t=e.find(e=>"HAT_QLY"===e.maLoai);t&&t.id&&q(t.id)}catch(e){I("Kh\xf4ng thể tải danh s\xe1ch loại c\xf4ng tr\xecnh")}})()},[]),(0,r.useEffect)(()=>{(async()=>{try{var e;let t=await D.I.getAllTuyenDe({pageNumber:1,pageSize:1e3});G((null===(e=t.items)||void 0===e?void 0:e.map(e=>({id:e.id||"",tenTuyenDe:e.tenTuyenDe||""})))||[])}catch(e){I("Kh\xf4ng thể tải danh s\xe1ch tuyến đ\xea")}})()},[]),(0,r.useEffect)(()=>{(async()=>{if(!O){R([]),_("");return}try{var e;let t=await D.I.getAllDoanDe({tuyenDeId:O,pageNumber:1,pageSize:1e3});R((null===(e=t.items)||void 0===e?void 0:e.map(e=>({id:e.id||"",tenDoanDe:e.tenDoan||""})))||[])}catch(e){I("Kh\xf4ng thể tải danh s\xe1ch đoạn đ\xea")}})()},[O]),(0,r.useEffect)(()=>{P&&j?(N({...P,toaDo:P.toaDo?JSON.stringify(P.toaDo):""}),q(P.loaiCongTrinhId||""),A(P.tuyenDeId||""),_(P.doanDeId||"")):j&&!P&&(N({tenHatQL:"",viTriKm:"",diaChi:"",thuocHuyen:"",thuocTinh:"",kichThuoc:"",ketCau:"",namXD:"",namTuBo:"",dienThoai:"",fax:"",chieuDaiQLy:0,khoQLy:0,toaDo:""}),A(""),_(""))},[P,j]);let $=(e,t)=>{N(n=>({...n,[e]:t}))},ee=async()=>{if(!E.tenHatQL){I("Vui l\xf2ng nhập t\xean hạt quản l\xfd đ\xea");return}if(!F){I("Vui l\xf2ng chọn loại c\xf4ng tr\xecnh");return}H(!0),I(null);try{let e={...E,loaiCongTrinhId:F||null,tuyenDeId:O||null,doanDeId:z||null,toaDo:E.toaDo?JSON.parse(E.toaDo):null};await C.Z.saveHatQlyDe(e),n(),t()}catch(e){I(e.message||"Lỗi khi lưu hạt quản l\xfd đ\xea")}finally{H(!1)}},et=async e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n)try{let e=await n.text(),t=JSON.parse(e);if(t.features&&Array.isArray(t.features)){let e=t.features.map(e=>{var t,n,a;let r=e.properties||{},o=e;if("string"==typeof o)try{o=JSON.parse(o)}catch(e){o=null}return{tenHatQL:r.Ten_HatQL||r.tenHatQL||"",viTriKm:r.Vitri_Km||r.viTriKm||"",diaChi:r.Dia_chi||r.diaChi||"",thuocHuyen:r.Thuoc_huyen||r.thuocHuyen||"",thuocTinh:r.Thuoc_tinh||r.thuocTinh||"",kichThuoc:(null===(t=r.Kich_thuoc)||void 0===t?void 0:t.toString())||"",ketCau:r.Ket_cau||r.ketCau||"",namXD:r.Nam_XD||r.namXD||"",namTuBo:r.Nam_tubo||r.namTuBo||"",dienThoai:(null===(n=r.Dien_thoai)||void 0===n?void 0:n.toString())||r.dienThoai||"",fax:(null===(a=r.Fax)||void 0===a?void 0:a.toString())||r.fax||"",chieuDaiQLy:parseFloat(r.Chdai_Qly||r.chieuDaiQLy||0),khoQLy:parseFloat(r.Kho_Qly||r.khoQLy||0),toaDo:o,loaiCongTrinhId:F||null,tuyenDeId:null,doanDeId:null}});X(e),I(null),U("Đ\xe3 tải ".concat(e.length," hạt quản l\xfd đ\xea từ file"))}else I("File GeoJSON kh\xf4ng đ\xfang định dạng")}catch(e){I("Lỗi khi đọc file GeoJSON: "+e.message)}},en=async()=>{if(0===V.length){I("Kh\xf4ng c\xf3 dữ liệu để lưu");return}if(!F){I("Kh\xf4ng t\xecm thấy loại c\xf4ng tr\xecnh cho hạt quản l\xfd đ\xea");return}H(!0),I(null),U("Đang lưu...");try{let e=V.map(e=>({...e,loaiCongTrinhId:e.loaiCongTrinhId||F}));await C.Z.saveMultipleHatQlyDe(e),U("Đ\xe3 lưu th\xe0nh c\xf4ng ".concat(V.length," hạt quản l\xfd đ\xea")),setTimeout(()=>{n(),t()},1500)}catch(e){I("Lỗi khi lưu dữ liệu: "+e.message)}finally{H(!1)}};return(0,a.jsxs)(o.Z,{open:j,onClose:t,maxWidth:"md",fullWidth:!0,children:[(0,a.jsx)(l.Z,{children:P?"Chỉnh sửa Hạt Quản L\xfd Đ\xea":"Th\xeam Hạt Quản L\xfd Đ\xea"}),(0,a.jsxs)(i.Z,{children:[Q&&(0,a.jsx)(c.Z,{severity:"error",sx:{mb:2},children:Q}),Y&&(0,a.jsx)(c.Z,{severity:"info",sx:{mb:2},children:Y}),!P&&(0,a.jsx)(u.Z,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,a.jsxs)(s.Z,{value:S,onChange:(e,t)=>K(t),children:[(0,a.jsx)(h.Z,{label:"Nhập thủ c\xf4ng"}),(0,a.jsx)(h.Z,{label:"Nhập h\xe0ng loạt (GeoJSON)"})]})}),(P||0===S)&&(0,a.jsxs)(d.ZP,{container:!0,spacing:2,sx:{mt:1},children:[(0,a.jsx)(d.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"T\xean hạt quản l\xfd *",value:E.tenHatQL||"",onChange:e=>$("tenHatQL",e.target.value),required:!0})}),(0,a.jsx)(d.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Vị tr\xed Km",value:E.viTriKm||"",onChange:e=>$("viTriKm",e.target.value)})}),(0,a.jsx)(d.ZP,{item:!0,xs:12,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Địa chỉ",value:E.diaChi||"",onChange:e=>$("diaChi",e.target.value)})}),(0,a.jsx)(d.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Thuộc huyện",value:E.thuocHuyen||"",onChange:e=>$("thuocHuyen",e.target.value)})}),(0,a.jsx)(d.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Thuộc tỉnh",value:E.thuocTinh||"",onChange:e=>$("thuocTinh",e.target.value)})}),(0,a.jsx)(d.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Điện thoại",value:E.dienThoai||"",onChange:e=>$("dienThoai",e.target.value)})}),(0,a.jsx)(d.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Fax",value:E.fax||"",onChange:e=>$("fax",e.target.value)})}),(0,a.jsx)(d.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Năm x\xe2y dựng",value:E.namXD||"",onChange:e=>$("namXD",e.target.value)})}),(0,a.jsx)(d.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Năm tu bổ",value:E.namTuBo||"",onChange:e=>$("namTuBo",e.target.value)})}),(0,a.jsx)(d.ZP,{item:!0,xs:12,children:(0,a.jsx)(y.Z,{options:J,getOptionLabel:e=>e.tenLoai,value:J.find(e=>e.id===F)||null,onChange:(e,t)=>q((null==t?void 0:t.id)||""),renderInput:e=>(0,a.jsx)(g.Z,{...e,label:"Loại c\xf4ng tr\xecnh *",required:!0})})}),(0,a.jsx)(d.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(y.Z,{options:B,getOptionLabel:e=>e.tenTuyenDe,value:B.find(e=>e.id===O)||null,onChange:(e,t)=>A((null==t?void 0:t.id)||""),renderInput:e=>(0,a.jsx)(g.Z,{...e,label:"Tuyến đ\xea"})})}),(0,a.jsx)(d.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(y.Z,{options:M,getOptionLabel:e=>e.tenDoanDe,value:M.find(e=>e.id===z)||null,onChange:(e,t)=>_((null==t?void 0:t.id)||""),disabled:!O,renderInput:e=>(0,a.jsx)(g.Z,{...e,label:"Đoạn đ\xea"})})}),(0,a.jsx)(d.ZP,{item:!0,xs:12,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Tọa độ (GeoJSON)",value:E.toaDo||"",onChange:e=>$("toaDo",e.target.value),multiline:!0,rows:3,placeholder:'{"type":"Point","coordinates":[lng,lat]}'})})]}),!P&&1===S&&(0,a.jsxs)(u.Z,{sx:{mt:2},children:[(0,a.jsxs)(u.Z,{sx:{mb:3,textAlign:"center"},children:[(0,a.jsxs)(f.Z,{variant:"contained",component:"label",startIcon:(0,a.jsx)(k.Z,{}),children:["Chọn file GeoJSON",(0,a.jsx)("input",{type:"file",hidden:!0,accept:".json,.geojson",onChange:et})]}),(0,a.jsx)(m.Z,{variant:"caption",display:"block",sx:{mt:1,color:"text.secondary"},children:"Hỗ trợ file: .json, .geojson"})]}),V.length>0&&(0,a.jsxs)(u.Z,{children:[(0,a.jsxs)(m.Z,{variant:"h6",gutterBottom:!0,children:["Danh s\xe1ch: ",V.length," hạt quản l\xfd đ\xea"]}),(0,a.jsxs)(p.Z,{sx:{maxHeight:400,overflow:"auto",border:"1px solid",borderColor:"divider",borderRadius:1},children:[V.slice(0,10).map((e,t)=>(0,a.jsx)(v.ZP,{divider:!0,secondaryAction:(0,a.jsx)(x.Z,{label:e.viTriKm||"N/A",size:"small",color:"primary",variant:"outlined"}),children:(0,a.jsx)(L.Z,{primary:e.tenHatQL,secondary:"".concat(e.diaChi||""," - ").concat(e.thuocHuyen||"")})},t)),V.length>10&&(0,a.jsx)(v.ZP,{children:(0,a.jsx)(L.Z,{primary:"... v\xe0 ".concat(V.length-10," mục kh\xe1c"),sx:{textAlign:"center",fontStyle:"italic"}})})]})]})]})]}),(0,a.jsxs)(T.Z,{children:[(0,a.jsx)(f.Z,{onClick:t,disabled:w,children:"Hủy"}),(P||0===S)&&(0,a.jsx)(f.Z,{onClick:ee,variant:"contained",startIcon:w?(0,a.jsx)(b.Z,{size:20}):(0,a.jsx)(Z.Z,{}),disabled:w||!E.tenHatQL||!F,children:w?"Đang lưu...":"Lưu"}),!P&&1===S&&(0,a.jsx)(f.Z,{onClick:en,variant:"contained",color:"primary",startIcon:w?(0,a.jsx)(b.Z,{size:20}):(0,a.jsx)(Z.Z,{}),disabled:w||0===V.length,children:w?"Đang lưu...":"Lưu ".concat(V.length," mục")})]})]})}},55395:function(e,t,n){var a=n(67294),r=n(39153),o=n(45243),l=n.n(o),i=n(29291),c=n(92893),u=n(36637);t.Z=e=>{let t=(0,r.Sx)(),n=a.useRef(null),o=a.useRef({}),s=a.useRef(null),h=(0,i.Y)(),d=e.data||h.filteredCotKMList,g=e.onCotKMClick||e.onCotClick||h.handleCotKMClick,y=h.layerLabelState,f=h.focusedId;return a.useEffect(()=>{if(!t.getPane("cotkmPane")){let e=t.createPane("cotkmPane");e.style.zIndex="651",e.style.pointerEvents="auto"}},[t]),a.useEffect(()=>{if(n.current&&t.removeLayer(n.current),!d||0===d.length)return;let e=l().featureGroup();return n.current=e,d.forEach((t,n)=>{try{let a=t.toaDo;if(!a){console.error("Cột km item ".concat(n," (").concat(t.viTri,") has no toaDo property"));return}if("string"==typeof a)try{a=JSON.parse(a)}catch(e){return}if(!a.geometry||!a.geometry.coordinates)return;let r=a.geometry.coordinates;if(!Array.isArray(r)||r.length<2)return;let i=r[1],s=r[0],d=t.color||"#000",f=(0,c.oN)(h.legendData,t),m=(0,u.L)(i,s,f,d,{pane:"cotkmPane"});t.maLoaiCongTrinh&&y[t.maLoaiCongTrinh]&&m.bindTooltip(t.viTri,{permanent:!0,className:"map-label cotkm-label",opacity:1}),m.on("click",e=>{let n=[e.latlng.lat,e.latlng.lng];g(t,n),l().DomEvent.stopPropagation(e)}),t.id&&(o.current[t.id]=m),e.addLayer(m)}catch(e){console.error("Error creating layer for cột km:",e)}}),e.addTo(t),e.bringToFront(),()=>{n.current&&t.removeLayer(n.current)}},[d,t,g,h.legendData,y]),a.useEffect(()=>{if(!t)return;let e=()=>{let e=t.getZoom();setTimeout(()=>{document.querySelectorAll(".cotkm-label").forEach(t=>{e<12?(t.style.display="none",t.style.opacity="0",t.style.visibility="hidden",t.classList.add("ke-hidden-tooltip")):(t.style.display="block",t.style.opacity="1",t.style.visibility="visible",t.classList.remove("ke-hidden-tooltip"))})},100)};return t.on("zoomend",e),e(),()=>{t.off("zoomend",e)}},[t]),a.useEffect(()=>{if(s.current)try{t.removeLayer(s.current),s.current=null}catch(e){}if(!f)return;let e=o.current[f];if(e)try{if(e.getLatLng){let n=e.getLatLng();t.flyTo(n,Math.max(t.getZoom(),15),{duration:.75});let a=l().circleMarker(n,{radius:10,color:"#000000",weight:3,opacity:.9,fillColor:"#000000",fillOpacity:.15,pane:"cotkmPane"});a.addTo(t),a.bringToFront(),s.current=a;return}}catch(e){console.error("Kh\xf4ng thể zoom tới cột km đ\xe3 chọn:",e)}},[f,t]),a.useEffect(()=>()=>{if(s.current)try{t.removeLayer(s.current)}catch(e){}},[t]),null}},2323:function(e,t,n){var a=n(67294),r=n(39153),o=n(45243),l=n.n(o),i=n(29291),c=n(92893),u=n(36637);t.Z=()=>{let e=(0,r.Sx)(),{filteredCuaKhauList:t,handleCuaKhauClick:n,layerLabelState:o,legendData:s}=(0,i.Y)(),h=a.useRef(null);return a.useEffect(()=>{if(!e.getPane("cuakhauPane")){let t=e.createPane("cuakhauPane");t.style.zIndex="652",t.style.pointerEvents="auto"}},[e]),a.useEffect(()=>{if(h.current&&e.removeLayer(h.current),!t||0===t.length)return;let a=l().featureGroup();return h.current=a,t.forEach(e=>{let t=e.toaDo;if(!t)return;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){return}if(!t.geometry||!t.geometry.coordinates)return;let r=t.geometry.coordinates,i=e.color||"#FF9800";if(!Array.isArray(r)||r.length<2)return;let h=r[1],d=r[0],g=(0,c.oN)(s,e),y=(0,u.L)(h,d,g,i,{pane:"cuakhauPane"});e.maLoaiCongTrinh&&o[e.maLoaiCongTrinh]&&y.bindTooltip(e.tenCuaKhau,{permanent:!0,className:"map-label cuakhau-label",opacity:1}),y.on("click",t=>{n(e,[t.latlng.lat,t.latlng.lng]),l().DomEvent.stopPropagation(t)}),a.addLayer(y)}),a.addTo(e),a.bringToFront(),()=>{h.current&&e.removeLayer(h.current)}},[t,e,n,o,s]),a.useEffect(()=>{if(!e)return;let t=()=>{let t=e.getZoom();setTimeout(()=>{document.querySelectorAll(".cuakhau-label").forEach(e=>{t<12?(e.style.display="none",e.style.opacity="0",e.style.visibility="hidden",e.classList.add("cuakhau-hidden-tooltip")):(e.style.display="block",e.style.opacity="1",e.style.visibility="visible",e.classList.remove("cuakhau-hidden-tooltip"))})},100)};return e.on("zoomend",t),t(),()=>{e.off("zoomend",t)}},[e]),null}},76465:function(e,t,n){var a=n(67294),r=n(39153),o=n(45243),l=n.n(o),i=n(29291),c=n(92893),u=n(36637);t.Z=e=>{let t=(0,r.Sx)(),n=a.useRef(null),o=a.useRef({}),s=a.useRef(null),h=(0,i.Y)(),d=e.data||h.filteredHatQlyDeList,g=e.onHatQlyDeClick||h.handleHatQlyDeClick,y=h.layerLabelState,f=h.focusedId;return a.useEffect(()=>{if(!t.getPane("hatqlydePane")){let e=t.createPane("hatqlydePane");e.style.zIndex="652",e.style.pointerEvents="auto"}},[t]),a.useEffect(()=>{if(n.current&&t.removeLayer(n.current),!d||0===d.length)return;let e=l().featureGroup();return n.current=e,d.forEach((t,n)=>{try{let a=t.toaDo;if(!a){console.error("Hạt quản l\xfd đ\xea item ".concat(n," (").concat(t.tenHatQL,") has no toaDo property"));return}if("string"==typeof a)try{a=JSON.parse(a)}catch(e){return}if(!a.geometry||!a.geometry.coordinates)return;let r=a.geometry.coordinates;if(!Array.isArray(r)||r.length<2)return;let i=r[1],s=r[0],d=t.color||"#FF5722",f=(0,c.oN)(h.legendData,t)||'\n          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n            <path fill="currentColor" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>\n          </svg>\n        ',m=(0,u.L)(i,s,f,d,{pane:"hatqlydePane"});(y.hatqlyde||y.HQD)&&m.bindTooltip(t.tenHatQL||"Hạt quản l\xfd đ\xea",{permanent:!0,className:"map-label hatqlyde-label",opacity:1,direction:"top",offset:[0,-10]}),m.on("click",e=>{let n=[e.latlng.lat,e.latlng.lng];g(t,n),l().DomEvent.stopPropagation(e)}),t.id&&(o.current[t.id]=m),e.addLayer(m)}catch(e){console.error("Error creating layer for hạt quản l\xfd đ\xea:",e)}}),e.addTo(t),e.bringToFront(),()=>{n.current&&t.removeLayer(n.current)}},[d,t,g,h.legendData,y]),a.useEffect(()=>{if(s.current)try{t.removeLayer(s.current),s.current=null}catch(e){}if(!f)return;let e=o.current[f];if(e)try{if(e.getLatLng){let n=e.getLatLng();t.flyTo(n,Math.max(t.getZoom(),15),{duration:.75});let a=l().circleMarker(n,{radius:10,color:"#FF5722",weight:3,opacity:.9,fillColor:"#FF5722",fillOpacity:.15,pane:"hatqlydePane"});a.addTo(t),a.bringToFront(),s.current=a;return}}catch(e){console.error("Kh\xf4ng thể zoom tới hạt quản l\xfd đ\xea đ\xe3 chọn:",e)}},[f,t]),a.useEffect(()=>()=>{if(s.current)try{t.removeLayer(s.current)}catch(e){}},[t]),null}},647:function(e,t,n){var a=n(67294),r=n(39153),o=n(45243),l=n.n(o),i=n(29291),c=n(92893),u=n(36637);let s=(e,t)=>{let n=(e.loaiKho||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),a="bai"===n||n.includes("bai"),r=n.includes("nha kho")||n.includes("nhakho");return a&&r?'<svg width="25" height="25" viewBox="0 0 118 128" xmlns="http://www.w3.org/2000/svg">\n<g transform="translate(0,-10) scale(1)">\n    <rect x="20" y="50" width="60" height="60" fill="#000" stroke="#000" stroke-width="2"/> \n  </g>\n  <g transform="translate(15,25) scale(1)">\n    <polygon points="15,110 50,50 59,66 72,40 103,110" fill="red"/>\n  </g> \n</svg>':a?'<svg width="20" height="20" viewBox="0 0 118 128" xmlns="http://www.w3.org/2000/svg">\n  <polygon points="15,110 50,50 59,66 72,40 103,110" fill="red"/>\n</svg>':t};t.Z=e=>{let t=(0,r.Sx)(),n=a.useRef(null),o=a.useRef({}),h=a.useRef(null),d=(0,i.Y)(),g=d.layerLabelState,y=e.data||d.filteredKhoVatTuList,f=e.onKhoVatTuClick||d.handleKhoVatTuClick,m=d.focusedId;return a.useEffect(()=>{if(!t.getPane("khoVatTuPane")){let e=t.createPane("khoVatTuPane");e.style.zIndex="652",e.style.pointerEvents="auto"}},[t]),a.useEffect(()=>{if(n.current&&t.removeLayer(n.current),!y||0===y.length)return;let e=l().featureGroup();return n.current=e,y.forEach((t,n)=>{try{let a=t.toaDo;if(!a){console.error("Kho vật tư item ".concat(n," (").concat(t.tenKho,") has no toaDo property"));return}if("string"==typeof a)try{a=JSON.parse(a)}catch(e){console.error("Failed to parse toaDo string for kho vật tư ".concat(t.tenKho,":"),e);return}if(!a){console.error("Kho vật tư item ".concat(n," (").concat(t.tenKho,") has invalid toaDo after parsing"));return}if(!a.geometry){console.error("Kho vật tư item ".concat(n," (").concat(t.tenKho,") has invalid GeoJSON: missing geometry property"),a);return}if(!a.geometry.coordinates){console.error("Kho vật tư item ".concat(n," (").concat(t.tenKho,") has invalid GeoJSON: missing coordinates property"),a.geometry);return}let r=a.geometry.coordinates;if(!Array.isArray(r)||r.length<2){console.error("Invalid coordinates for kho vật tư ".concat(t.tenKho,":"),r);return}let i=r[1],h=r[0],y=t.color||"#FF9800",m=(0,c.oN)(d.legendData,t),p=s(t,m),v=(0,u.L)(i,h,p,y,{pane:"khoVatTuPane"});t.maLoaiCongTrinh&&g[t.maLoaiCongTrinh]&&v.bindTooltip(t.tenKho,{permanent:!0,className:"map-label kho-vat-tu-label",opacity:1}),v.on("click",e=>{let n=[e.latlng.lat,e.latlng.lng];f(t,n),l().DomEvent.stopPropagation(e)}),t.id&&(o.current[t.id]=v),e.addLayer(v)}catch(e){console.error("Error creating marker for kho vật tư ".concat(t.tenKho,":"),e)}}),e.addTo(t),()=>{n.current&&t.removeLayer(n.current)}},[t,y,g,f,d.legendData]),a.useEffect(()=>{if(h.current)try{t.removeLayer(h.current),h.current=null}catch(e){}if(!m)return;let e=o.current[m];if(e)try{if(e.getLatLng){let n=e.getLatLng();t.flyTo(n,Math.max(t.getZoom(),15),{duration:.75});let a=l().circleMarker(n,{radius:10,color:"#FF9800",weight:3,opacity:.9,fillColor:"#FF9800",fillOpacity:.15,pane:"khoVatTuPane"});a.addTo(t),a.bringToFront(),h.current=a;return}}catch(e){console.error("Kh\xf4ng thể zoom tới kho vật tư đ\xe3 chọn:",e)}},[m,t]),a.useEffect(()=>()=>{if(h.current)try{t.removeLayer(h.current)}catch(e){}},[t]),null}}}]);