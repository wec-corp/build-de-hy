"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5070],{69200:function(e,t,n){n.r(t),n.d(t,{AutoBounds:function(){return _},BaseGeoJSON:function(){return v},MapStatePreserver:function(){return w},default:function(){return S},defaultDeConfig:function(){return k}});var o=n(85893),i=n(67294),r=n(39153),s=n(32342),a=n(84867),c=n(5715),l=n(26467),d=n(60990),h=n(93454),x=n(97182),p=n(96788),g=n(45243),m=n.n(g);n(53183);var u=n(11163),f=n(20577),y=n(32604);let j=m().divIcon({className:"custom-location-marker",html:'<div class="location-marker-inner"></div>',iconSize:[16,16],iconAnchor:[8,16]});var b=()=>{let[e,t]=(0,i.useState)(null),n=(0,r.Sx)();return((0,i.useEffect)(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{let{latitude:n,longitude:o}=e.coords;t([n,o])},e=>{console.error("Kh\xf4ng lấy được vị tr\xed:",e)})},[n]),e)?(0,o.jsx)(f.J,{position:e,icon:j,children:(0,o.jsx)(y.G,{children:"Vị tr\xed hiện tại của bạn"})}):null};let{BaseLayer:Z}=s.LayersControl,v=e=>{let{data:t,style:n={color:"#3388ff",weight:2,opacity:1,fillOpacity:.2},interactive:i=!1,onEachFeature:r}=e;return(0,o.jsx)(a.Q,{data:t,style:n,interactive:i,onEachFeature:r})},_=e=>{let{geojsonData:t,markers:n=[],fitOnce:o=!0}=e,s=(0,r.Sx)(),a=i.useRef(!1);return(0,i.useEffect)(()=>{if(o&&a.current||!t||0===t.length)return;let e=m().latLngBounds([]);t.forEach(t=>{if(t&&t.features){let n=m().geoJSON(t);e.extend(n.getBounds())}}),n&&n.length>0&&n.forEach(t=>{t.position&&e.extend(t.position)}),e.isValid()&&(s.fitBounds(e,{padding:[50,50]}),a.current=!0)},[s,t,n,o]),null},w=()=>{let e=(0,r.Sx)(),[t]=i.useState({zoom:e.getZoom(),center:e.getCenter()}),n=i.useRef({zoom:t.zoom,center:t.center,isMoving:!1});return i.useEffect(()=>{let t=()=>{n.current={zoom:e.getZoom(),center:e.getCenter(),isMoving:!1}},o=()=>{n.current.isMoving=!0},i=()=>{n.current.isMoving=!1,t()};return e.on("zoomend",t),e.on("movestart",o),e.on("moveend",i),()=>{e.off("zoomend",t),e.off("movestart",o),e.off("moveend",i)}},[e]),i.useEffect(()=>{if(!n.current.isMoving){let{zoom:t,center:o}=n.current;e.getZoom()===t&&e.getCenter().equals(o)||e.setView(o,t,{animate:!1})}}),null},k={bingKey:"AuhiCJHlGzhg93IqUH_oCpl_-ZUrIE6SPftlyGYUvr9Amx5nzA-WqGcPquyFZl4L",mapCenter:[20.65,106.1],mapZoom:10,maxBounds:[[20,104.8],[21.2,106.85]]};var S=e=>{let{children:t,config:n,loading:r}=e,g={...k,...n},[f,y]=(0,i.useState)(null),[j,v]=(0,i.useState)(null),[_,S]=(0,i.useState)(!0),{basePath:I}=(0,u.useRouter)(),[C]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{let e=async()=>{try{let e=await fetch("".concat(I,"/geojson/phuongxa-hye.geojson")),t=await e.json();C&&v(t)}catch(e){console.error("Kh\xf4ng thể tải phuongxa-hye.geojson:",e)}};(async()=>{S(!0);try{let e=await fetch("".concat(I,"/geojson/hye.geojson")),t=await e.json();y(t)}catch(e){console.error("Kh\xf4ng thể tải boundary geojson:",e)}finally{S(!1)}})(),e()},[I]),(0,o.jsx)(d.Z,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,o.jsxs)(h.Z,{elevation:3,sx:{flex:1,position:"relative",overflow:"hidden",borderRadius:"8px"},children:[(_||r)&&(0,o.jsxs)(d.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(255,255,255,0.7)",zIndex:1500},children:[(0,o.jsx)(x.Z,{color:"error"}),(0,o.jsx)(p.Z,{variant:"body2",sx:{ml:2},children:"Đang tải dữ liệu bản đồ..."})]}),(0,o.jsxs)(c.h,{center:g.mapCenter,zoom:g.mapZoom,minZoom:10,maxBounds:g.maxBounds,maxBoundsViscosity:1,style:{height:"100%",width:"100%"},attributionControl:!1,children:[(0,o.jsxs)(s.LayersControl,{position:"bottomright",children:[(0,o.jsx)(Z,{name:"Bản đồ h\xe0nh ch\xednh",children:(0,o.jsx)(l.I,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"})}),(0,o.jsx)(Z,{checked:!0,name:"Bản đồ vệ tinh",children:(0,o.jsx)(l.I,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles \xa9 Esri"})}),(0,o.jsx)(Z,{name:"Bản đồ nền x\xe1m",children:(0,o.jsx)(l.I,{url:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",attribution:"\xa9 CartoDB"})})]}),f&&(0,o.jsx)(a.Q,{data:f,style:{color:"#ffffffff",weight:2,fill:!1,fillOpacity:.25},interactive:!1}),j&&(0,o.jsx)(a.Q,{data:j,style:{color:"#ffffff83",weight:1.2,dashArray:"3, 3"},interactive:!0,onEachFeature:(e,t)=>{if(t.on({mouseover:e=>{let t=e.target;t.setStyle({weight:2,opacity:1,dashArray:"2, 2",color:"#0088ff"}),m().Browser.ie||m().Browser.opera||m().Browser.edge||t.bringToFront()},mouseout:e=>{e.target.setStyle({color:"#ffffff83",weight:1.2,opacity:.8,fillOpacity:.01,dashArray:"3, 3"})}}),e.properties&&e.properties.ten_xa){let n=(e=>{try{if(e.includes("\xc3"))return decodeURIComponent(escape(e));return e}catch(t){return console.error("Lỗi giải m\xe3 t\xean x\xe3:",t),e}})(e.properties.ten_xa),o=t.getBounds().getCenter();t.bindTooltip(n,{permanent:!0,direction:"center",className:"phuong-xa-tooltip map-label",opacity:1,offset:[0,0]}),t.on("tooltipopen",function(e){try{let t=e.tooltip;t&&"function"==typeof t.setLatLng&&t.setLatLng(o)}catch(e){console.error("Lỗi khi định vị tooltip:",e)}})}}}),t,(0,o.jsx)(b,{}),(0,o.jsx)(w,{})]})]})})}},5070:function(e,t,n){n.r(t);var o=n(85893),i=n(67294),r=n(97762),s=n(20577),a=n(64049),c=n(60762),l=n(34375),d=n(52857),h=n(60990),x=n(96788),p=n(71919),g=n(47407),m=n(19304),u=n(32200),f=n(81873),y=n(56912),j=n(56894),b=n(65806),Z=n(12166),v=n(95639),_=n(37638),w=n(78233),k=n(48809),S=n(35783),I=n(45243),C=n.n(I),z=n(69200);let B=e=>C().divIcon({className:"incident-marker incident-".concat(e),html:"<div></div>",iconSize:C().point(20,20),iconAnchor:C().point(10,10),popupAnchor:C().point(0,-10)}),T=()=>{let e=r.renderToString((0,o.jsx)(k.Z,{sx:{color:"#0066cc",fontSize:20}}));return C().divIcon({className:"culvert-marker",html:'<div style="display: flex; align-items: center; justify-content: center;">'.concat(e,"</div>"),iconSize:[24,24],iconAnchor:[12,12]})},P=[{id:"sc1",name:"Sự cố sạt lở đ\xea Hữu Hồng",position:[20.716,106.416],status:"danger",description:"Sạt lở đ\xea K52+500, d\xe0i 15m, rộng 5m, s\xe2u 1.2m",date:"15/05/2023"},{id:"sc2",name:"Sự cố thấm đ\xea Hữu Luộc",position:[20.709,106.418],status:"warning",description:"Thấm đ\xea K36+200, thấm k\xe9o d\xe0i 20m",date:"22/04/2023"},{id:"sc3",name:"Sự cố nứt đ\xea Tả Tr\xe0 L\xfd",position:[20.705,106.394],status:"danger",description:"Nứt đ\xea K28+700, d\xe0i 5m, rộng 0.3m",date:"30/03/2023"},{id:"sc4",name:"Sự cố sụt l\xfan cống Việt H\xf9ng",position:[20.483,106.202],status:"warning",description:"Sụt l\xfan cống qua đ\xea bối Việt H\xf9ng, đường k\xednh 0.8m",date:"05/04/2023"},{id:"sc5",name:"Sự cố thấm đ\xea biển số 5",position:[20.477,106.225],status:"danger",description:"Thấm đ\xea biển K15+300, thấm k\xe9o d\xe0i 25m",date:"12/05/2023"}],A=e=>{let{incident:t,onClose:n}=e;if(!t)return null;let i="danger"===t.status?"#d32f2f":"#f57c00",r="danger"===t.status?_.Z:w.Z;return(0,o.jsxs)(c.Z,{sx:{position:"absolute",bottom:20,left:20,maxWidth:400,zIndex:1e3,opacity:0,transform:"translateY(20px)",animation:"slideIn 0.3s ease forwards","@keyframes slideIn":{"0%":{opacity:0,transform:"translateY(20px)"},"100%":{opacity:1,transform:"translateY(0)"}}},children:[(0,o.jsx)(l.Z,{action:(0,o.jsx)(d.Z,{onClick:n,children:(0,o.jsx)(v.Z,{})}),title:(0,o.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,o.jsx)(r,{sx:{color:i}}),(0,o.jsx)(x.Z,{variant:"subtitle1",sx:{color:i,fontWeight:"bold"},children:t.name})]})}),(0,o.jsx)(p.Z,{children:(0,o.jsxs)(g.Z,{children:[(0,o.jsx)(m.ZP,{sx:{"&:hover":{bgcolor:"action.hover",transition:"background-color 0.2s"},borderRadius:1},children:(0,o.jsx)(u.Z,{primary:"M\xf4 tả chi tiết",secondary:t.description,primaryTypographyProps:{variant:"caption",color:"text.secondary"},secondaryTypographyProps:{variant:"body2"}})}),(0,o.jsx)(m.ZP,{sx:{"&:hover":{bgcolor:"action.hover",transition:"background-color 0.2s"},borderRadius:1},children:(0,o.jsx)(u.Z,{primary:"Thời gian ph\xe1t hiện",secondary:t.date,primaryTypographyProps:{variant:"caption",color:"text.secondary"},secondaryTypographyProps:{variant:"body2"}})}),(0,o.jsx)(m.ZP,{sx:{"&:hover":{bgcolor:"action.hover",transition:"background-color 0.2s"},borderRadius:1},children:(0,o.jsx)(u.Z,{primary:"Mức độ nghi\xeam trọng",secondary:(0,o.jsx)(f.Z,{label:"danger"===t.status?"Nghi\xeam trọng":"Cần theo d\xf5i",color:"danger"===t.status?"error":"warning",size:"small",sx:{mt:.5}}),primaryTypographyProps:{variant:"caption",color:"text.secondary"}})}),(0,o.jsx)(m.ZP,{sx:{"&:hover":{bgcolor:"action.hover",transition:"background-color 0.2s"},borderRadius:1},children:(0,o.jsx)(u.Z,{primary:"Vị tr\xed (lat, lng)",secondary:"".concat(t.position[0].toFixed(5),", ").concat(t.position[1].toFixed(5)),primaryTypographyProps:{variant:"caption",color:"text.secondary"},secondaryTypographyProps:{variant:"body2"}})})]})})]})};t.default=()=>{let[e]=(0,i.useState)(P),[t]=(0,i.useState)([]),[n]=(0,i.useState)(!0),[r,c]=(0,i.useState)(null),[l,d]=(0,i.useState)({tbi_detw:!0,hye_detw:!0,tbi_dedp:!0,hye_dedp:!0,hye_cong:!0,tbi_ke:!0,hye_ke:!0,incidents:!0}),p=e=>{d(t=>({...t,[e]:!t[e]}))};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(h.Z,{sx:{position:"absolute",top:10,right:10,zIndex:1e3,bgcolor:"rgba(255,255,255,0.9)",p:1.5,borderRadius:"4px",maxWidth:"320px",maxHeight:"80%",overflow:"auto",boxShadow:"0 2px 10px rgba(0,0,0,0.1)"},children:[(0,o.jsx)(x.Z,{variant:"subtitle2",sx:{fontWeight:"bold",color:"#d32f2f",mb:1},children:"Th\xf4ng tin bản đồ sự cố c\xf4ng tr\xecnh"}),(0,o.jsxs)(x.Z,{variant:"caption",display:"block",sx:{mb:1},children:["• ",l.incidents?e.length:0," sự cố c\xf4ng tr\xecnh được hiển thị"]}),(0,o.jsx)(y.Z,{sx:{my:1}}),(0,o.jsx)(x.Z,{variant:"caption",sx:{fontWeight:"bold",display:"block",mb:.5,color:"#d32f2f"},children:"Ch\xfa th\xedch:"}),(0,o.jsxs)(j.Z,{sx:{mb:1},children:[(0,o.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,o.jsx)(b.Z,{control:(0,o.jsx)(Z.Z,{size:"small",checked:l.tbi_detw||l.hye_detw,onChange:()=>{p("tbi_detw"),p("hye_detw")},sx:{color:"#d62728"}}),label:(0,o.jsx)(x.Z,{variant:"caption",children:"Đ\xea cấp I"})}),(0,o.jsx)(h.Z,{sx:{width:20,height:3,bgcolor:"#d62728",ml:-1}})]}),(0,o.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,o.jsx)(b.Z,{control:(0,o.jsx)(Z.Z,{size:"small",checked:l.tbi_detw||l.hye_detw,onChange:()=>{p("tbi_detw"),p("hye_detw")},sx:{color:"#ff7f0e"}}),label:(0,o.jsx)(x.Z,{variant:"caption",children:"Đ\xea cấp II"})}),(0,o.jsx)(h.Z,{sx:{width:20,height:3,bgcolor:"#ff7f0e",ml:-1}})]}),(0,o.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,o.jsx)(b.Z,{control:(0,o.jsx)(Z.Z,{size:"small",checked:l.tbi_dedp||l.hye_dedp,onChange:()=>{p("tbi_dedp"),p("hye_dedp")},sx:{color:"#2ca02c"}}),label:(0,o.jsx)(x.Z,{variant:"caption",children:"Đ\xea cấp III"})}),(0,o.jsx)(h.Z,{sx:{width:20,height:3,bgcolor:"#2ca02c",ml:-1}})]}),(0,o.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,o.jsx)(b.Z,{control:(0,o.jsx)(Z.Z,{size:"small",checked:l.tbi_dedp||l.hye_dedp,onChange:()=>{p("tbi_dedp"),p("hye_dedp")},sx:{color:"#9467bd"}}),label:(0,o.jsx)(x.Z,{variant:"caption",children:"Đ\xea cấp IV"})}),(0,o.jsx)(h.Z,{sx:{width:20,height:3,bgcolor:"#9467bd",ml:-1}})]}),(0,o.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,o.jsx)(b.Z,{control:(0,o.jsx)(Z.Z,{size:"small",checked:l.tbi_dedp||l.hye_dedp,onChange:()=>{p("tbi_dedp"),p("hye_dedp")},sx:{color:"#8c564b"}}),label:(0,o.jsx)(x.Z,{variant:"caption",children:"Đ\xea cấp V"})}),(0,o.jsx)(h.Z,{sx:{width:20,height:3,bgcolor:"#8c564b",ml:-1}})]}),(0,o.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,o.jsx)(b.Z,{control:(0,o.jsx)(Z.Z,{size:"small",checked:l.incidents,onChange:()=>p("incidents"),sx:{color:"#f44336"}}),label:(0,o.jsx)(x.Z,{variant:"caption",children:"Sự cố c\xf4ng tr\xecnh"})}),(0,o.jsx)(h.Z,{className:"incident-marker",sx:{width:12,height:12,"& > div":{bgcolor:"#ff0000"}},children:(0,o.jsx)("div",{})})]}),(0,o.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,o.jsx)(b.Z,{control:(0,o.jsx)(Z.Z,{size:"small",checked:l.hye_cong,onChange:()=>p("hye_cong"),sx:{color:"#0066cc"}}),label:(0,o.jsx)(x.Z,{variant:"caption",children:"Cống"})})," ",(0,o.jsx)(h.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20,ml:-1},children:(0,o.jsx)(k.Z,{sx:{color:"#0066cc",fontSize:16}})})]}),(0,o.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,o.jsx)(b.Z,{control:(0,o.jsx)(Z.Z,{size:"small",checked:l.tbi_ke||l.hye_ke,onChange:()=>{p("tbi_ke"),p("hye_ke")},sx:{color:"#ff6b6b"}}),label:(0,o.jsx)(x.Z,{variant:"caption",children:"K\xe8 bảo vệ"})}),(0,o.jsx)(h.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20,ml:-1},children:(0,o.jsx)(S.Z,{sx:{color:"#ff6b6b",fontSize:16}})})]})]}),(0,o.jsx)(y.Z,{sx:{my:1}}),(0,o.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center",mb:1,alignContent:"center"},children:[(0,o.jsx)(h.Z,{className:"incident-marker",sx:{width:12,height:12,bgcolor:"#ff0000",borderRadius:"50%",mr:1,border:"2px solid white"}}),(0,o.jsx)(x.Z,{variant:"caption",children:"Sự cố nghi\xeam trọng"})]}),(0,o.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,o.jsx)(h.Z,{className:"incident-marker",sx:{width:12,height:12,mr:1,"& > div":{bgcolor:"#ffaa00"}},children:(0,o.jsx)("div",{})}),(0,o.jsx)(x.Z,{variant:"caption",children:"Sự cố cần theo d\xf5i"})]})]}),(0,o.jsxs)(z.default,{loading:n,maxBounds:[[20.4,106],[21.05,107]],boundaryFile:"",children:[t[4]&&l.hye_cong&&t[4].features.map(e=>(0,o.jsx)(s.J,{position:[e.geometry.coordinates[1],e.geometry.coordinates[0]],icon:T(),children:(0,o.jsx)(a.u,{direction:"top",offset:[0,-10],opacity:.9,children:(0,o.jsx)(x.Z,{variant:"caption",sx:{fontWeight:"bold"},children:e.properties.Ten_cong})})},e.properties.ID)),l.incidents&&e.map(e=>(0,o.jsx)(s.J,{position:e.position,icon:B(e.status),eventHandlers:{click:()=>c(e)},children:(0,o.jsx)(a.u,{direction:"top",offset:[0,-10],opacity:.9,children:(0,o.jsx)(x.Z,{variant:"caption",sx:{fontWeight:"bold"},children:e.name})})},e.id)),(0,o.jsx)(z.AutoBounds,{geojsonData:t,markers:e}),r&&(0,o.jsx)(A,{incident:r,onClose:()=>c(null)})]})]})}}}]);